/**!
 * Router plugin for single page applications with routes
 * Released under MIT license
 * @name Silk router
 * @author Sachin Singh <contactsachinsingh@gmail.com>
 * @version 3.4.3
 * @license MIT
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("argon-storage")):"function"==typeof define&&define.amd?define(["exports","argon-storage"],n):n((t=t||self).silkrouter={},t.ArgonStorage)}(this,(function(t,n){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;var e="hashchange",r="popstate",a="route.changed",o=/:[^\/]+/g,c=/^\/(?=[^?]*)/,i=/\?.+/,u="Route string is not a pure route",s="$$";function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var h=Array.isArray;function l(t){return"string"==typeof t?t.trim():""}function p(t){return t=l("".concat(t)),!(["null","undefined",""].indexOf(t)>-1)&&!isNaN(+t)}function d(t){return t&&"object"===f(t)}function g(t){return d(t)&&!h(t)}function v(t,n){return void 0===t?n:t}function y(t){return Array.prototype.slice.call(t)}function m(t){return"string"==typeof t&&c.test(t)}function b(t){return"string"==typeof t&&"#"===t.charAt(0)}function S(t){return"function"==typeof t}function E(t,n){return{type:t,state:{data:n}}}function w(t){return t?Object.keys(t):[]}var C=window.location;function I(t,n){n=v(n,C.pathname);var e={};if(o.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)"));if(o.lastIndex=0,r.test(n)){var a=y(t.match(o)).map((function(t){return t.replace(":","")})),c=y(n.match(r));c.shift(),a.forEach((function(t,n){e[t]=c[n]}))}}return e}function x(t){var n=[];return d(t)?(w(t).forEach((function(e){!function t(n,e,r){d(r)?w(r).forEach((function(a){t(n,"".concat(e,"[").concat(h(r)?"":a,"]"),r[a])})):"function"!=typeof r&&n.push("".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(r)))}(n,e,t[e])})),n.join("&")):"string"==typeof t?t:""}function N(t){return/\[/.test(t)}function D(t,n){var e=this;"?"===(t=l(v(t,C.search))).charAt(0)&&(t=t.replace("?",""));var r={};return t&&t.split("&").forEach((function(t){var a=t.split("=").map((function(t){return decodeURIComponent(t)}));(N(a[0])?M:T).apply(e,[].concat(a,[r,v(n,!1),!1]))})),r}function A(t,n){return n?void 0===t?[]:t:(r={},h(e=t)&&e.forEach((function(t,n){r[n]=t})),r);var e,r}function O(t,n){return g(t)?{ob:t}:h(t)||void 0===t?{ob:A(t,p(n))}:{ob:[t],push:null!==t}}function M(t,n,e,r){r=v(r,!0);var a=t.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===a.length){var o=a[1],c=a[2];if(N(t=t.replace(/\[([^\[]*)\]/,"")))""===c&&(c="0"),M(t=t.replace(/[^\[]+/,c),n,e[o]=O(e[o],c).ob,r);else if(c){var i=O(e[o],c);e[o]=i.ob;var u=r?j(n):n;if(i.push){var s={};s[c]=u,e[o].push(s)}else e[o][c]=u}else T(o,n,e,r,!0)}}function T(t,n,e,r,a){v(r,!0)&&(n=j(n)),t in e?(e[t]=h(e[t])?e[t]:[e[t]],e[t].push(n)):e[t]=a?[n]:n}function j(t){if(null==t)return"";if("string"!=typeof t)return t;if(p(t=l(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function L(){return D.apply(this,arguments)}function R(t,n){d(t)&&w(t).forEach((function(e){n[e]=t[e]}))}function q(){for(var t=d(arguments[0])?arguments[0]:{},n=1;n<arguments.length;n++)R(arguments[n],t);return t}var H=new n({compress:!0});function P(){this.handlers=[]}q(P.prototype,{getDataFromStore:function(t,n){return q(H.get("routeStore"))["".concat(n?"#":"").concat(t)]},setDataToStore:function(t,n,e){var r=q(H.get("routeStore"));if(r[t]&&(!e||g(e)&&0===w(e).length))return!1;var a={};return a["".concat(n?"#":"").concat(t)]=e,r=q({},r,a),H.set("routeStore",r,!0)},contains:function(t){return!!this.handlers.filter(t).length},remove:function(t){this.handlers.splice(this.handlers.indexOf(t),1).length}});var U=new P;function k(){var t=C.hash.match(i);return q({},L(),t?q({},L(t[0])):{})}function F(t,n,e){var r=b(n),a=(n=n.substring(+r)).split("?")[0];w(e=q(e)).length&&U.setDataToStore(a,r,e);var o=I(t,n);return{hasMatch:w(o).length>0||m(n)&&(t===n||"*"===t),data:U.getDataFromStore(a,r),params:o}}function $(t){t.type=t.hash?e:r;var n=v(t.originalData,{});t.originalEvent=v(t.originalEvent,E(t.type,n)),delete t.originalData,function(t,n,e){e=q(e),U.handlers.forEach((function(r){if(r.eventName===t){var a=C[n.hash?"hash":"pathname"],o=F(r.isCaseInsensitive?r.route.toLowerCase():r.route,r.isCaseInsensitive?a.toLowerCase():a,e);o.hasMatch&&(!r.hash||r.hash&&n.hash)&&r.handler(q({},n,{data:o.data,params:o.params,query:k()}))}}))}(a,t,n)}function _(t,n,e){var r=q({replaceMode:n,noTrigger:e},"string"==typeof t?{route:t}:t);if("string"==typeof r.route){var a=b(r.route),o=l(r.route).split("?"),c=o[0].substring(+a),i=x(l(o[1])||l(r.queryString));if(!m(c))throw new TypeError(u);U.setDataToStore(c,a,r.data);var s=function(t,n,e,r){e=l(e.substring(+("?"===e.charAt(0))));var a=r?C.search:"";return n?"".concat(C.pathname).concat(a,"#").concat(t).concat(e?"?".concat(e):""):"".concat(t).concat(a).concat(e?"".concat(a?"&":"?").concat(e):"")}(c,a,i,r.appendQuery);history[r.replaceMode?"replaceState":"pushState"]({data:r.data},r.title,s),r.noTrigger||$({route:"".concat(a?"#":"").concat(c),hash:a})}}function Q(t,n,o){var c="string"==typeof t&&0===t.indexOf(s);if(S(t)&&(o=n,n=t,t="*"),h(t))return function(t,n){var e=this;U.contains((function(t){return t.prevHandler===n}))||Q((function(r){S(n)&&t.indexOf("".concat(r.hash?"#":"").concat(r.route.substring(+r.hash)))>-1&&n.apply(e,[r])}),n)}(t,n);var i=b(t=t.substring(c?s.length:0));t=t.substring(+i),!U.contains((function(e){return e.handler===n&&e.route===t}))&&S(n)&&U.handlers.push({eventName:a,handler:n,prevHandler:o,route:t,hash:i,caseIgnored:c,isCaseInsensitive:c}),(i?[C.hash]:[C.pathname,C.hash]).filter((function(t){return l(t)})).forEach((function(a){var o=b(a),i=F(c?t.toLowerCase():t,c?a.toLowerCase():a);if(i.hasMatch&&S(n)){var u=o?e:r;n({originalEvent:E(u,i.data),route:a,hash:o,eventName:u,data:i.data,params:i.params,query:k(),caseIgnored:c,isCaseInsensitive:c})}}))}function z(t,n){var e=U.handlers.length,r=h(t),a=y(arguments);return 0===a.length?(U.handlers.length=0,e):(t=r?"*":t,U.handlers.forEach((function(e){var o=e.route===t,c=1===a.length;c&&"string"==typeof t&&!r||(c&&S(t)&&(n=t,t="*"),o=o&&(e.handler===n||e.prevHandler===n)),o&&U.remove(e)})),e-U.handlers.length)}var B={set:function(){return _.apply(this,arguments)}};function G(){return Q.apply(this,arguments)}window.addEventListener("".concat(r),(function(t){var n="".concat(C.pathname).concat(C.hash).split("#"),e={originalEvent:t,originalData:q(t.state&&t.state.data)};$(q({},e,{route:n[0],hash:!1})),n[1]&&$(q({},e,{route:"#".concat(n[1]),hash:!0}))})),t.deparam=L,t.param=x,t.route=G,t.routeIgnoreCase=function(t){"string"==typeof t&&G.apply(this,["".concat(s).concat(t),y(arguments).slice(1)])},t.routeParams=I,t.router=B,t.unroute=function(){return z.apply(this,arguments)},Object.defineProperty(t,"__esModule",{value:!0})}));
