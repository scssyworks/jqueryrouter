!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).silkrouter={},t.rxjs)}(this,(function(t,e){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,a=[],i=!0,c=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}(t,e)||s(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var f=/:[^/]+/g,h=/^\/(?=[^?]*)/,p=/\[/,v=/([^[]+)\[([^[]*)\]/,d=/\[([^[]*)\]/,b=/[^[]+/,y="Current browser does not support history object",_="Route string is not a pure route",x=["localhost","0.0.0.0","127.0.0.1",null],m="vpushstate",g=["route","hashRouting","path","hash","search","hashSearch","data"],w=Array.isArray;function S(t){return"string"==typeof t?t.trim():""}function O(t){return t&&"object"===n(t)}function j(t){return O(t)&&!w(t)}function E(t){return"string"==typeof t&&h.test(t)}function k(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function C(t,e){if(t&&t.length)for(var n=0;n<t.length;n+=1)if("function"==typeof e){var r=e.apply(t,[t[n],n]);if("boolean"==typeof r){if(r)continue;break}}}function A(t,e){O(t)&&Object.keys(t).forEach((function(n){e[n]=t[n]}))}function I(){for(var t=O(arguments[0])?arguments[0]:{},e=1;e<arguments.length;e++)A(arguments[e],t);return t}if(void 0===window.CustomEvent){var T=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n};T.prototype=window.Event.prototype,window.CustomEvent=T}function M(t,e,n){t instanceof Node&&(t=[t]),function(t){return t instanceof NodeList||t instanceof HTMLCollection||Array.isArray(t)}(t)&&"string"==typeof e&&C(t,(function(t){var r=new window.CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n||[]});t.dispatchEvent(r)}))}var R=window.location,N=String.fromCharCode;function B(t,e,n){t.context_data_position==e-1?(t.context_data_position=0,t.context_data.push(n(t.context_data_val)),t.context_data_val=0):t.context_data_position++}function P(t){t.context_enlargeIn--,0==t.context_enlargeIn&&(t.context_enlargeIn=Math.pow(2,t.context_numBits),t.context_numBits++)}function z(t,e,n){if(k(t.context_dictionaryToCreate,t.context_w)){if(t.context_w.charCodeAt(0)<256){for(var r=0;r<t.context_numBits;r++)t.context_data_val=t.context_data_val<<1,B(t,e,n);t.value=t.context_w.charCodeAt(0);for(var o=0;o<8;o++)t.context_data_val=t.context_data_val<<1|1&t.value,B(t,e,n),t.value=t.value>>1}else{t.value=1;for(var a=0;a<t.context_numBits;a++)t.context_data_val=t.context_data_val<<1|t.value,B(t,e,n),t.value=0;t.value=t.context_w.charCodeAt(0);for(var i=0;i<16;i++)t.context_data_val=t.context_data_val<<1|1&t.value,B(t,e,n),t.value=t.value>>1}P(t),delete t.context_dictionaryToCreate[t.context_w]}else{t.value=t.context_dictionary[t.context_w];for(var c=0;c<t.context_numBits;c++)t.context_data_val=t.context_data_val<<1|1&t.value,B(t,e,n),t.value=t.value>>1}P(t)}function D(t,e,n,r){for(var o=0,a=1;a!==e;){var i=t.val&t.position;t.position>>=1,0===t.position&&(t.position=n,t.val=r(t.index++)),o|=(i>0?1:0)*a,a<<=1}return o}function F(t){return null==t?"":function(t,e,n){if(null==t)return"";for(var r={context_dictionary:{},context_dictionaryToCreate:{},context_data:[],context_c:"",context_wc:"",context_w:"",context_enlargeIn:2,context_dictSize:3,context_numBits:2,context_data_val:0,context_data_position:0},o=0,a=0;a<t.length;a+=1)r.context_c=t.charAt(a),k(r.context_dictionary,r.context_c)||(r.context_dictionary[r.context_c]=r.context_dictSize++,r.context_dictionaryToCreate[r.context_c]=!0),r.context_wc=r.context_w+r.context_c,k(r.context_dictionary,r.context_wc)?r.context_w=r.context_wc:(z(r,e,n),r.context_dictionary[r.context_wc]=r.context_dictSize++,r.context_w=String(r.context_c));for(""!==r.context_w&&z(r,e,n),r.value=2,o=0;o<r.context_numBits;o++)r.context_data_val=r.context_data_val<<1|1&r.value,B(r,e,n),r.value=r.value>>1;for(;;){if(r.context_data_val=r.context_data_val<<1,r.context_data_position==e-1){r.context_data.push(n(r.context_data_val));break}r.context_data_position++}return r.context_data.join("")}(t,15,(function(t){return N(t+32)}))+" "}function U(t){return null==t?"":""===t?null:function(t,e,n){for(var r,o,a=[],i={val:n(0),position:e,index:1},c=[],u=4,s=4,l=3,f="",h=0;h<3;h++)a[h]=h;switch(D(i,Math.pow(2,2),e,n)){case 0:o=N(D(i,Math.pow(2,8),e,n));break;case 1:o=N(D(i,Math.pow(2,16),e,n));break;case 2:return""}for(a[3]=o,r=o,c.push(o);;){if(i.index>t)return"";switch(o=D(i,Math.pow(2,l),e,n)){case 0:a[s++]=N(D(i,Math.pow(2,8),e,n)),o=s-1,u--;break;case 1:a[s++]=N(D(i,Math.pow(2,16),e,n)),o=s-1,u--;break;case 2:return c.join("")}if(0===u&&(u=Math.pow(2,l),l++),a[o])f=a[o];else{if(o!==s)return null;f=r+r.charAt(0)}c.push(f),a[s++]=r+f.charAt(0),r=f,0==--u&&(u=Math.pow(2,l),l++)}}(t.length,16384,(function(e){return t.charCodeAt(e)-32}))}function L(){try{return sessionStorage.setItem("testKey","testValue"),sessionStorage.removeItem("testKey"),!0}catch(t){return!1}}function q(t,e){return L()?sessionStorage.setItem(t,F(O(e)?JSON.stringify(e):e)):function(t,e){if(t&&void 0!==e){var n=R.hostname,r="https:"===R.protocol,o=e;O(e)&&(o=JSON.stringify(e));var a=-1===x.indexOf(n)?"; domain=".concat(S(n)):"",i=r?"; secure":"";document.cookie="".concat(t," = ").concat(o).concat(a).concat("; path=/").concat(i)}}(t,e)}function J(t){if(L()){var e=U(sessionStorage.getItem(t));try{return e=JSON.parse(e)}catch(t){return e}}return function(t){if(t){var e=decodeURIComponent(document.cookie),n="";return C(e.split(";"),(function(e){var r="".concat(t,"="),o=e.indexOf(r);if(o>-1)return n=S(e.substring(o+r.length,e.length)),!1})),n}return""}(t)}var K={set:function(){return q.apply(this,arguments)},get:function(){return J.apply(this,arguments)}},H=new(function(){function t(){r(this,t)}return a(t,[{key:"getDataFromStore",value:function(t){return I(K.get("routeStore"))[t]}},{key:"setDataToStore",value:function(t,e){var n=I(K.get("routeStore"));return!(n[t]&&(!e||j(e)&&0===Object.keys(e).length))&&K.set("routeStore",I({},n,i({},t,e)))}}]),t}()),Q=function t(e,n){r(this,t);var o=c(e,3),a=o[0],i=o[1],u=o[2],s=u.config,l=s.location,f=s.preservePath;this.route=a.path,this.hashRouting=a.hash,this.routerInstance=u,this.virtualEvent=n||{},this.originalEvent=i||{},this.path=S(l.pathname),this.hash=l.hash,this.search=S(l.search.substring(1)),this.hashSearch=S(l.hash&&l.hash.split("?")[1]);var h=a.path;this.hashRouting&&(h="/#".concat(h),f&&(h="".concat(l.pathname).concat(h.substring(1)))),H.setDataToStore(h,this.originalEvent.state&&this.originalEvent.state.data),this.data=H.getDataFromStore(h)};function V(){var t=this;return function(n){return new e.Observable((function(e){var r=n.subscribe({next:function(n){c(n.detail,3)[2]===t&&e.next(new Q(n.detail,n))},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){r.unsubscribe()}}))}}function $(){var t=this,n=this.config,r=n.context,o=n.location,a=n.hashRouting;this.popStateSubscription=e.fromEvent(window,"popstate").subscribe((function(e){var n=S(a?o.hash.substring(1).split("?")[0]:o.pathname);n&&M(r,m,[{path:n,hash:a},e,t])})),this.listeners=e.fromEvent(r,m).pipe(V.apply(this)),a&&!o.hash&&this.set("/",!0,!1)}function G(t,e,n){O(n)?Object.keys(n).forEach((function(r){G(t,"".concat(e,"[").concat(w(n)?"":r,"]"),n[r])})):"function"!=typeof n&&t.push("".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(n)))}function W(t){var e=[];return O(t)?(Object.keys(t).forEach((function(n){G(e,n,t[n])})),e.join("&")):"string"==typeof t?t:""}var X=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))};function Y(t){return p.test(t)}function Z(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.search,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"?"===(e=S(e)).charAt(0)&&(e=e.replace("?",""));var r=Object.create(null);return e&&e.split("&").forEach((function(e){var o=e.split("=").map((function(t){return decodeURIComponent(t)}));(Y(o[0])?nt:rt).apply(t,[].concat(u(o),[r,n,!1]))})),r}function tt(t,e){return e?void 0===t?[]:t:(n=t,r=Object.create(null),w(n)&&n.forEach((function(t,e){r[e]=t})),r);var n,r}function et(t,e){return j(t)?{ob:t}:w(t)||void 0===t?{ob:tt(t,X(e))}:{ob:[t],push:null!==t}}function nt(t,e,n,r){var o=t.match(v)||[];if(3===o.length){var a=o[1],c=o[2];if(Y(t=t.replace(d,"")))""===c&&(c="0"),nt(t=t.replace(b,c),e,n[a]=et(n[a],c).ob,r);else if(c){var u=et(n[a],c);n[a]=u.ob;var s=r?ot(e):e;u.push?n[a].push(i({},c,s)):n[a][c]=s}else rt(a,e,n,r,!0)}}function rt(t,e,n,r,o){r&&(e=ot(e)),t in n?(n[t]=w(n[t])?n[t]:[n[t]],n[t].push(e)):n[t]=o?[e]:e}function ot(t){if(null==t)return"";if("string"!=typeof t)return t;if(X(t=S(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function at(){return Z.apply(this,arguments)}function it(t,e){var n=this.config.location,r=S(n.search&&n.search.substring(1)),o=S(e?n.hash.split("?")[1]:r);return o?W(I(at(r),at(o),at(t))):t}function ct(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.config,o=r.preservePath,a=r.hashRouting,i=r.location,c=r.history,u=I({replace:e,exec:n},"string"==typeof t?{route:t}:t);e=u.replace,n=u.exec;var s=u.route,l=u.queryString,f=u.preserveQuery,h=u.data,p=u.pageTitle,v=void 0===p?document.querySelector("head title").textContent:p,d=s.split("?");if(O(l)&&(l=W(l)),l=S(l||d[1]),s=S(d[0]),f&&(l=it.apply(this,[l,a])),!E(s))throw new TypeError(_);var b=s;return a&&(s="/#".concat(s),o&&(s="".concat(s.substring(1)))),H.setDataToStore(o?"".concat(i.pathname).concat(s):s,h),s="".concat(s).concat(l?"?".concat(l):""),c[e?"replaceState":"pushState"]({data:h},v,s),n&&b&&M(this.config.context,m,[{path:b,hash:a},void 0,this]),this}function ut(t){var n=this,r=this.config,o=r.hashRouting,a=r.location,i=S(o?a.hash.substring(1).split("?")[0]:a.pathname);return function(r){return new e.Observable((function(e){var a=r.subscribe({next:function(){e.next.apply(e,arguments)},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return t||(t=!0,i&&e.next(new Q([{path:i,hash:o},void 0,n]))),function(){a.unsubscribe()}}))}}var st=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(r(this,t),!window.history.pushState)throw new Error(y);e=I({hashRouting:!1,preservePath:!1,context:document.body,location:window.location,history:window.history},e),this.config=Object.freeze(e),this.__paths__=[],$.apply(this)}return a(t,[{key:"pipe",value:function(){var t;return(t=this.listeners).pipe.apply(t,[ut.apply(this)].concat(Array.prototype.slice.call(arguments)))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe(ut.apply(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){return ct.apply(this,arguments)}},{key:"destroy",value:function(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}]),t}();function lt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.pathname,n={};if(f.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(f.lastIndex=0,r.test(e)){var o=u(t.match(f)).map((function(t){return t.replace(":","")})),a=u(e.match(r));a.shift(),o.forEach((function(t,e){n[t]=a[e]}))}}return n}function ft(t,e,n){C(Object.keys(t),(function(r){O(t[r])&&O(e[r])?ft(t[r],e[r],n):n.break=t[r]!==e[r]}))}var ht=Object.freeze({__proto__:null,route:function(t,n,r){if("boolean"==typeof n&&(r=n,n=void 0),t=S(t),n instanceof st){var o=n.__paths__;-1===o.indexOf(t)&&o.push(t)}return function(o){return new e.Observable((function(e){var a=o.subscribe({next:function(n){var o=n.route;if(E(t)){r&&(t=t.toLowerCase(),o=o.toLowerCase());var a=lt(t,o),i=Object.keys(a).length;(o===t||i>0)&&(i>0&&(n.params=a),e.next(n))}else e.error(new Error(_))},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){if(n instanceof st){var e=n.__paths__,r=e.indexOf(t);r>-1&&e.splice(r,1)}a.unsubscribe()}}))}},deparam:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(n){return new e.Observable((function(e){var r=n.subscribe({next:function(n){try{n.search=at(n.search,t),n.hashSearch=at(n.hashSearch,t),e.next(n)}catch(t){e.error(t)}},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){r.unsubscribe()}}))}},noMatch:function(t){return function(n){return new e.Observable((function(e){var r=n.subscribe({next:function(n){if(t instanceof st){var r=t.__paths__;if(r.length>0){for(var o=n.route,a=!1,i=0;i<r.length;i++)if(r[i]===o||Object.keys(lt(r[i],o)).length){a=!0;break}a||(n.noMatch=!0,e.next(n))}}},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){r.unsubscribe()}}))}},cache:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={};return"boolean"==typeof t&&(n=t,t=g),function(o){return new e.Observable((function(e){var a=o.subscribe({next:function(o){C(t,(function(t){if(n&&O(o[t])&&O(r[t])){var a={};if(ft(o[t],r[t],a),a.break)return I(r,o),e.next(o),!1}else if(o[t]!==r[t])return I(r,o),e.next(o),!1}))},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){a.unsubscribe(),r={}}}))}}});t.Router=st,t.operators=ht,Object.defineProperty(t,"__esModule",{value:!0})}));
