!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).silkrouter={},t.rxjs)}(this,(function(t,e){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var o,r,a=[],i=!0,c=!1;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(a.push(o.value),!e||a.length!==e);i=!0);}catch(t){c=!0,r=t}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return a}(t,e)||s(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var f=/:[^/]+/g,h=/^\/(?=[^?]*)/,p=/\[/,v=/([^[]+)\[([^[]*)\]/,d=/\[([^[]*)\]/,b=/[^[]+/,y="Current browser does not support history object",_="Route string is not a pure route",x=["localhost","0.0.0.0","127.0.0.1",null],g="vpushstate",m=["route","hashRouting","path","hash","search","hashSearch","data"],w=Array.isArray;function S(t){return"string"==typeof t?t.trim():""}function O(t){return t=S("".concat(t)),!(["null","undefined",""].indexOf(t)>-1)&&!isNaN(+t)}function E(t){return t&&"object"===n(t)}function j(t){return E(t)&&!w(t)}function k(t){return"string"==typeof t&&h.test(t)}function C(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function A(t,e){if(t&&t.length)for(var n=0;n<t.length;n+=1)if("function"==typeof e){var o=e.apply(t,[t[n],n]);if("boolean"==typeof o){if(o)continue;break}}}function I(t,e){E(t)&&Object.keys(t).forEach((function(n){e[n]=t[n]}))}function T(){for(var t=E(arguments[0])?arguments[0]:{},e=1;e<arguments.length;e++)I(arguments[e],t);return t}if(void 0===window.CustomEvent){var M=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n};M.prototype=window.Event.prototype,window.CustomEvent=M}function R(t,e,n){t instanceof Node&&(t=[t]),function(t){return t instanceof NodeList||t instanceof HTMLCollection||Array.isArray(t)}(t)&&"string"==typeof e&&A(t,(function(t){var o=new window.CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n||[]});t.dispatchEvent(o)}))}var N=window.location,B=String.fromCharCode;function P(t,e,n){t.context_data_position==e-1?(t.context_data_position=0,t.context_data.push(n(t.context_data_val)),t.context_data_val=0):t.context_data_position++}function z(t){t.context_enlargeIn--,0==t.context_enlargeIn&&(t.context_enlargeIn=Math.pow(2,t.context_numBits),t.context_numBits++)}function D(t,e,n){if(C(t.context_dictionaryToCreate,t.context_w)){if(t.context_w.charCodeAt(0)<256){for(var o=0;o<t.context_numBits;o++)t.context_data_val=t.context_data_val<<1,P(t,e,n);t.value=t.context_w.charCodeAt(0);for(var r=0;r<8;r++)t.context_data_val=t.context_data_val<<1|1&t.value,P(t,e,n),t.value=t.value>>1}else{t.value=1;for(var a=0;a<t.context_numBits;a++)t.context_data_val=t.context_data_val<<1|t.value,P(t,e,n),t.value=0;t.value=t.context_w.charCodeAt(0);for(var i=0;i<16;i++)t.context_data_val=t.context_data_val<<1|1&t.value,P(t,e,n),t.value=t.value>>1}z(t),delete t.context_dictionaryToCreate[t.context_w]}else{t.value=t.context_dictionary[t.context_w];for(var c=0;c<t.context_numBits;c++)t.context_data_val=t.context_data_val<<1|1&t.value,P(t,e,n),t.value=t.value>>1}z(t)}function U(t,e,n,o){for(var r=0,a=1;a!==e;){var i=t.val&t.position;t.position>>=1,0===t.position&&(t.position=n,t.val=o(t.index++)),r|=(i>0?1:0)*a,a<<=1}return r}function L(t){return null==t?"":function(t,e,n){if(null==t)return"";for(var o={context_dictionary:{},context_dictionaryToCreate:{},context_data:[],context_c:"",context_wc:"",context_w:"",context_enlargeIn:2,context_dictSize:3,context_numBits:2,context_data_val:0,context_data_position:0},r=0,a=0;a<t.length;a+=1)o.context_c=t.charAt(a),C(o.context_dictionary,o.context_c)||(o.context_dictionary[o.context_c]=o.context_dictSize++,o.context_dictionaryToCreate[o.context_c]=!0),o.context_wc=o.context_w+o.context_c,C(o.context_dictionary,o.context_wc)?o.context_w=o.context_wc:(D(o,e,n),o.context_dictionary[o.context_wc]=o.context_dictSize++,o.context_w=String(o.context_c));for(""!==o.context_w&&D(o,e,n),o.value=2,r=0;r<o.context_numBits;r++)o.context_data_val=o.context_data_val<<1|1&o.value,P(o,e,n),o.value=o.value>>1;for(;;){if(o.context_data_val=o.context_data_val<<1,o.context_data_position==e-1){o.context_data.push(n(o.context_data_val));break}o.context_data_position++}return o.context_data.join("")}(t,15,(function(t){return B(t+32)}))+" "}function q(t){return null==t?"":""===t?null:function(t,e,n){for(var o,r,a=[],i={val:n(0),position:e,index:1},c=[],u=4,s=4,l=3,f="",h=0;h<3;h++)a[h]=h;switch(U(i,Math.pow(2,2),e,n)){case 0:r=B(U(i,Math.pow(2,8),e,n));break;case 1:r=B(U(i,Math.pow(2,16),e,n));break;case 2:return""}for(a[3]=r,o=r,c.push(r);;){if(i.index>t)return"";switch(r=U(i,Math.pow(2,l),e,n)){case 0:a[s++]=B(U(i,Math.pow(2,8),e,n)),r=s-1,u--;break;case 1:a[s++]=B(U(i,Math.pow(2,16),e,n)),r=s-1,u--;break;case 2:return c.join("")}if(0===u&&(u=Math.pow(2,l),l++),a[r])f=a[r];else{if(r!==s)return null;f=o+o.charAt(0)}c.push(f),a[s++]=o+f.charAt(0),o=f,0==--u&&(u=Math.pow(2,l),l++)}}(t.length,16384,(function(e){return t.charCodeAt(e)-32}))}function J(){try{return sessionStorage.setItem("testKey","testValue"),sessionStorage.removeItem("testKey"),!0}catch(t){return!1}}function F(t,e){return J()?sessionStorage.setItem(t,L(E(e)?JSON.stringify(e):e)):function(t,e){if(t&&void 0!==e){var n=N.hostname,o="https:"===N.protocol,r=e;E(e)&&(r=JSON.stringify(e));var a=-1===x.indexOf(n)?"; domain=".concat(S(n)):"",i=o?"; secure":"";document.cookie="".concat(t," = ").concat(r).concat(a).concat("; path=/").concat(i)}}(t,e)}function K(t){if(J()){var e=q(sessionStorage.getItem(t));try{return e=JSON.parse(e)}catch(t){return e}}return function(t){if(t){var e=decodeURIComponent(document.cookie),n="";return A(e.split(";"),(function(e){var o="".concat(t,"="),r=e.indexOf(o);if(r>-1)return n=S(e.substring(r+o.length,e.length)),!1})),n}return""}(t)}var H={set:function(){return F.apply(this,arguments)},get:function(){return K.apply(this,arguments)}},Q=new(function(){function t(){o(this,t)}return a(t,[{key:"getDataFromStore",value:function(t){return T(H.get("routeStore"))[t]}},{key:"setDataToStore",value:function(t,e){var n=T(H.get("routeStore"));return!(n[t]&&(!e||j(e)&&0===Object.keys(e).length))&&H.set("routeStore",T({},n,i({},t,e)))}}]),t}()),V=function t(e,n){o(this,t);var r=c(e,3),a=r[0],i=r[1],u=r[2],s=u.config,l=s.location,f=s.preservePath;this.route=a.path,this.hashRouting=a.hash,this.routerInstance=u,this.virtualEvent=n||{},this.originalEvent=i||{},this.path=S(l.pathname),this.hash=l.hash,this.search=S(l.search.substring(1)),this.hashSearch=S(l.hash&&l.hash.split("?")[1]);var h=a.path;this.hashRouting&&(h="/#".concat(h),f&&(h="".concat(l.pathname).concat(h.substring(1)))),Q.setDataToStore(h,this.originalEvent.state&&this.originalEvent.state.data),this.data=Q.getDataFromStore(h)};function $(){var t=this;return function(n){return new e.Observable((function(e){var o=n.subscribe({next:function(n){c(n.detail,3)[2]===t&&e.next(new V(n.detail,n))},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){o.unsubscribe()}}))}}function G(){var t=this,n=this.config,o=n.context,r=n.location,a=n.hashRouting;this.popStateSubscription=e.fromEvent(window,"popstate").subscribe((function(e){var n=S(a?r.hash.substring(1).split("?")[0]:r.pathname);n&&R(o,g,[{path:n,hash:a},e,t])})),this.listeners=e.fromEvent(o,g).pipe($.apply(this)),a&&!r.hash&&this.set("/",!0,!1)}function W(t,e,n){E(n)?Object.keys(n).forEach((function(o){W(t,"".concat(e,"[").concat(w(n)?"":o,"]"),n[o])})):"function"!=typeof n&&t.push("".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(n)))}function X(t){var e=[];return E(t)?(Object.keys(t).forEach((function(n){W(e,n,t[n])})),e.join("&")):"string"==typeof t?t:""}function Y(t){return p.test(t)}function Z(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.search,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"?"===(e=S(e)).charAt(0)&&(e=e.replace("?",""));var o={};return e&&e.split("&").forEach((function(e){var r=e.split("=").map((function(t){return decodeURIComponent(t)}));(Y(r[0])?nt:ot).apply(t,[].concat(u(r),[o,n,!1]))})),o}function tt(t,e){return e?void 0===t?[]:t:(o={},w(n=t)&&n.forEach((function(t,e){o[e]=t})),o);var n,o}function et(t,e){return j(t)?{ob:t}:w(t)||void 0===t?{ob:tt(t,O(e))}:{ob:[t],push:null!==t}}function nt(t,e,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=t.match(v)||[];if(3===r.length){var a=r[1],c=r[2];if(Y(t=t.replace(d,"")))""===c&&(c="0"),nt(t=t.replace(b,c),e,n[a]=et(n[a],c).ob,o);else if(c){var u=et(n[a],c);n[a]=u.ob;var s=o?rt(e):e;u.push?n[a].push(i({},c,s)):n[a][c]=s}else ot(a,e,n,o,!0)}}function ot(t,e,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4?arguments[4]:void 0;o&&(e=rt(e)),t in n?(n[t]=w(n[t])?n[t]:[n[t]],n[t].push(e)):n[t]=r?[e]:e}function rt(t){if(null==t)return"";if("string"!=typeof t)return t;if(O(t=S(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function at(){return Z.apply(this,arguments)}function it(t,e){var n=this.config.location,o=S(n.search&&n.search.substring(1)),r=S(e?n.hash.split("?")[1]:o);return r?X(T(at(o),at(r),at(t))):t}function ct(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=this.config,r=o.preservePath,a=o.hashRouting,i=o.location,c=o.history,u=T({replace:e,exec:n},"string"==typeof t?{route:t}:t);e=u.replace,n=u.exec;var s=u.route,l=u.queryString,f=u.preserveQuery,h=u.data,p=u.pageTitle,v=void 0===p?document.querySelector("head title").textContent:p,d=s.split("?");if(E(l)&&(l=X(l)),l=S(l||d[1]),s=S(d[0]),f&&(l=it.apply(this,[l,a])),!k(s))throw new TypeError(_);var b=s;return a&&(s="/#".concat(s),r&&(s="".concat(s.substring(1)))),Q.setDataToStore(r?"".concat(i.pathname).concat(s):s,h),s="".concat(s).concat(l?"?".concat(l):""),c[e?"replaceState":"pushState"]({data:h},v,s),n&&b&&R(this.config.context,g,[{path:b,hash:a},void 0,this]),this}function ut(t){var n=this,o=this.config,r=o.hashRouting,a=o.location,i=S(r?a.hash.substring(1).split("?")[0]:a.pathname);return function(o){return new e.Observable((function(e){var a=o.subscribe({next:function(){e.next.apply(e,arguments)},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return t||(t=!0,i&&e.next(new V([{path:i,hash:r},void 0,n]))),function(){a.unsubscribe()}}))}}var st=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(o(this,t),!window.history.pushState)throw new Error(y);e=T({hashRouting:!1,preservePath:!1,context:document.body,location:window.location,history:window.history},e),this.config=Object.freeze(e),this.__paths__=[],G.apply(this)}return a(t,[{key:"pipe",value:function(){var t;return(t=this.listeners).pipe.apply(t,[ut.apply(this)].concat(Array.prototype.slice.call(arguments)))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe(ut.apply(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){return ct.apply(this,arguments)}},{key:"destroy",value:function(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}]),t}();function lt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.pathname,n={};if(f.test(t)){var o=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(f.lastIndex=0,o.test(e)){var r=u(t.match(f)).map((function(t){return t.replace(":","")})),a=u(e.match(o));a.shift(),r.forEach((function(t,e){n[t]=a[e]}))}}return n}function ft(t,e,n){A(Object.keys(t),(function(o){E(t[o])&&E(e[o])?ft(t[o],e[o],n):n.break=t[o]!==e[o]}))}var ht=Object.freeze({__proto__:null,route:function(t,n,o){if("boolean"==typeof n&&(o=n,n=void 0),t=S(t),n instanceof st){var r=n.__paths__;-1===r.indexOf(t)&&r.push(t)}return function(r){return new e.Observable((function(e){var a=r.subscribe({next:function(n){var r=n.route;if(k(t)){o&&(t=t.toLowerCase(),r=r.toLowerCase());var a=lt(t,r),i=Object.keys(a).length;(r===t||i>0)&&(i>0&&(n.params=a),e.next(n))}else e.error(new Error(_))},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){if(n instanceof st){var e=n.__paths__,o=e.indexOf(t);o>-1&&e.splice(o,1)}a.unsubscribe()}}))}},deparam:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(n){return new e.Observable((function(e){var o=n.subscribe({next:function(n){try{n.search=at(n.search,t),n.hashSearch=at(n.hashSearch,t),e.next(n)}catch(t){e.error(t)}},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){o.unsubscribe()}}))}},noMatch:function(t){return function(n){return new e.Observable((function(e){var o=n.subscribe({next:function(n){if(t instanceof st){var o=t.__paths__;if(o.length>0){for(var r=n.route,a=!1,i=0;i<o.length;i++)if(o[i]===r||Object.keys(lt(o[i],r)).length){a=!0;break}a||(n.noMatch=!0,e.next(n))}}},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){o.unsubscribe()}}))}},cache:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o={};return"boolean"==typeof t&&(n=t,t=m),function(r){return new e.Observable((function(e){var a=r.subscribe({next:function(r){A(t,(function(t){if(n&&E(r[t])&&E(o[t])){var a={};if(ft(r[t],o[t],a),a.break)return T(o,r),e.next(r),!1}else if(r[t]!==o[t])return T(o,r),e.next(r),!1}))},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){a.unsubscribe(),o={}}}))}}});t.Router=st,t.operators=ht,Object.defineProperty(t,"__esModule",{value:!0})}));
