!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],n):n((t=t||self).silkrouter={},t.rxjs)}(this,(function(t,n){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function r(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,n,e){return n&&r(t.prototype,n),e&&r(t,e),t}function i(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var e=[],o=!0,r=!1,a=void 0;try{for(var i,c=t[Symbol.iterator]();!(o=(i=c.next()).done)&&(e.push(i.value),!n||e.length!==n);o=!0);}catch(t){r=!0,a=t}finally{try{o||null==c.return||c.return()}finally{if(r)throw a}}return e}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var c="popstate",u=/:[^/]+/g,s=/^\/(?=[^?]*)/,f="Current browser does not support history object",l="Route string is not a pure route",h=["localhost","0.0.0.0","127.0.0.1",null],p="vpushstate",v=Array.isArray;function _(t){return"string"==typeof t?t.trim():""}function d(t){return t=_("".concat(t)),!(["null","undefined",""].indexOf(t)>-1)&&!isNaN(+t)}function x(t){return t&&"object"===e(t)}function y(t){return x(t)&&!v(t)}function b(t,n){return void 0===t?n:t}function g(t){return Array.prototype.slice.call(t)}function m(t){return"string"==typeof t&&s.test(t)}function w(t){return t?Object.keys(t):[]}function S(t,n){return Object.prototype.hasOwnProperty.call(t,n)}function E(t,n){x(t)&&w(t).forEach((function(e){n[e]=t[e]}))}function C(){for(var t=x(arguments[0])?arguments[0]:{},n=1;n<arguments.length;n++)E(arguments[n],t);return t}if(void 0===window.CustomEvent){var O=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var e=document.createEvent("CustomEvent");return e.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),e};O.prototype=window.Event.prototype,window.CustomEvent=O}function j(t,n,e){t instanceof Node&&(t=[t]),function(t){return t instanceof NodeList||t instanceof HTMLCollection||Array.isArray(t)}(t)&&"string"==typeof n&&function(t,n){for(var e=0;e<t.length;e++)n(t[e],e)}(t,(function(t){var o=new window.CustomEvent(n,{bubbles:!0,cancelable:!0,detail:e||[]});t.dispatchEvent(o)}))}var k=window.location,A=String.fromCharCode;function I(t,n,e){t.context_data_position==n-1?(t.context_data_position=0,t.context_data.push(e(t.context_data_val)),t.context_data_val=0):t.context_data_position++}function R(t){t.context_enlargeIn--,0==t.context_enlargeIn&&(t.context_enlargeIn=Math.pow(2,t.context_numBits),t.context_numBits++)}function M(t,n,e){if(S(t.context_dictionaryToCreate,t.context_w)){if(t.context_w.charCodeAt(0)<256){for(var o=0;o<t.context_numBits;o++)t.context_data_val=t.context_data_val<<1,I(t,n,e);t.value=t.context_w.charCodeAt(0);for(var r=0;r<8;r++)t.context_data_val=t.context_data_val<<1|1&t.value,I(t,n,e),t.value=t.value>>1}else{t.value=1;for(var a=0;a<t.context_numBits;a++)t.context_data_val=t.context_data_val<<1|t.value,I(t,n,e),t.value=0;t.value=t.context_w.charCodeAt(0);for(var i=0;i<16;i++)t.context_data_val=t.context_data_val<<1|1&t.value,I(t,n,e),t.value=t.value>>1}R(t),delete t.context_dictionaryToCreate[t.context_w]}else{t.value=t.context_dictionary[t.context_w];for(var c=0;c<t.context_numBits;c++)t.context_data_val=t.context_data_val<<1|1&t.value,I(t,n,e),t.value=t.value>>1}R(t)}function T(t,n,e,o){for(var r=0,a=1;a!==n;){var i=t.val&t.position;t.position>>=1,0===t.position&&(t.position=e,t.val=o(t.index++)),r|=(i>0?1:0)*a,a<<=1}return r}function N(t){return null==t?"":function(t,n,e){if(null==t)return"";for(var o={context_dictionary:{},context_dictionaryToCreate:{},context_data:[],context_c:"",context_wc:"",context_w:"",context_enlargeIn:2,context_dictSize:3,context_numBits:2,context_data_val:0,context_data_position:0},r=0,a=0;a<t.length;a+=1)o.context_c=t.charAt(a),S(o.context_dictionary,o.context_c)||(o.context_dictionary[o.context_c]=o.context_dictSize++,o.context_dictionaryToCreate[o.context_c]=!0),o.context_wc=o.context_w+o.context_c,S(o.context_dictionary,o.context_wc)?o.context_w=o.context_wc:(M(o,n,e),o.context_dictionary[o.context_wc]=o.context_dictSize++,o.context_w=String(o.context_c));for(""!==o.context_w&&M(o,n,e),o.value=2,r=0;r<o.context_numBits;r++)o.context_data_val=o.context_data_val<<1|1&o.value,I(o,n,e),o.value=o.value>>1;for(;;){if(o.context_data_val=o.context_data_val<<1,o.context_data_position==n-1){o.context_data.push(e(o.context_data_val));break}o.context_data_position++}return o.context_data.join("")}(t,15,(function(t){return A(t+32)}))+" "}function B(t){return null==t?"":""===t?null:function(t,n,e){for(var o,r,a=[],i={val:e(0),position:n,index:1},c=[],u=4,s=4,f=3,l="",h=0;h<3;h++)a[h]=h;switch(T(i,Math.pow(2,2),n,e)){case 0:r=A(T(i,Math.pow(2,8),n,e));break;case 1:r=A(T(i,Math.pow(2,16),n,e));break;case 2:return""}for(a[3]=r,o=r,c.push(r);;){if(i.index>t)return"";switch(r=T(i,Math.pow(2,f),n,e)){case 0:a[s++]=A(T(i,Math.pow(2,8),n,e)),r=s-1,u--;break;case 1:a[s++]=A(T(i,Math.pow(2,16),n,e)),r=s-1,u--;break;case 2:return c.join("")}if(0===u&&(u=Math.pow(2,f),f++),a[r])l=a[r];else{if(r!==s)return null;l=o+o.charAt(0)}c.push(l),a[s++]=o+l.charAt(0),o=l,0===--u&&(u=Math.pow(2,f),f++)}}(t.length,16384,(function(n){return t.charCodeAt(n)-32}))}function P(){try{return sessionStorage.setItem("testKey","testValue"),sessionStorage.removeItem("testKey"),!0}catch(t){return!1}}function z(t,n){return P()?sessionStorage.setItem(t,N(x(n)?JSON.stringify(n):n)):function(t,n){if(t&&void 0!==n){var e=k.hostname,o="https:"===k.protocol,r=n;x(n)&&(r=JSON.stringify(n));var a=-1===h.indexOf(e)?"; domain=".concat(_(e)):"",i=o?"; secure":"";document.cookie="".concat(t," = ").concat(r).concat(a).concat("; path=/").concat(i)}}(t,n)}function D(t){if(P()){var n=B(sessionStorage.getItem(t));try{return n=JSON.parse(n)}catch(t){return n}}return function(t){if(t){var n=decodeURIComponent(document.cookie),e="";return function(t,n){if(t&&t.length)for(var e=0;e<t.length;e+=1)if("function"==typeof n){var o=n.apply(t,[t[e],e]);if("boolean"==typeof o){if(o)continue;break}}}(n.split(";"),(function(n){var o="".concat(t,"="),r=n.indexOf(o);if(r>-1)return e=_(n.substring(r+o.length,n.length)),!1})),e}return""}(t)}var L={set:function(){return z.apply(this,arguments)},get:function(){return D.apply(this,arguments)}},U=new(function(){function t(){o(this,t)}return a(t,[{key:"getDataFromStore",value:function(t){return C(L.get("routeStore"))[t]}},{key:"setDataToStore",value:function(t,n){var e=C(L.get("routeStore"));if(e[t]&&(!n||y(n)&&0===w(n).length))return!1;var o={};return o[t]=n,e=C({},e,o),L.set("routeStore",e)}}]),t}()),q=function t(n,e,r){o(this,t);var a=e.config,c=a.location,u=a.preservePath,s=i(n,2),f=s[0],l=s[1];this.route=f.path,this.hashRouting=f.hash,this.routerInstance=e,this.virtualEvent=r||{},this.originalEvent=l||{},this.path=_(c.pathname),this.hash=c.hash,this.search=_(c.search.substring(1)),this.hashSearch=_(c.hash&&c.hash.split("?")[1]);var h=f.path;this.hashRouting&&(h="#".concat(h),u&&(h="".concat(c.pathname).concat(h))),U.setDataToStore(h,this.originalEvent.state&&this.originalEvent.state.data),this.data=U.getDataFromStore(h)};function J(){var t,e=this.config,o=e.context,r=e.location,a=e.hashRouting;this.popStateSubscription=n.fromEvent(window,c).subscribe((function(t){var n=_(a?r.hash.substring(1).split("?")[0]:r.pathname);n&&j(o,p,[{path:n,hash:a},t])})),this.listeners=n.fromEvent(o,p).pipe((t=this,function(e){return new n.Observable((function(n){var o=e.subscribe({next:function(e){n.next(new q(e.detail,t,e))},error:function(){n.error.apply(n,arguments)},complete:function(){n.complete()}});return function(){o.unsubscribe()}}))})),a&&!r.hash&&this.set("/",!0,!1)}function F(t){var n=[];return x(t)?(w(t).forEach((function(e){!function t(n,e,o){x(o)?w(o).forEach((function(r){t(n,"".concat(e,"[").concat(v(o)?"":r,"]"),o[r])})):"function"!=typeof o&&n.push("".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(o)))}(n,e,t[e])})),n.join("&")):"string"==typeof t?t:""}function K(t){return/\[/.test(t)}function H(t,n){var e=this;"?"===(t=_(b(t,k.search))).charAt(0)&&(t=t.replace("?",""));var o={};return t&&t.split("&").forEach((function(t){var r=t.split("=").map((function(t){return decodeURIComponent(t)}));(K(r[0])?G:W).apply(e,[].concat(r,[o,b(n,!1),!1]))})),o}function Q(t,n){return n?void 0===t?[]:t:(o={},v(e=t)&&e.forEach((function(t,n){o[n]=t})),o);var e,o}function V(t,n){return y(t)?{ob:t}:v(t)||void 0===t?{ob:Q(t,d(n))}:{ob:[t],push:null!==t}}function G(t,n,e,o){o=b(o,!0);var r=t.match(/([^[]+)\[([^[]*)\]/)||[];if(3===r.length){var a=r[1],i=r[2];if(K(t=t.replace(/\[([^[]*)\]/,"")))""===i&&(i="0"),G(t=t.replace(/[^[]+/,i),n,e[a]=V(e[a],i).ob,o);else if(i){var c=V(e[a],i);e[a]=c.ob;var u=o?X(n):n;if(c.push){var s={};s[i]=u,e[a].push(s)}else e[a][i]=u}else W(a,n,e,o,!0)}}function W(t,n,e,o,r){b(o,!0)&&(n=X(n)),t in e?(e[t]=v(e[t])?e[t]:[e[t]],e[t].push(n)):e[t]=r?[n]:n}function X(t){if(null==t)return"";if("string"!=typeof t)return t;if(d(t=_(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function Y(){return H.apply(this,arguments)}function Z(t,n){var e=this.config.location,o=_(e.search&&e.search.substring(1)),r=_(n?e.hash.split("?")[1]:o);return r?F(C(Y(o),Y(r),Y(t))):t}function $(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=this.config,r=o.preservePath,a=o.hashRouting,i=o.location,c=o.history,u=C({replace:n,exec:e},"string"==typeof t?{route:t}:t);n=u.replace,e=u.exec;var s=u.route,f=u.queryString,h=u.preserveQuery,v=u.data,d=u.pageTitle,y=void 0===d?document.querySelector("head title").textContent:d,b=s.split("?");if(x(f)&&(f=F(f)),f=_(f||b[1]),s=_(b[0]),h&&(f=Z.apply(this,[f,a])),!m(s))throw new TypeError(l);var g=s;return a&&(s="#".concat(s),r&&(s="".concat(i.pathname).concat(s))),U.setDataToStore(s,v),s="".concat(s).concat(f?"?".concat(f):""),c[n?"replaceState":"pushState"]({data:v},y,s),e&&g&&j(this.config.context,p,[{path:g,hash:a}]),this}function tt(t,e){var o=t.config,r=o.hashRouting,a=o.location,i=_(r?a.hash.substring(1).split("?")[0]:a.pathname);return function(o){return new n.Observable((function(n){var a=o.subscribe({next:function(){n.next.apply(n,arguments)},error:function(){n.error.apply(n,arguments)},complete:function(){n.complete()}});return e||(e=!0,i&&n.next(new q([{path:i,hash:r}],t))),function(){a.unsubscribe()}}))}}var nt=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(o(this,t),!window.history.pushState)throw new Error(f);n=C({hashRouting:!1,preservePath:!1,context:document.body,location:window.location,history:window.history},n),this.config=Object.freeze(n),this.__paths__=[],J.apply(this)}return a(t,[{key:"pipe",value:function(){var t;return(t=this.listeners).pipe.apply(t,[tt(this)].concat(Array.prototype.slice.call(arguments)))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe(tt(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){return $.apply(this,arguments)}},{key:"destroy",value:function(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}]),t}();function et(t,n){n=b(n,k.pathname);var e={};if(u.test(t)){var o=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(u.lastIndex=0,o.test(n)){var r=g(t.match(u)).map((function(t){return t.replace(":","")})),a=g(n.match(o));a.shift(),r.forEach((function(t,n){e[t]=a[n]}))}}return e}var ot=Object.freeze({__proto__:null,route:function(t,e,o){if("boolean"==typeof e&&(o=e,e=void 0),t=_(t),e instanceof nt){var r=e.__paths__;-1===r.indexOf(t)&&r.push(t)}return function(r){return new n.Observable((function(n){var a=r.subscribe({next:function(e){var r=e.route;if(m(t)){o&&(t=t.toLowerCase(),r=r.toLowerCase());var a=et(t,r),i=Object.keys(a).length;(r===t||i>0)&&(i>0&&(e.params=a),n.next(e))}else n.error(new Error(l))},error:function(){n.error.apply(n,arguments)},complete:function(){n.complete()}});return function(){if(e instanceof nt){var n=e.__paths__,o=n.indexOf(t);o>-1&&n.splice(o,1)}a.unsubscribe()}}))}},deparam:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e){return new n.Observable((function(n){var o=e.subscribe({next:function(e){try{e.search=Y(e.search,t),e.hashSearch=Y(e.hashSearch,t),n.next(e)}catch(t){n.error(t)}},error:function(){n.error.apply(n,arguments)},complete:function(){n.complete()}});return function(){o.unsubscribe()}}))}},noMatch:function(t){return function(e){return new n.Observable((function(n){var o=e.subscribe({next:function(e){if(t instanceof nt){var o=t.__paths__;if(o.length>0){for(var r=e.route,a=!1,i=0;i<o.length;i++)if(o[i]===r||Object.keys(et(o[i],r)).length){a=!0;break}a&&(e.isErrorRoute=!0,n.next(e))}}},error:function(){n.error.apply(n,arguments)},complete:function(){n.complete()}});return function(){o.unsubscribe()}}))}}});t.Router=nt,t.operators=ot,Object.defineProperty(t,"__esModule",{value:!0})}));
