!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).silkrouter={},t.rxjs)}(this,(function(t,e){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var s=/:[^/]+/g,f=/^\/(?=[^?]*)/,l=/\[/,h=/([^[]+)\[([^[]*)\]/,p=/\[([^[]*)\]/,b=/[^[]+/,v="Current browser does not support history object",y="Route string is not a pure route",d="vpushstate",m=["route","hashRouting","path","hash","search","hashSearch","data"],g=Array.isArray;function w(t){return"string"==typeof t?t.trim():""}function x(t){return t&&"object"===n(t)}function E(t){return"string"==typeof t&&f.test(t)}function S(t,e){if(t&&t.length)for(var n=0;n<t.length;n+=1)if("function"==typeof e){var r=e.apply(t,[t[n],n]);if("boolean"==typeof r){if(r)continue;break}}}function _(t,e){x(t)&&Object.keys(t).forEach((function(n){e[n]=t[n]}))}function j(){for(var t=x(arguments[0])?arguments[0]:{},e=1;e<arguments.length;e++)_(arguments[e],t);return t}if(void 0===window.CustomEvent){var O=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n};O.prototype=window.Event.prototype,window.CustomEvent=O}function k(t,e,n){t instanceof Node&&(t=[t]),function(t){return t instanceof NodeList||t instanceof HTMLCollection||Array.isArray(t)}(t)&&"string"==typeof e&&S(t,(function(t){var r=new window.CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n||[]});t.dispatchEvent(r)}))}var A=function t(e,n){r(this,t);var o=i(e,3),a=o[0],u=o[1],c=o[2],s=c.config,f=s.location,l=s.history;this.route=a.path,this.hashRouting=a.hash,this.routerInstance=c,this.virtualEvent=n||{},this.originalEvent=u||{},this.path=w(f.pathname),this.hash=f.hash,this.search=w(f.search.substring(1)),this.hashSearch=w(f.hash&&f.hash.split("?")[1]);var h=this.originalEvent.state;this.data=h&&h.data||l.state&&l.state.data};function C(){var t=this;return function(n){return new e.Observable((function(e){var r=n.subscribe({next:function(n){i(n.detail,3)[2]===t&&e.next(new A(n.detail,n))},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){r.unsubscribe()}}))}}function R(){var t=this,n=this.config,r=n.context,o=n.location,i=n.hashRouting;this.popStateSubscription=e.fromEvent(window,"popstate").subscribe((function(e){var n=w(i?o.hash.substring(1).split("?")[0]:o.pathname);n&&k(r,d,[{path:n,hash:i},e,t])})),this.listeners=e.fromEvent(r,d).pipe(C.apply(this)),i&&!o.hash&&this.set("/",!0,!1)}function I(t,e,n){x(n)?Object.keys(n).forEach((function(r){I(t,"".concat(e,"[").concat(g(n)?"":r,"]"),n[r])})):"function"!=typeof n&&t.push("".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(n)))}function N(t){var e=[];return x(t)?(Object.keys(t).forEach((function(n){I(e,n,t[n])})),e.join("&")):"string"==typeof t?t:""}var T=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},M=window.location;function P(t){return l.test(t)}function L(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.search,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"?"===(e=w(e)).charAt(0)&&(e=e.replace("?",""));var r=Object.create(null);return e&&e.split("&").forEach((function(e){var o=e.split("=").map((function(t){return decodeURIComponent(t)}));(P(o[0])?F:z).apply(t,[].concat(a(o),[r,n,!1]))})),r}function U(t,e){return e?void 0===t?[]:t:(n=t,r=Object.create(null),g(n)&&n.forEach((function(t,e){r[e]=t})),r);var n,r}function q(t,e){return x(n=t)&&!g(n)?{ob:t}:g(t)||void 0===t?{ob:U(t,T(e))}:{ob:[t],push:null!==t};var n}function F(t,e,n,r){var o=t.match(h)||[];if(3===o.length){var i=o[1],a=o[2];if(P(t=t.replace(p,"")))""===a&&(a="0"),F(t=t.replace(b,a),e,n[i]=q(n[i],a).ob,r);else if(a){var u=q(n[i],a);n[i]=u.ob;var c=r?H(e):e;u.push?n[i].push(function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},a,c)):n[i][a]=c}else z(i,e,n,r,!0)}}function z(t,e,n,r,o){r&&(e=H(e)),t in n?(n[t]=g(n[t])?n[t]:[n[t]],n[t].push(e)):n[t]=o?[e]:e}function H(t){if(null==t)return"";if("string"!=typeof t)return t;if(T(t=w(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function Q(){return L.apply(this,arguments)}function $(t,e){var n=this.config.location,r=w(n.search&&n.search.substring(1)),o=w(e?n.hash.split("?")[1]:r);return o?N(j(Q(r),Q(o),Q(t))):t}function B(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.config,o=r.preservePath,i=r.hashRouting,a=r.history,u=j({replace:e,exec:n},"string"==typeof t?{route:t}:t);e=u.replace,n=u.exec;var c=u.route,s=u.queryString,f=u.preserveQuery,l=u.data,h=u.pageTitle,p=void 0===h?document.querySelector("head > title").textContent:h,b=c.split("?");if(x(s)&&(s=N(s)),s=w(s||b[1]),c=w(b[0]),f&&(s=$.apply(this,[s,i])),!E(c))throw new TypeError(y);var v=c;return i&&(c="/#".concat(c),o&&(c="".concat(c.substring(1)))),c="".concat(c).concat(s?"?".concat(s):""),a[e?"replaceState":"pushState"]({data:l},p,c),n&&v&&k(this.config.context,d,[{path:v,hash:i},void 0,this]),this}function D(t){var n=this,r=this.config,o=r.hashRouting,i=r.location,a=w(o?i.hash.substring(1).split("?")[0]:i.pathname);return function(r){return new e.Observable((function(e){var i=r.subscribe({next:function(){e.next.apply(e,arguments)},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return t||(t=!0,a&&e.next(new A([{path:a,hash:o},void 0,n]))),function(){i.unsubscribe()}}))}}var G=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(r(this,t),!window.history.pushState)throw new Error(v);e=j({hashRouting:!1,preservePath:!1,context:document.body,location:window.location,history:window.history},e),this.config=Object.freeze(e),this.__paths__=[],R.apply(this)}var e,n,i;return e=t,(n=[{key:"pipe",value:function(){var t;return(t=this.listeners).pipe.apply(t,[D.apply(this)].concat(Array.prototype.slice.call(arguments)))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe(D.apply(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){return B.apply(this,arguments)}},{key:"destroy",value:function(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}])&&o(e.prototype,n),i&&o(e,i),t}();function J(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M.pathname,n={};if(s.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(s.lastIndex=0,r.test(e)){var o=a(t.match(s)).map((function(t){return t.replace(":","")})),i=a(e.match(r));i.shift(),o.forEach((function(t,e){n[t]=i[e]}))}}return n}function K(t,e,n){S(Object.keys(t),(function(r){x(t[r])&&x(e[r])?K(t[r],e[r],n):n.break=t[r]!==e[r]}))}var V=Object.freeze({__proto__:null,route:function(t,n,r){if("boolean"==typeof n&&(r=n,n=void 0),t=w(t),n instanceof G){var o=n.__paths__;-1===o.indexOf(t)&&o.push(t)}return function(o){return new e.Observable((function(e){var i=o.subscribe({next:function(n){var o=n.route;if(E(t)){r&&(t=t.toLowerCase(),o=o.toLowerCase());var i=J(t,o),a=Object.keys(i).length;(o===t||a>0)&&(a>0&&(n.params=i),e.next(n))}else e.error(new Error(y))},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){if(n instanceof G){var e=n.__paths__,r=e.indexOf(t);r>-1&&e.splice(r,1)}i.unsubscribe()}}))}},deparam:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(n){return new e.Observable((function(e){var r=n.subscribe({next:function(n){try{n.search=Q(n.search,t),n.hashSearch=Q(n.hashSearch,t),e.next(n)}catch(t){e.error(t)}},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){r.unsubscribe()}}))}},noMatch:function(t){return function(n){return new e.Observable((function(e){var r=n.subscribe({next:function(n){if(t instanceof G){var r=t.__paths__;if(r.length>0){for(var o=n.route,i=!1,a=0;a<r.length;a++)if(r[a]===o||Object.keys(J(r[a],o)).length){i=!0;break}i||(n.noMatch=!0,e.next(n))}}},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){r.unsubscribe()}}))}},cache:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={};return"boolean"==typeof t&&(n=t,t=m),function(o){return new e.Observable((function(e){var i=o.subscribe({next:function(o){S(t,(function(t){if(n&&x(o[t])&&x(r[t])){var i={};if(K(o[t],r[t],i),i.break)return j(r,o),e.next(o),!1}else if(o[t]!==r[t])return j(r,o),e.next(o),!1}))},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){i.unsubscribe(),r={}}}))}}});t.Router=G,t.operators=V,Object.defineProperty(t,"__esModule",{value:!0})}));
