!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).silkrouter={},t.rxjs)}(this,(function(t,e){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=/:[^/]+/g,a=/^\/(?=[^?]*)/,u=/\[/,c=/([^[]+)\[([^[]*)\]/,s=/\[([^[]*)\]/,f=/[^[]+/,h="Current browser does not support history object",l="Route string is not a pure route",p="vpushstate",b=["route","hashRouting","path","hash","search","hashSearch","data"],v="?",y="",g=void 0,d=n(y),m=n(!0),x=n(g),_=n({});n(0);var w=n((function(){})),E="State",O="push".concat(E),j="replace".concat(E);function k(){return("undefined"==typeof globalThis?"undefined":n(globalThis))!==x?globalThis:global||self}var S=Array.isArray;function C(t){return n(t)===d?t.trim():y}function R(t){return t&&n(t)===_}function A(t){return n(t)===d&&a.test(t)}function T(t,e){if(t&&t.length)for(var r=0;r<t.length;r+=1)if(n(e)===w){var o=e.apply(t,[t[r],r]);if(n(o)===m){if(o)continue;break}}}var N=k();if(n(N.CustomEvent)===x){var I=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:g};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n};I.prototype=N.Event.prototype,N.CustomEvent=I}function P(t,e){R(t)&&Object.keys(t).forEach((function(n){e[n]=t[n]}))}function L(){for(var t=R(arguments.length<=0?void 0:arguments[0])?arguments.length<=0?void 0:arguments[0]:{},e=1;e<arguments.length;e++)P(e<0||arguments.length<=e?void 0:arguments[e],t);return t}Array.from||(Array.from=function(t){if(S(t))return t;for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e});var M=k();function F(t,e,r){t instanceof Node&&(t=[t]),function(t){return t instanceof NodeList||t instanceof HTMLCollection||Array.isArray(t)}(t)&&n(e)===d&&T(t,(function(t){var n=new M.CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r||[]});t.dispatchEvent(n)}))}var U=function t(e,n){r(this,t);var o=e[0],i=e[1],a=e[2],u=a.config,c=u.location,s=u.history;this.route=o.path,this.hashRouting=o.hash,this.routerInstance=a,this.virtualEvent=n||{},this.originalEvent=i||{},this.path=C(c.pathname),this.hash=c.hash,this.search=C(c.search.substring(1)),this.hashSearch=C(c.hash&&c.hash.split(v)[1]);var f=this.originalEvent.state;this.data=f&&f.data||s.state&&s.state.data};function q(){var t=this;return function(n){return new e.Observable((function(e){var r=n.subscribe({next:function(n){n.detail[2]===t&&e.next(new U(n.detail,n))},error:e.error,complete:e.complete});return function(){r.unsubscribe()}}))}}function z(){var t=this,n=this.config,r=n.context,o=n.location,i=n.hashRouting;this.popStateSubscription=e.fromEvent(k(),"popstate").subscribe((function(e){var n=C(i?o.hash.substring(1).split(v)[0]:o.pathname);n&&F(r,p,[{path:n,hash:i},e,t])})),this.listeners=e.fromEvent(r,p).pipe(q.apply(this)),i&&!o.hash&&this.set("/",!0,!1)}function H(t,e,r){R(r)?Object.keys(r).forEach((function(n){H(t,"".concat(e,"[").concat(S(r)?y:n,"]"),r[n])})):n(r)!==w&&t.push("".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(r)))}function Q(t){var e=[];return R(t)?(Object.keys(t).forEach((function(n){H(e,n,t[n])})),e.join("&")):n(t)===d?t:y}var B=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))};function D(t){return u.test(t)}function G(t,e){var n=this;(t=C(t)).charAt(0)===v&&(t=t.replace(v,y));var r=Object.create(null);return t&&t.split("&").forEach((function(t){var o=t.split("=").map((function(t){return decodeURIComponent(t)}));(D(o[0])?V:W).apply(n,o.concat([r,e,!1]))})),r}function J(t,e){return e?n(t)===x?[]:t:(r=t,o=Object.create(null),S(r)&&r.forEach((function(t,e){o[e]=t})),o);var r,o}function K(t,e){return R(r=t)&&!S(r)?{ob:t}:S(t)||n(t)===x?{ob:J(t,B(e))}:{ob:[t],push:null!==t};var r}function V(t,e,n,r){var o=t.match(c)||[];if(3===o.length){var i=o[1],a=o[2];if(D(t=t.replace(s,y)))a===y&&(a="0"),V(t=t.replace(f,a),e,n[i]=K(n[i],a).ob,r);else if(a){var u=K(n[i],a);n[i]=u.ob;var h=r?X(e):e;u.push?n[i].push(function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},a,h)):n[i][a]=h}else W(i,e,n,r,!0)}}function W(t,e,n,r,o){r&&(e=X(e)),t in n?(n[t]=S(n[t])?n[t]:[n[t]],n[t].push(e)):n[t]=o?[e]:e}function X(t){if(null==t)return y;if(n(t)!==d)return t;if(B(t=C(t)))return+t;switch(t){case"null":return null;case x:return g;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function Y(t,e){var n=this.config.location,r=C(n.search&&n.search.substring(1)),o=C(e?n.hash.split(v)[1]:r);return o?Q(L(G(r),G(o),G(t))):t}function Z(t,e,r){r=r||!0;var o=this.config,i=o.preservePath,a=o.hashRouting,u=o.history,c=L({replace:e,exec:r},n(t)===d?{route:t}:t);e=c.replace,r=c.exec;var s=c.route,f=c.queryString,h=c.preserveQuery,b=c.data,m=c.pageTitle,x=void 0===m?null:m,_=s.split(v);if(R(f)&&(f=Q(f)),f=C(f||_[1]),s=C(_[0]),h&&(f=Y.apply(this,[f,a])),!A(s))throw new TypeError(l);var w=s;return a&&(s="/#".concat(s),i&&(s="".concat(s.substring(1)))),s="".concat(s).concat(f?"".concat(v+f):y),u[e?j:O]({data:b},x,s),r&&w&&F(this.config.context,p,[{path:w,hash:a},g,this]),this}function $(t){var n=this,r=this.config,o=r.hashRouting,i=r.location,a=C(o?i.hash.substring(1).split(v)[0]:i.pathname);return function(r){return new e.Observable((function(e){var i=r.subscribe(e);return t||(t=!0,a&&e.next(new U([{path:a,hash:o},g,n]))),function(){i.unsubscribe()}}))}}var tt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,t);var n=k(),o=n.history,i=n.location,a=n.document;if(!o[O])throw new Error(h);e=L({hashRouting:!1,preservePath:!1,context:a.body,location:i,history:o},e),this.config=Object.freeze(e),this.__paths__=[],z.apply(this)}var e,i,a;return e=t,(i=[{key:"pipe",value:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=this.listeners).pipe.apply(t,[$.apply(this)].concat(n))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe($.apply(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Z.apply(this,e)}},{key:"destroy",value:function(t){n(t)===w&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}])&&o(e.prototype,i),a&&o(e,a),t}();function et(t,e){var n={};if(i.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(i.lastIndex=0,r.test(e)){var o=Array.from(t.match(i)).map((function(t){return t.replace(":",y)})),a=Array.from(e.match(r));a.shift(),o.forEach((function(t,e){n[t]=a[e]}))}}return n}function nt(t,e,n){T(Object.keys(t),(function(r){R(t[r])&&R(e[r])?nt(t[r],e[r],n):n.break=t[r]!==e[r]}))}var rt=Object.freeze({__proto__:null,route:function(t,r,o){if(n(r)===m&&(o=r,r=g),t=C(t),r instanceof tt){var i=r.__paths__;-1===i.indexOf(t)&&i.push(t)}return function(n){return new e.Observable((function(e){var i=n.subscribe({next:function(n){var r=n.route;if(A(t)){o&&(t=t.toLowerCase(),r=r.toLowerCase());var i=et(t,r),a=Object.keys(i).length;(r===t||a>0)&&(a>0&&(n.params=i),e.next(n))}else e.error(new Error(l))},error:e.error,complete:e.complete});return function(){if(r instanceof tt){var e=r.__paths__,n=e.indexOf(t);n>-1&&e.splice(n,1)}i.unsubscribe()}}))}},deparam:function(t){return function(n){return new e.Observable((function(e){var r=n.subscribe({next:function(n){try{n.search=G(n.search,t),n.hashSearch=G(n.hashSearch,t),e.next(n)}catch(t){e.error(t)}},error:e.error,complete:e.complete});return function(){r.unsubscribe()}}))}},noMatch:function(t){return function(n){return new e.Observable((function(e){var r=n.subscribe({next:function(n){if(t instanceof tt){var r=t.__paths__;if(r.length>0){for(var o=n.route,i=!1,a=0;a<r.length;a++)if(r[a]===o||Object.keys(et(r[a],o)).length){i=!0;break}i||(n.noMatch=!0,e.next(n))}}},error:e.error,complete:e.complete});return function(){r.unsubscribe()}}))}},cache:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,r=arguments.length>1?arguments[1]:void 0,o={};return n(t)===m&&(r=t,t=b),function(n){return new e.Observable((function(e){var i=n.subscribe({next:function(n){T(t,(function(t){if(r&&R(n[t])&&R(o[t])){var i={};if(nt(n[t],o[t],i),i.break)return L(o,n),e.next(n),!1}else if(n[t]!==o[t])return L(o,n),e.next(n),!1}))},error:e.error,complete:e.complete});return function(){i.unsubscribe(),o={}}}))}}});t.Router=tt,t.operators=rt,Object.defineProperty(t,"__esModule",{value:!0})}));
