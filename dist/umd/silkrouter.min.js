!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],e):e((t=t||self).silkrouter={},t.rxjs)}(this,(function(t,e){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var n=[],o=!0,r=!1,a=void 0;try{for(var i,c=t[Symbol.iterator]();!(o=(i=c.next()).done)&&(n.push(i.value),!e||n.length!==e);o=!0);}catch(t){r=!0,a=t}finally{try{o||null==c.return||c.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function u(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var s=/:[^/]+/g,f=/^\/(?=[^?]*)/,l=/\[/,h=/([^[]+)\[([^[]*)\]/,p=/\[([^[]*)\]/,v=/[^[]+/,d="Route string is not a pure route",_=["localhost","0.0.0.0","127.0.0.1",null],b=["route","hashRouting","path","hash","search","hashSearch","data"],y=Array.isArray;function x(t){return"string"==typeof t?t.trim():""}function g(t){return t=x("".concat(t)),!(["null","undefined",""].indexOf(t)>-1)&&!isNaN(+t)}function m(t){return t&&"object"===n(t)}function w(t){return m(t)&&!y(t)}function S(t){return"string"==typeof t&&f.test(t)}function O(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function j(t,e){if(t&&t.length)for(var n=0;n<t.length;n+=1)if("function"==typeof e){var o=e.apply(t,[t[n],n]);if("boolean"==typeof o){if(o)continue;break}}}function E(t,e){m(t)&&Object.keys(t).forEach((function(n){e[n]=t[n]}))}function k(){for(var t=m(arguments[0])?arguments[0]:{},e=1;e<arguments.length;e++)E(arguments[e],t);return t}if(void 0===window.CustomEvent){var C=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n};C.prototype=window.Event.prototype,window.CustomEvent=C}function A(t,e,n){t instanceof Node&&(t=[t]),function(t){return t instanceof NodeList||t instanceof HTMLCollection||Array.isArray(t)}(t)&&"string"==typeof e&&j(t,(function(t){var o=new window.CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n||[]});t.dispatchEvent(o)}))}var I=window.location,R=String.fromCharCode;function M(t,e,n){t.context_data_position==e-1?(t.context_data_position=0,t.context_data.push(n(t.context_data_val)),t.context_data_val=0):t.context_data_position++}function T(t){t.context_enlargeIn--,0==t.context_enlargeIn&&(t.context_enlargeIn=Math.pow(2,t.context_numBits),t.context_numBits++)}function N(t,e,n){if(O(t.context_dictionaryToCreate,t.context_w)){if(t.context_w.charCodeAt(0)<256){for(var o=0;o<t.context_numBits;o++)t.context_data_val=t.context_data_val<<1,M(t,e,n);t.value=t.context_w.charCodeAt(0);for(var r=0;r<8;r++)t.context_data_val=t.context_data_val<<1|1&t.value,M(t,e,n),t.value=t.value>>1}else{t.value=1;for(var a=0;a<t.context_numBits;a++)t.context_data_val=t.context_data_val<<1|t.value,M(t,e,n),t.value=0;t.value=t.context_w.charCodeAt(0);for(var i=0;i<16;i++)t.context_data_val=t.context_data_val<<1|1&t.value,M(t,e,n),t.value=t.value>>1}T(t),delete t.context_dictionaryToCreate[t.context_w]}else{t.value=t.context_dictionary[t.context_w];for(var c=0;c<t.context_numBits;c++)t.context_data_val=t.context_data_val<<1|1&t.value,M(t,e,n),t.value=t.value>>1}T(t)}function B(t,e,n,o){for(var r=0,a=1;a!==e;){var i=t.val&t.position;t.position>>=1,0===t.position&&(t.position=n,t.val=o(t.index++)),r|=(i>0?1:0)*a,a<<=1}return r}function P(t){return null==t?"":function(t,e,n){if(null==t)return"";for(var o={context_dictionary:{},context_dictionaryToCreate:{},context_data:[],context_c:"",context_wc:"",context_w:"",context_enlargeIn:2,context_dictSize:3,context_numBits:2,context_data_val:0,context_data_position:0},r=0,a=0;a<t.length;a+=1)o.context_c=t.charAt(a),O(o.context_dictionary,o.context_c)||(o.context_dictionary[o.context_c]=o.context_dictSize++,o.context_dictionaryToCreate[o.context_c]=!0),o.context_wc=o.context_w+o.context_c,O(o.context_dictionary,o.context_wc)?o.context_w=o.context_wc:(N(o,e,n),o.context_dictionary[o.context_wc]=o.context_dictSize++,o.context_w=String(o.context_c));for(""!==o.context_w&&N(o,e,n),o.value=2,r=0;r<o.context_numBits;r++)o.context_data_val=o.context_data_val<<1|1&o.value,M(o,e,n),o.value=o.value>>1;for(;;){if(o.context_data_val=o.context_data_val<<1,o.context_data_position==e-1){o.context_data.push(n(o.context_data_val));break}o.context_data_position++}return o.context_data.join("")}(t,15,(function(t){return R(t+32)}))+" "}function z(t){return null==t?"":""===t?null:function(t,e,n){for(var o,r,a=[],i={val:n(0),position:e,index:1},c=[],u=4,s=4,f=3,l="",h=0;h<3;h++)a[h]=h;switch(B(i,Math.pow(2,2),e,n)){case 0:r=R(B(i,Math.pow(2,8),e,n));break;case 1:r=R(B(i,Math.pow(2,16),e,n));break;case 2:return""}for(a[3]=r,o=r,c.push(r);;){if(i.index>t)return"";switch(r=B(i,Math.pow(2,f),e,n)){case 0:a[s++]=R(B(i,Math.pow(2,8),e,n)),r=s-1,u--;break;case 1:a[s++]=R(B(i,Math.pow(2,16),e,n)),r=s-1,u--;break;case 2:return c.join("")}if(0===u&&(u=Math.pow(2,f),f++),a[r])l=a[r];else{if(r!==s)return null;l=o+o.charAt(0)}c.push(l),a[s++]=o+l.charAt(0),o=l,0===--u&&(u=Math.pow(2,f),f++)}}(t.length,16384,(function(e){return t.charCodeAt(e)-32}))}function D(){try{return sessionStorage.setItem("testKey","testValue"),sessionStorage.removeItem("testKey"),!0}catch(t){return!1}}function L(t,e){return D()?sessionStorage.setItem(t,P(m(e)?JSON.stringify(e):e)):function(t,e){if(t&&void 0!==e){var n=I.hostname,o="https:"===I.protocol,r=e;m(e)&&(r=JSON.stringify(e));var a=-1===_.indexOf(n)?"; domain=".concat(x(n)):"",i=o?"; secure":"";document.cookie="".concat(t," = ").concat(r).concat(a).concat("; path=/").concat(i)}}(t,e)}function U(t){if(D()){var e=z(sessionStorage.getItem(t));try{return e=JSON.parse(e)}catch(t){return e}}return function(t){if(t){var e=decodeURIComponent(document.cookie),n="";return j(e.split(";"),(function(e){var o="".concat(t,"="),r=e.indexOf(o);if(r>-1)return n=x(e.substring(r+o.length,e.length)),!1})),n}return""}(t)}var q={set:function(){return L.apply(this,arguments)},get:function(){return U.apply(this,arguments)}},J=new(function(){function t(){o(this,t)}return a(t,[{key:"getDataFromStore",value:function(t){return k(q.get("routeStore"))[t]}},{key:"setDataToStore",value:function(t,e){var n=k(q.get("routeStore"));return!(n[t]&&(!e||w(e)&&0===Object.keys(e).length))&&q.set("routeStore",k({},n,i({},t,e)))}}]),t}()),F=function t(e,n,r){o(this,t);var a=n.config,i=a.location,u=a.preservePath,s=c(e,2),f=s[0],l=s[1];this.route=f.path,this.hashRouting=f.hash,this.routerInstance=n,this.virtualEvent=r||{},this.originalEvent=l||{},this.path=x(i.pathname),this.hash=i.hash,this.search=x(i.search.substring(1)),this.hashSearch=x(i.hash&&i.hash.split("?")[1]);var h=f.path;this.hashRouting&&(h="#".concat(h),u&&(h="".concat(i.pathname).concat(h))),J.setDataToStore(h,this.originalEvent.state&&this.originalEvent.state.data),this.data=J.getDataFromStore(h)};function K(){var t,n=this.config,o=n.context,r=n.location,a=n.hashRouting;this.popStateSubscription=e.fromEvent(window,"popstate").subscribe((function(t){var e=x(a?r.hash.substring(1).split("?")[0]:r.pathname);e&&A(o,"vpushstate",[{path:e,hash:a},t])})),this.listeners=e.fromEvent(o,"vpushstate").pipe((t=this,function(n){return new e.Observable((function(e){var o=n.subscribe({next:function(n){e.next(new F(n.detail,t,n))},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){o.unsubscribe()}}))})),a&&!r.hash&&this.set("/",!0,!1)}function H(t){var e=[];return m(t)?(Object.keys(t).forEach((function(n){!function t(e,n,o){m(o)?Object.keys(o).forEach((function(r){t(e,"".concat(n,"[").concat(y(o)?"":r,"]"),o[r])})):"function"!=typeof o&&e.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(o)))}(e,n,t[n])})),e.join("&")):"string"==typeof t?t:""}function Q(t){return l.test(t)}function V(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.search,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"?"===(e=x(e)).charAt(0)&&(e=e.replace("?",""));var o={};return e&&e.split("&").forEach((function(e){var r=e.split("=").map((function(t){return decodeURIComponent(t)}));(Q(r[0])?X:Y).apply(t,[].concat(u(r),[o,n,!1]))})),o}function G(t,e){return e?void 0===t?[]:t:(o={},y(n=t)&&n.forEach((function(t,e){o[e]=t})),o);var n,o}function W(t,e){return w(t)?{ob:t}:y(t)||void 0===t?{ob:G(t,g(e))}:{ob:[t],push:null!==t}}function X(t,e,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=t.match(h)||[];if(3===r.length){var a=r[1],c=r[2];if(Q(t=t.replace(p,"")))""===c&&(c="0"),X(t=t.replace(v,c),e,n[a]=W(n[a],c).ob,o);else if(c){var u=W(n[a],c);n[a]=u.ob;var s=o?Z(e):e;u.push?n[a].push(i({},c,s)):n[a][c]=s}else Y(a,e,n,o,!0)}}function Y(t,e,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4?arguments[4]:void 0;o&&(e=Z(e)),t in n?(n[t]=y(n[t])?n[t]:[n[t]],n[t].push(e)):n[t]=r?[e]:e}function Z(t){if(null==t)return"";if("string"!=typeof t)return t;if(g(t=x(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function $(){return V.apply(this,arguments)}function tt(t,e){var n=this.config.location,o=x(n.search&&n.search.substring(1)),r=x(e?n.hash.split("?")[1]:o);return r?H(k($(o),$(r),$(t))):t}function et(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=this.config,r=o.preservePath,a=o.hashRouting,i=o.location,c=o.history,u=k({replace:e,exec:n},"string"==typeof t?{route:t}:t);e=u.replace,n=u.exec;var s=u.route,f=u.queryString,l=u.preserveQuery,h=u.data,p=u.pageTitle,v=void 0===p?document.querySelector("head title").textContent:p,_=s.split("?");if(m(f)&&(f=H(f)),f=x(f||_[1]),s=x(_[0]),l&&(f=tt.apply(this,[f,a])),!S(s))throw new TypeError(d);var b=s;return a&&(s="#".concat(s),r&&(s="".concat(i.pathname).concat(s))),J.setDataToStore(s,h),s="".concat(s).concat(f?"?".concat(f):""),c[e?"replaceState":"pushState"]({data:h},v,s),n&&b&&A(this.config.context,"vpushstate",[{path:b,hash:a}]),this}function nt(t,n){var o=t.config,r=o.hashRouting,a=o.location,i=x(r?a.hash.substring(1).split("?")[0]:a.pathname);return function(o){return new e.Observable((function(e){var a=o.subscribe({next:function(){e.next.apply(e,arguments)},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return n||(n=!0,i&&e.next(new F([{path:i,hash:r}],t))),function(){a.unsubscribe()}}))}}var ot=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(o(this,t),!window.history.pushState)throw new Error("Current browser does not support history object");e=k({hashRouting:!1,preservePath:!1,context:document.body,location:window.location,history:window.history},e),this.config=Object.freeze(e),this.__paths__=[],K.apply(this)}return a(t,[{key:"pipe",value:function(){var t;return(t=this.listeners).pipe.apply(t,[nt(this)].concat(Array.prototype.slice.call(arguments)))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe(nt(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){return et.apply(this,arguments)}},{key:"destroy",value:function(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}]),t}();function rt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I.pathname,n={};if(s.test(t)){var o=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(s.lastIndex=0,o.test(e)){var r=u(t.match(s)).map((function(t){return t.replace(":","")})),a=u(e.match(o));a.shift(),r.forEach((function(t,e){n[t]=a[e]}))}}return n}function at(t,e,n){j(Object.keys(t),(function(o){m(t[o])&&m(e[o])?at(t[o],e[o],n):n.break=t[o]!==e[o]}))}var it=Object.freeze({__proto__:null,route:function(t,n,o){if("boolean"==typeof n&&(o=n,n=void 0),t=x(t),n instanceof ot){var r=n.__paths__;-1===r.indexOf(t)&&r.push(t)}return function(r){return new e.Observable((function(e){var a=r.subscribe({next:function(n){var r=n.route;if(S(t)){o&&(t=t.toLowerCase(),r=r.toLowerCase());var a=rt(t,r),i=Object.keys(a).length;(r===t||i>0)&&(i>0&&(n.params=a),e.next(n))}else e.error(new Error(d))},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){if(n instanceof ot){var e=n.__paths__,o=e.indexOf(t);o>-1&&e.splice(o,1)}a.unsubscribe()}}))}},deparam:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(n){return new e.Observable((function(e){var o=n.subscribe({next:function(n){try{n.search=$(n.search,t),n.hashSearch=$(n.hashSearch,t),e.next(n)}catch(t){e.error(t)}},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){o.unsubscribe()}}))}},noMatch:function(t){return function(n){return new e.Observable((function(e){var o=n.subscribe({next:function(n){if(t instanceof ot){var o=t.__paths__;if(o.length>0){for(var r=n.route,a=!1,i=0;i<o.length;i++)if(o[i]===r||Object.keys(rt(o[i],r)).length){a=!0;break}a||(n.noMatch=!0,e.next(n))}}},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){o.unsubscribe()}}))}},cache:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o={};return"boolean"==typeof t&&(n=t,t=b),function(r){return new e.Observable((function(e){var a=r.subscribe({next:function(r){j(t,(function(t){if(n&&m(r[t])&&m(o[t])){var a={};if(at(r[t],o[t],a),a.break)return k(o,r),e.next(r),!1}else if(r[t]!==o[t])return k(o,r),e.next(r),!1}))},error:function(){e.error.apply(e,arguments)},complete:function(){e.complete()}});return function(){a.unsubscribe(),o={}}}))}}});t.Router=ot,t.operators=it,Object.defineProperty(t,"__esModule",{value:!0})}));
