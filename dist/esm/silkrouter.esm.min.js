import{Observable as t,fromEvent as e}from"rxjs";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=/:[^/]+/g,a=/^\/(?=[^?]*)/,u=/\[/,c=/([^[]+)\[([^[]*)\]/,s=/\[([^[]*)\]/,h=/[^[]+/,f=["route","hashRouting","path","hash","search","hashSearch","data"],l=n(""),p=n(!0),b=n(undefined),v=n({});n(0);var y=n((function(){})),g="push".concat("State"),d="replace".concat("State");function m(){return("undefined"==typeof globalThis?"undefined":n(globalThis))!==b?globalThis:global||self}var w=Array.isArray;function _(t){return n(t)===l?t.trim():""}function x(t){return t&&n(t)===v}function E(t){return n(t)===l&&a.test(t)}function S(t,e){if(t&&t.length)for(var r=0;r<t.length;r+=1)if(n(e)===y){var o=e.apply(t,[t[r],r]);if(n(o)===p){if(o)continue;break}}}var j=m();if(n(j.CustomEvent)===b){var k=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:undefined};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n};k.prototype=j.Event.prototype,j.CustomEvent=k}function O(t,e){x(t)&&Object.keys(t).forEach((function(n){e[n]=t[n]}))}function C(){for(var t=x(arguments.length<=0?void 0:arguments[0])?arguments.length<=0?void 0:arguments[0]:{},e=1;e<arguments.length;e++)O(e<0||arguments.length<=e?void 0:arguments[e],t);return t}Array.from||(Array.from=function(t){if(w(t))return t;for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e});var R=m();function A(t,e,r){t instanceof Node&&(t=[t]),function(t){return t instanceof NodeList||t instanceof HTMLCollection||Array.isArray(t)}(t)&&n(e)===l&&S(t,(function(t){var n=new R.CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r||[]});t.dispatchEvent(n)}))}var N=function t(e,n){r(this,t);var o=e[0],i=e[1],a=e[2],u=a.config,c=u.location,s=u.history;this.route=o.path,this.hashRouting=o.hash,this.routerInstance=a,this.virtualEvent=n||{},this.originalEvent=i||{},this.path=_(c.pathname),this.hash=c.hash,this.search=_(c.search.substring(1)),this.hashSearch=_(c.hash&&c.hash.split("?")[1]);var h=this.originalEvent.state;this.data=h&&h.data||s.state&&s.state.data};function T(){var e=this;return function(n){return new t((function(t){var r=n.subscribe({next:function(n){n.detail[2]===e&&t.next(new N(n.detail,n))},error:t.error,complete:t.complete});return function(){r.unsubscribe()}}))}}function I(){var t=this,n=this.config,r=n.context,o=n.location,i=n.hashRouting;this.popStateSubscription=e(m(),"popstate").subscribe((function(e){var n=_(i?o.hash.substring(1).split("?")[0]:o.pathname);n&&A(r,"vpushstate",[{path:n,hash:i},e,t])})),this.listeners=e(r,"vpushstate").pipe(T.apply(this)),i&&!o.hash&&this.set("/",!0,!1)}function L(t,e,r){x(r)?Object.keys(r).forEach((function(n){L(t,"".concat(e,"[").concat(w(r)?"":n,"]"),r[n])})):n(r)!==y&&t.push("".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(r)))}function P(t){var e=[];return x(t)?(Object.keys(t).forEach((function(n){L(e,n,t[n])})),e.join("&")):n(t)===l?t:""}var F=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))};function M(t){return u.test(t)}function U(t,e){var n=this;"?"===(t=_(t)).charAt(0)&&(t=t.replace("?",""));var r=Object.create(null);return t&&t.split("&").forEach((function(t){var o=t.split("=").map((function(t){return decodeURIComponent(t)}));(M(o[0])?H:Q).apply(n,o.concat([r,e,!1]))})),r}function z(t,e){return e?n(t)===b?[]:t:(r=t,o=Object.create(null),w(r)&&r.forEach((function(t,e){o[e]=t})),o);var r,o}function q(t,e){return x(r=t)&&!w(r)?{ob:t}:w(t)||n(t)===b?{ob:z(t,F(e))}:{ob:[t],push:null!==t};var r}function H(t,e,n,r){var o=t.match(c)||[];if(3===o.length){var i=o[1],a=o[2];if(M(t=t.replace(s,"")))""===a&&(a="0"),H(t=t.replace(h,a),e,n[i]=q(n[i],a).ob,r);else if(a){var u=q(n[i],a);n[i]=u.ob;var f=r?B(e):e;u.push?n[i].push(function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},a,f)):n[i][a]=f}else Q(i,e,n,r,!0)}}function Q(t,e,n,r,o){r&&(e=B(e)),t in n?(n[t]=w(n[t])?n[t]:[n[t]],n[t].push(e)):n[t]=o?[e]:e}function B(t){if(null==t)return"";if(n(t)!==l)return t;if(F(t=_(t)))return+t;switch(t){case"null":return null;case b:return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function D(t,e){var n=this.config.location,r=_(n.search&&n.search.substring(1)),o=_(e?n.hash.split("?")[1]:r);return o?P(C(U(r),U(o),U(t))):t}function G(t,e,r){r=r||!0;var o=this.config,i=o.preservePath,a=o.hashRouting,u=o.history,c=C({replace:e,exec:r},n(t)===l?{route:t}:t);e=c.replace,r=c.exec;var s=c.route,h=c.queryString,f=c.preserveQuery,p=c.data,b=c.pageTitle,v=void 0===b?null:b,y=s.split("?");if(x(h)&&(h=P(h)),h=_(h||y[1]),s=_(y[0]),f&&(h=D.apply(this,[h,a])),!E(s))throw new TypeError("Route string is not a pure route");var m=s;return a&&(s="/#".concat(s),i&&(s="".concat(s.substring(1)))),s="".concat(s).concat(h?"".concat("?"+h):""),u[e?d:g]({data:p},v,s),r&&m&&A(this.config.context,"vpushstate",[{path:m,hash:a},undefined,this]),this}function J(e){var n=this,r=this.config,o=r.hashRouting,i=r.location,a=_(o?i.hash.substring(1).split("?")[0]:i.pathname);return function(r){return new t((function(t){var i=r.subscribe(t);return e||(e=!0,a&&t.next(new N([{path:a,hash:o},undefined,n]))),function(){i.unsubscribe()}}))}}var K=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,t);var n=m(),o=n.history,i=n.location,a=n.document;if(!o[g])throw new Error("Current browser does not support history object");e=C({hashRouting:!1,preservePath:!1,context:a.body,location:i,history:o},e),this.config=Object.freeze(e),this.__paths__=[],I.apply(this)}var e,i,a;return e=t,(i=[{key:"pipe",value:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=this.listeners).pipe.apply(t,[J.apply(this)].concat(n))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe(J.apply(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return G.apply(this,e)}},{key:"destroy",value:function(t){n(t)===y&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}])&&o(e.prototype,i),a&&o(e,a),t}();function V(t,e){var n={};if(i.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(i.lastIndex=0,r.test(e)){var o=Array.from(t.match(i)).map((function(t){return t.replace(":","")})),a=Array.from(e.match(r));a.shift(),o.forEach((function(t,e){n[t]=a[e]}))}}return n}function W(t,e,n){S(Object.keys(t),(function(r){x(t[r])&&x(e[r])?W(t[r],e[r],n):n.break=t[r]!==e[r]}))}var X=Object.freeze({__proto__:null,route:function(e,r,o){if(n(r)===p&&(o=r,r=undefined),e=_(e),r instanceof K){var i=r.__paths__;-1===i.indexOf(e)&&i.push(e)}return function(n){return new t((function(t){var i=n.subscribe({next:function(n){var r=n.route;if(E(e)){o&&(e=e.toLowerCase(),r=r.toLowerCase());var i=V(e,r),a=Object.keys(i).length;(r===e||a>0)&&(a>0&&(n.params=i),t.next(n))}else t.error(new Error("Route string is not a pure route"))},error:t.error,complete:t.complete});return function(){if(r instanceof K){var t=r.__paths__,n=t.indexOf(e);n>-1&&t.splice(n,1)}i.unsubscribe()}}))}},deparam:function(e){return function(n){return new t((function(t){var r=n.subscribe({next:function(n){try{n.search=U(n.search,e),n.hashSearch=U(n.hashSearch,e),t.next(n)}catch(e){t.error(e)}},error:t.error,complete:t.complete});return function(){r.unsubscribe()}}))}},noMatch:function(e){return function(n){return new t((function(t){var r=n.subscribe({next:function(n){if(e instanceof K){var r=e.__paths__;if(r.length>0){for(var o=n.route,i=!1,a=0;a<r.length;a++)if(r[a]===o||Object.keys(V(r[a],o)).length){i=!0;break}i||(n.noMatch=!0,t.next(n))}}},error:t.error,complete:t.complete});return function(){r.unsubscribe()}}))}},cache:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,r=arguments.length>1?arguments[1]:void 0,o={};return n(e)===p&&(r=e,e=f),function(n){return new t((function(t){var i=n.subscribe({next:function(n){S(e,(function(e){if(r&&x(n[e])&&x(o[e])){var i={};if(W(n[e],o[e],i),i.break)return C(o,n),t.next(n),!1}else if(n[e]!==o[e])return C(o,n),t.next(n),!1}))},error:t.error,complete:t.complete});return function(){i.unsubscribe(),o={}}}))}}});export{K as Router,X as operators};
