import{Observable as t,fromEvent as n}from"rxjs";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,n,e){return n&&o(t.prototype,n),e&&o(t,e),t}function i(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function c(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==e)return;var r,o,a=[],i=!0,c=!1;try{for(e=e.call(t);!(i=(r=e.next()).done)&&(a.push(r.value),!n||a.length!==n);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==e.return||e.return()}finally{if(c)throw o}}return a}(t,n)||s(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,n){if(t){if("string"==typeof t)return l(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(t,n):void 0}}function l(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}var f=/:[^/]+/g,h=/^\/(?=[^?]*)/,p=/\[/,v=/([^[]+)\[([^[]*)\]/,d=/\[([^[]*)\]/,y=/[^[]+/,_="Route string is not a pure route",b=["localhost","0.0.0.0","127.0.0.1",null],x=["route","hashRouting","path","hash","search","hashSearch","data"],m=Array.isArray;function g(t){return"string"==typeof t?t.trim():""}function w(t){return t&&"object"===e(t)}function S(t){return w(t)&&!m(t)}function C(t){return"string"==typeof t&&h.test(t)}function k(t,n){return Object.prototype.hasOwnProperty.call(t,n)}function E(t,n){if(t&&t.length)for(var e=0;e<t.length;e+=1)if("function"==typeof n){var r=n.apply(t,[t[e],e]);if("boolean"==typeof r){if(r)continue;break}}}function j(t,n){w(t)&&Object.keys(t).forEach((function(e){n[e]=t[e]}))}function O(){for(var t=w(arguments[0])?arguments[0]:{},n=1;n<arguments.length;n++)j(arguments[n],t);return t}if(void 0===window.CustomEvent){var A=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var e=document.createEvent("CustomEvent");return e.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),e};A.prototype=window.Event.prototype,window.CustomEvent=A}function I(t,n,e){t instanceof Node&&(t=[t]),function(t){return t instanceof NodeList||t instanceof HTMLCollection||Array.isArray(t)}(t)&&"string"==typeof n&&E(t,(function(t){var r=new window.CustomEvent(n,{bubbles:!0,cancelable:!0,detail:e||[]});t.dispatchEvent(r)}))}var M=window.location,R=String.fromCharCode;function T(t,n,e){t.context_data_position==n-1?(t.context_data_position=0,t.context_data.push(e(t.context_data_val)),t.context_data_val=0):t.context_data_position++}function N(t){t.context_enlargeIn--,0==t.context_enlargeIn&&(t.context_enlargeIn=Math.pow(2,t.context_numBits),t.context_numBits++)}function B(t,n,e){if(k(t.context_dictionaryToCreate,t.context_w)){if(t.context_w.charCodeAt(0)<256){for(var r=0;r<t.context_numBits;r++)t.context_data_val=t.context_data_val<<1,T(t,n,e);t.value=t.context_w.charCodeAt(0);for(var o=0;o<8;o++)t.context_data_val=t.context_data_val<<1|1&t.value,T(t,n,e),t.value=t.value>>1}else{t.value=1;for(var a=0;a<t.context_numBits;a++)t.context_data_val=t.context_data_val<<1|t.value,T(t,n,e),t.value=0;t.value=t.context_w.charCodeAt(0);for(var i=0;i<16;i++)t.context_data_val=t.context_data_val<<1|1&t.value,T(t,n,e),t.value=t.value>>1}N(t),delete t.context_dictionaryToCreate[t.context_w]}else{t.value=t.context_dictionary[t.context_w];for(var c=0;c<t.context_numBits;c++)t.context_data_val=t.context_data_val<<1|1&t.value,T(t,n,e),t.value=t.value>>1}N(t)}function P(t,n,e,r){for(var o=0,a=1;a!==n;){var i=t.val&t.position;t.position>>=1,0===t.position&&(t.position=e,t.val=r(t.index++)),o|=(i>0?1:0)*a,a<<=1}return o}function z(t){return null==t?"":function(t,n,e){if(null==t)return"";for(var r={context_dictionary:{},context_dictionaryToCreate:{},context_data:[],context_c:"",context_wc:"",context_w:"",context_enlargeIn:2,context_dictSize:3,context_numBits:2,context_data_val:0,context_data_position:0},o=0,a=0;a<t.length;a+=1)r.context_c=t.charAt(a),k(r.context_dictionary,r.context_c)||(r.context_dictionary[r.context_c]=r.context_dictSize++,r.context_dictionaryToCreate[r.context_c]=!0),r.context_wc=r.context_w+r.context_c,k(r.context_dictionary,r.context_wc)?r.context_w=r.context_wc:(B(r,n,e),r.context_dictionary[r.context_wc]=r.context_dictSize++,r.context_w=String(r.context_c));for(""!==r.context_w&&B(r,n,e),r.value=2,o=0;o<r.context_numBits;o++)r.context_data_val=r.context_data_val<<1|1&r.value,T(r,n,e),r.value=r.value>>1;for(;;){if(r.context_data_val=r.context_data_val<<1,r.context_data_position==n-1){r.context_data.push(e(r.context_data_val));break}r.context_data_position++}return r.context_data.join("")}(t,15,(function(t){return R(t+32)}))+" "}function D(t){return null==t?"":""===t?null:function(t,n,e){for(var r,o,a=[],i={val:e(0),position:n,index:1},c=[],u=4,s=4,l=3,f="",h=0;h<3;h++)a[h]=h;switch(P(i,Math.pow(2,2),n,e)){case 0:o=R(P(i,Math.pow(2,8),n,e));break;case 1:o=R(P(i,Math.pow(2,16),n,e));break;case 2:return""}for(a[3]=o,r=o,c.push(o);;){if(i.index>t)return"";switch(o=P(i,Math.pow(2,l),n,e)){case 0:a[s++]=R(P(i,Math.pow(2,8),n,e)),o=s-1,u--;break;case 1:a[s++]=R(P(i,Math.pow(2,16),n,e)),o=s-1,u--;break;case 2:return c.join("")}if(0===u&&(u=Math.pow(2,l),l++),a[o])f=a[o];else{if(o!==s)return null;f=r+r.charAt(0)}c.push(f),a[s++]=r+f.charAt(0),r=f,0==--u&&(u=Math.pow(2,l),l++)}}(t.length,16384,(function(n){return t.charCodeAt(n)-32}))}function F(){try{return sessionStorage.setItem("testKey","testValue"),sessionStorage.removeItem("testKey"),!0}catch(t){return!1}}function U(t,n){return F()?sessionStorage.setItem(t,z(w(n)?JSON.stringify(n):n)):function(t,n){if(t&&void 0!==n){var e=M.hostname,r="https:"===M.protocol,o=n;w(n)&&(o=JSON.stringify(n));var a=-1===b.indexOf(e)?"; domain=".concat(g(e)):"",i=r?"; secure":"";document.cookie="".concat(t," = ").concat(o).concat(a).concat("; path=/").concat(i)}}(t,n)}function L(t){if(F()){var n=D(sessionStorage.getItem(t));try{return n=JSON.parse(n)}catch(t){return n}}return function(t){if(t){var n=decodeURIComponent(document.cookie),e="";return E(n.split(";"),(function(n){var r="".concat(t,"="),o=n.indexOf(r);if(o>-1)return e=g(n.substring(o+r.length,n.length)),!1})),e}return""}(t)}var J={set:function(){return U.apply(this,arguments)},get:function(){return L.apply(this,arguments)}},q=new(function(){function t(){r(this,t)}return a(t,[{key:"getDataFromStore",value:function(t){return O(J.get("routeStore"))[t]}},{key:"setDataToStore",value:function(t,n){var e=O(J.get("routeStore"));return!(e[t]&&(!n||S(n)&&0===Object.keys(n).length))&&J.set("routeStore",O({},e,i({},t,n)))}}]),t}()),K=function t(n,e){r(this,t);var o=c(n,3),a=o[0],i=o[1],u=o[2],s=u.config,l=s.location,f=s.preservePath;this.route=a.path,this.hashRouting=a.hash,this.routerInstance=u,this.virtualEvent=e||{},this.originalEvent=i||{},this.path=g(l.pathname),this.hash=l.hash,this.search=g(l.search.substring(1)),this.hashSearch=g(l.hash&&l.hash.split("?")[1]);var h=a.path;this.hashRouting&&(h="/#".concat(h),f&&(h="".concat(l.pathname).concat(h.substring(1)))),q.setDataToStore(h,this.originalEvent.state&&this.originalEvent.state.data),this.data=q.getDataFromStore(h)};function H(){var n=this;return function(e){return new t((function(t){var r=e.subscribe({next:function(e){c(e.detail,3)[2]===n&&t.next(new K(e.detail,e))},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){r.unsubscribe()}}))}}function Q(){var t=this,e=this.config,r=e.context,o=e.location,a=e.hashRouting;this.popStateSubscription=n(window,"popstate").subscribe((function(n){var e=g(a?o.hash.substring(1).split("?")[0]:o.pathname);e&&I(r,"vpushstate",[{path:e,hash:a},n,t])})),this.listeners=n(r,"vpushstate").pipe(H.apply(this)),a&&!o.hash&&this.set("/",!0,!1)}function V(t,n,e){w(e)?Object.keys(e).forEach((function(r){V(t,"".concat(n,"[").concat(m(e)?"":r,"]"),e[r])})):"function"!=typeof e&&t.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(e)))}function $(t){var n=[];return w(t)?(Object.keys(t).forEach((function(e){V(n,e,t[e])})),n.join("&")):"string"==typeof t?t:""}var G=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))};function W(t){return p.test(t)}function X(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.search,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"?"===(n=g(n)).charAt(0)&&(n=n.replace("?",""));var r=Object.create(null);return n&&n.split("&").forEach((function(n){var o=n.split("=").map((function(t){return decodeURIComponent(t)}));(W(o[0])?tt:nt).apply(t,[].concat(u(o),[r,e,!1]))})),r}function Y(t,n){return n?void 0===t?[]:t:(e=t,r=Object.create(null),m(e)&&e.forEach((function(t,n){r[n]=t})),r);var e,r}function Z(t,n){return S(t)?{ob:t}:m(t)||void 0===t?{ob:Y(t,G(n))}:{ob:[t],push:null!==t}}function tt(t,n,e,r){var o=t.match(v)||[];if(3===o.length){var a=o[1],c=o[2];if(W(t=t.replace(d,"")))""===c&&(c="0"),tt(t=t.replace(y,c),n,e[a]=Z(e[a],c).ob,r);else if(c){var u=Z(e[a],c);e[a]=u.ob;var s=r?et(n):n;u.push?e[a].push(i({},c,s)):e[a][c]=s}else nt(a,n,e,r,!0)}}function nt(t,n,e,r,o){r&&(n=et(n)),t in e?(e[t]=m(e[t])?e[t]:[e[t]],e[t].push(n)):e[t]=o?[n]:n}function et(t){if(null==t)return"";if("string"!=typeof t)return t;if(G(t=g(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function rt(){return X.apply(this,arguments)}function ot(t,n){var e=this.config.location,r=g(e.search&&e.search.substring(1)),o=g(n?e.hash.split("?")[1]:r);return o?$(O(rt(r),rt(o),rt(t))):t}function at(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.config,o=r.preservePath,a=r.hashRouting,i=r.location,c=r.history,u=O({replace:n,exec:e},"string"==typeof t?{route:t}:t);n=u.replace,e=u.exec;var s=u.route,l=u.queryString,f=u.preserveQuery,h=u.data,p=u.pageTitle,v=void 0===p?document.querySelector("head title").textContent:p,d=s.split("?");if(w(l)&&(l=$(l)),l=g(l||d[1]),s=g(d[0]),f&&(l=ot.apply(this,[l,a])),!C(s))throw new TypeError(_);var y=s;return a&&(s="/#".concat(s),o&&(s="".concat(s.substring(1)))),q.setDataToStore(o?"".concat(i.pathname).concat(s):s,h),s="".concat(s).concat(l?"?".concat(l):""),c[n?"replaceState":"pushState"]({data:h},v,s),e&&y&&I(this.config.context,"vpushstate",[{path:y,hash:a},void 0,this]),this}function it(n){var e=this,r=this.config,o=r.hashRouting,a=r.location,i=g(o?a.hash.substring(1).split("?")[0]:a.pathname);return function(r){return new t((function(t){var a=r.subscribe({next:function(){t.next.apply(t,arguments)},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return n||(n=!0,i&&t.next(new K([{path:i,hash:o},void 0,e]))),function(){a.unsubscribe()}}))}}var ct=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(r(this,t),!window.history.pushState)throw new Error("Current browser does not support history object");n=O({hashRouting:!1,preservePath:!1,context:document.body,location:window.location,history:window.history},n),this.config=Object.freeze(n),this.__paths__=[],Q.apply(this)}return a(t,[{key:"pipe",value:function(){var t;return(t=this.listeners).pipe.apply(t,[it.apply(this)].concat(Array.prototype.slice.call(arguments)))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe(it.apply(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){return at.apply(this,arguments)}},{key:"destroy",value:function(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}]),t}();function ut(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M.pathname,e={};if(f.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(f.lastIndex=0,r.test(n)){var o=u(t.match(f)).map((function(t){return t.replace(":","")})),a=u(n.match(r));a.shift(),o.forEach((function(t,n){e[t]=a[n]}))}}return e}function st(t,n,e){E(Object.keys(t),(function(r){w(t[r])&&w(n[r])?st(t[r],n[r],e):e.break=t[r]!==n[r]}))}var lt=Object.freeze({__proto__:null,route:function(n,e,r){if("boolean"==typeof e&&(r=e,e=void 0),n=g(n),e instanceof ct){var o=e.__paths__;-1===o.indexOf(n)&&o.push(n)}return function(o){return new t((function(t){var a=o.subscribe({next:function(e){var o=e.route;if(C(n)){r&&(n=n.toLowerCase(),o=o.toLowerCase());var a=ut(n,o),i=Object.keys(a).length;(o===n||i>0)&&(i>0&&(e.params=a),t.next(e))}else t.error(new Error(_))},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){if(e instanceof ct){var t=e.__paths__,r=t.indexOf(n);r>-1&&t.splice(r,1)}a.unsubscribe()}}))}},deparam:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e){return new t((function(t){var r=e.subscribe({next:function(e){try{e.search=rt(e.search,n),e.hashSearch=rt(e.hashSearch,n),t.next(e)}catch(n){t.error(n)}},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){r.unsubscribe()}}))}},noMatch:function(n){return function(e){return new t((function(t){var r=e.subscribe({next:function(e){if(n instanceof ct){var r=n.__paths__;if(r.length>0){for(var o=e.route,a=!1,i=0;i<r.length;i++)if(r[i]===o||Object.keys(ut(r[i],o)).length){a=!0;break}a||(e.noMatch=!0,t.next(e))}}},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){r.unsubscribe()}}))}},cache:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={};return"boolean"==typeof n&&(e=n,n=x),function(o){return new t((function(t){var a=o.subscribe({next:function(o){E(n,(function(n){if(e&&w(o[n])&&w(r[n])){var a={};if(st(o[n],r[n],a),a.break)return O(r,o),t.next(o),!1}else if(o[n]!==r[n])return O(r,o),t.next(o),!1}))},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){a.unsubscribe(),r={}}}))}}});export{ct as Router,lt as operators};
