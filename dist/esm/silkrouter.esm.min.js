import{Observable as t,fromEvent as n}from"rxjs";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==e)return;var r,o,i=[],a=!0,u=!1;try{for(e=e.call(t);!(a=(r=e.next()).done)&&(i.push(r.value),!n||i.length!==n);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==e.return||e.return()}finally{if(u)throw o}}return i}(t,n)||u(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,n){if(t){if("string"==typeof t)return c(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?c(t,n):void 0}}function c(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}var s=/:[^/]+/g,f=/^\/(?=[^?]*)/,h=/\[/,l=/([^[]+)\[([^[]*)\]/,p=/\[([^[]*)\]/,b=/[^[]+/,y="Route string is not a pure route",v=["route","hashRouting","path","hash","search","hashSearch","data"],d=Array.isArray;function m(t){return"string"==typeof t?t.trim():""}function g(t){return t&&"object"===e(t)}function w(t){return"string"==typeof t&&f.test(t)}function x(t,n){if(t&&t.length)for(var e=0;e<t.length;e+=1)if("function"==typeof n){var r=n.apply(t,[t[e],e]);if("boolean"==typeof r){if(r)continue;break}}}function S(t,n){g(t)&&Object.keys(t).forEach((function(e){n[e]=t[e]}))}function E(){for(var t=g(arguments[0])?arguments[0]:{},n=1;n<arguments.length;n++)S(arguments[n],t);return t}if(void 0===window.CustomEvent){var _=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var e=document.createEvent("CustomEvent");return e.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),e};_.prototype=window.Event.prototype,window.CustomEvent=_}function j(t,n,e){t instanceof Node&&(t=[t]),function(t){return t instanceof NodeList||t instanceof HTMLCollection||Array.isArray(t)}(t)&&"string"==typeof n&&x(t,(function(t){var r=new window.CustomEvent(n,{bubbles:!0,cancelable:!0,detail:e||[]});t.dispatchEvent(r)}))}var O=function t(n,e){r(this,t);var o=i(n,3),a=o[0],u=o[1],c=o[2],s=c.config,f=s.location,h=s.history;this.route=a.path,this.hashRouting=a.hash,this.routerInstance=c,this.virtualEvent=e||{},this.originalEvent=u||{},this.path=m(f.pathname),this.hash=f.hash,this.search=m(f.search.substring(1)),this.hashSearch=m(f.hash&&f.hash.split("?")[1]);var l=this.originalEvent.state;this.data=l&&l.data||h.state&&h.state.data};function k(){var n=this;return function(e){return new t((function(t){var r=e.subscribe({next:function(e){i(e.detail,3)[2]===n&&t.next(new O(e.detail,e))},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){r.unsubscribe()}}))}}function A(){var t=this,e=this.config,r=e.context,o=e.location,i=e.hashRouting;this.popStateSubscription=n(window,"popstate").subscribe((function(n){var e=m(i?o.hash.substring(1).split("?")[0]:o.pathname);e&&j(r,"vpushstate",[{path:e,hash:i},n,t])})),this.listeners=n(r,"vpushstate").pipe(k.apply(this)),i&&!o.hash&&this.set("/",!0,!1)}function C(t,n,e){g(e)?Object.keys(e).forEach((function(r){C(t,"".concat(n,"[").concat(d(e)?"":r,"]"),e[r])})):"function"!=typeof e&&t.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(e)))}function R(t){var n=[];return g(t)?(Object.keys(t).forEach((function(e){C(n,e,t[e])})),n.join("&")):"string"==typeof t?t:""}var I=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},N=window.location;function T(t){return h.test(t)}function L(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.search,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"?"===(n=m(n)).charAt(0)&&(n=n.replace("?",""));var r=Object.create(null);return n&&n.split("&").forEach((function(n){var o=n.split("=").map((function(t){return decodeURIComponent(t)}));(T(o[0])?U:F).apply(t,[].concat(a(o),[r,e,!1]))})),r}function M(t,n){return n?void 0===t?[]:t:(e=t,r=Object.create(null),d(e)&&e.forEach((function(t,n){r[n]=t})),r);var e,r}function P(t,n){return g(e=t)&&!d(e)?{ob:t}:d(t)||void 0===t?{ob:M(t,I(n))}:{ob:[t],push:null!==t};var e}function U(t,n,e,r){var o=t.match(l)||[];if(3===o.length){var i=o[1],a=o[2];if(T(t=t.replace(p,"")))""===a&&(a="0"),U(t=t.replace(b,a),n,e[i]=P(e[i],a).ob,r);else if(a){var u=P(e[i],a);e[i]=u.ob;var c=r?q(n):n;u.push?e[i].push(function(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}({},a,c)):e[i][a]=c}else F(i,n,e,r,!0)}}function F(t,n,e,r,o){r&&(n=q(n)),t in e?(e[t]=d(e[t])?e[t]:[e[t]],e[t].push(n)):e[t]=o?[n]:n}function q(t){if(null==t)return"";if("string"!=typeof t)return t;if(I(t=m(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function z(){return L.apply(this,arguments)}function H(t,n){var e=this.config.location,r=m(e.search&&e.search.substring(1)),o=m(n?e.hash.split("?")[1]:r);return o?R(E(z(r),z(o),z(t))):t}function Q(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.config,o=r.preservePath,i=r.hashRouting,a=r.history,u=E({replace:n,exec:e},"string"==typeof t?{route:t}:t);n=u.replace,e=u.exec;var c=u.route,s=u.queryString,f=u.preserveQuery,h=u.data,l=u.pageTitle,p=void 0===l?document.querySelector("head > title").textContent:l,b=c.split("?");if(g(s)&&(s=R(s)),s=m(s||b[1]),c=m(b[0]),f&&(s=H.apply(this,[s,i])),!w(c))throw new TypeError(y);var v=c;return i&&(c="/#".concat(c),o&&(c="".concat(c.substring(1)))),c="".concat(c).concat(s?"?".concat(s):""),a[n?"replaceState":"pushState"]({data:h},p,c),e&&v&&j(this.config.context,"vpushstate",[{path:v,hash:i},void 0,this]),this}function $(n){var e=this,r=this.config,o=r.hashRouting,i=r.location,a=m(o?i.hash.substring(1).split("?")[0]:i.pathname);return function(r){return new t((function(t){var i=r.subscribe({next:function(){t.next.apply(t,arguments)},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return n||(n=!0,a&&t.next(new O([{path:a,hash:o},void 0,e]))),function(){i.unsubscribe()}}))}}var B=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(r(this,t),!window.history.pushState)throw new Error("Current browser does not support history object");n=E({hashRouting:!1,preservePath:!1,context:document.body,location:window.location,history:window.history},n),this.config=Object.freeze(n),this.__paths__=[],A.apply(this)}var n,e,i;return n=t,(e=[{key:"pipe",value:function(){var t;return(t=this.listeners).pipe.apply(t,[$.apply(this)].concat(Array.prototype.slice.call(arguments)))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe($.apply(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){return Q.apply(this,arguments)}},{key:"destroy",value:function(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}])&&o(n.prototype,e),i&&o(n,i),t}();function D(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.pathname,e={};if(s.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(s.lastIndex=0,r.test(n)){var o=a(t.match(s)).map((function(t){return t.replace(":","")})),i=a(n.match(r));i.shift(),o.forEach((function(t,n){e[t]=i[n]}))}}return e}function G(t,n,e){x(Object.keys(t),(function(r){g(t[r])&&g(n[r])?G(t[r],n[r],e):e.break=t[r]!==n[r]}))}var J=Object.freeze({__proto__:null,route:function(n,e,r){if("boolean"==typeof e&&(r=e,e=void 0),n=m(n),e instanceof B){var o=e.__paths__;-1===o.indexOf(n)&&o.push(n)}return function(o){return new t((function(t){var i=o.subscribe({next:function(e){var o=e.route;if(w(n)){r&&(n=n.toLowerCase(),o=o.toLowerCase());var i=D(n,o),a=Object.keys(i).length;(o===n||a>0)&&(a>0&&(e.params=i),t.next(e))}else t.error(new Error(y))},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){if(e instanceof B){var t=e.__paths__,r=t.indexOf(n);r>-1&&t.splice(r,1)}i.unsubscribe()}}))}},deparam:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e){return new t((function(t){var r=e.subscribe({next:function(e){try{e.search=z(e.search,n),e.hashSearch=z(e.hashSearch,n),t.next(e)}catch(n){t.error(n)}},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){r.unsubscribe()}}))}},noMatch:function(n){return function(e){return new t((function(t){var r=e.subscribe({next:function(e){if(n instanceof B){var r=n.__paths__;if(r.length>0){for(var o=e.route,i=!1,a=0;a<r.length;a++)if(r[a]===o||Object.keys(D(r[a],o)).length){i=!0;break}i||(e.noMatch=!0,t.next(e))}}},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){r.unsubscribe()}}))}},cache:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={};return"boolean"==typeof n&&(e=n,n=v),function(o){return new t((function(t){var i=o.subscribe({next:function(o){x(n,(function(n){if(e&&g(o[n])&&g(r[n])){var i={};if(G(o[n],r[n],i),i.break)return E(r,o),t.next(o),!1}else if(o[n]!==r[n])return E(r,o),t.next(o),!1}))},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){i.unsubscribe(),r={}}}))}}});export{B as Router,J as operators};
