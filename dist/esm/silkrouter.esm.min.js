import{Observable as t,fromEvent as n}from"rxjs";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function r(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,n,e){return n&&r(t.prototype,n),e&&r(t,e),t}function i(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function c(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==e)return;var o,r,a=[],i=!0,c=!1;try{for(e=e.call(t);!(i=(o=e.next()).done)&&(a.push(o.value),!n||a.length!==n);i=!0);}catch(t){c=!0,r=t}finally{try{i||null==e.return||e.return()}finally{if(c)throw r}}return a}(t,n)||s(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,n){if(t){if("string"==typeof t)return l(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(t,n):void 0}}function l(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,o=new Array(n);e<n;e++)o[e]=t[e];return o}var f=/:[^/]+/g,h=/^\/(?=[^?]*)/,p=/\[/,v=/([^[]+)\[([^[]*)\]/,d=/\[([^[]*)\]/,y=/[^[]+/,_="Route string is not a pure route",b=["localhost","0.0.0.0","127.0.0.1",null],x=["route","hashRouting","path","hash","search","hashSearch","data"],g=Array.isArray;function m(t){return"string"==typeof t?t.trim():""}function w(t){return t=m("".concat(t)),!(["null","undefined",""].indexOf(t)>-1)&&!isNaN(+t)}function S(t){return t&&"object"===e(t)}function C(t){return S(t)&&!g(t)}function k(t){return"string"==typeof t&&h.test(t)}function E(t,n){return Object.prototype.hasOwnProperty.call(t,n)}function O(t,n){if(t&&t.length)for(var e=0;e<t.length;e+=1)if("function"==typeof n){var o=n.apply(t,[t[e],e]);if("boolean"==typeof o){if(o)continue;break}}}function j(t,n){S(t)&&Object.keys(t).forEach((function(e){n[e]=t[e]}))}function A(){for(var t=S(arguments[0])?arguments[0]:{},n=1;n<arguments.length;n++)j(arguments[n],t);return t}if(void 0===window.CustomEvent){var I=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var e=document.createEvent("CustomEvent");return e.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),e};I.prototype=window.Event.prototype,window.CustomEvent=I}function M(t,n,e){t instanceof Node&&(t=[t]),function(t){return t instanceof NodeList||t instanceof HTMLCollection||Array.isArray(t)}(t)&&"string"==typeof n&&O(t,(function(t){var o=new window.CustomEvent(n,{bubbles:!0,cancelable:!0,detail:e||[]});t.dispatchEvent(o)}))}var R=window.location,T=String.fromCharCode;function N(t,n,e){t.context_data_position==n-1?(t.context_data_position=0,t.context_data.push(e(t.context_data_val)),t.context_data_val=0):t.context_data_position++}function B(t){t.context_enlargeIn--,0==t.context_enlargeIn&&(t.context_enlargeIn=Math.pow(2,t.context_numBits),t.context_numBits++)}function P(t,n,e){if(E(t.context_dictionaryToCreate,t.context_w)){if(t.context_w.charCodeAt(0)<256){for(var o=0;o<t.context_numBits;o++)t.context_data_val=t.context_data_val<<1,N(t,n,e);t.value=t.context_w.charCodeAt(0);for(var r=0;r<8;r++)t.context_data_val=t.context_data_val<<1|1&t.value,N(t,n,e),t.value=t.value>>1}else{t.value=1;for(var a=0;a<t.context_numBits;a++)t.context_data_val=t.context_data_val<<1|t.value,N(t,n,e),t.value=0;t.value=t.context_w.charCodeAt(0);for(var i=0;i<16;i++)t.context_data_val=t.context_data_val<<1|1&t.value,N(t,n,e),t.value=t.value>>1}B(t),delete t.context_dictionaryToCreate[t.context_w]}else{t.value=t.context_dictionary[t.context_w];for(var c=0;c<t.context_numBits;c++)t.context_data_val=t.context_data_val<<1|1&t.value,N(t,n,e),t.value=t.value>>1}B(t)}function z(t,n,e,o){for(var r=0,a=1;a!==n;){var i=t.val&t.position;t.position>>=1,0===t.position&&(t.position=e,t.val=o(t.index++)),r|=(i>0?1:0)*a,a<<=1}return r}function D(t){return null==t?"":function(t,n,e){if(null==t)return"";for(var o={context_dictionary:{},context_dictionaryToCreate:{},context_data:[],context_c:"",context_wc:"",context_w:"",context_enlargeIn:2,context_dictSize:3,context_numBits:2,context_data_val:0,context_data_position:0},r=0,a=0;a<t.length;a+=1)o.context_c=t.charAt(a),E(o.context_dictionary,o.context_c)||(o.context_dictionary[o.context_c]=o.context_dictSize++,o.context_dictionaryToCreate[o.context_c]=!0),o.context_wc=o.context_w+o.context_c,E(o.context_dictionary,o.context_wc)?o.context_w=o.context_wc:(P(o,n,e),o.context_dictionary[o.context_wc]=o.context_dictSize++,o.context_w=String(o.context_c));for(""!==o.context_w&&P(o,n,e),o.value=2,r=0;r<o.context_numBits;r++)o.context_data_val=o.context_data_val<<1|1&o.value,N(o,n,e),o.value=o.value>>1;for(;;){if(o.context_data_val=o.context_data_val<<1,o.context_data_position==n-1){o.context_data.push(e(o.context_data_val));break}o.context_data_position++}return o.context_data.join("")}(t,15,(function(t){return T(t+32)}))+" "}function U(t){return null==t?"":""===t?null:function(t,n,e){for(var o,r,a=[],i={val:e(0),position:n,index:1},c=[],u=4,s=4,l=3,f="",h=0;h<3;h++)a[h]=h;switch(z(i,Math.pow(2,2),n,e)){case 0:r=T(z(i,Math.pow(2,8),n,e));break;case 1:r=T(z(i,Math.pow(2,16),n,e));break;case 2:return""}for(a[3]=r,o=r,c.push(r);;){if(i.index>t)return"";switch(r=z(i,Math.pow(2,l),n,e)){case 0:a[s++]=T(z(i,Math.pow(2,8),n,e)),r=s-1,u--;break;case 1:a[s++]=T(z(i,Math.pow(2,16),n,e)),r=s-1,u--;break;case 2:return c.join("")}if(0===u&&(u=Math.pow(2,l),l++),a[r])f=a[r];else{if(r!==s)return null;f=o+o.charAt(0)}c.push(f),a[s++]=o+f.charAt(0),o=f,0==--u&&(u=Math.pow(2,l),l++)}}(t.length,16384,(function(n){return t.charCodeAt(n)-32}))}function L(){try{return sessionStorage.setItem("testKey","testValue"),sessionStorage.removeItem("testKey"),!0}catch(t){return!1}}function J(t,n){return L()?sessionStorage.setItem(t,D(S(n)?JSON.stringify(n):n)):function(t,n){if(t&&void 0!==n){var e=R.hostname,o="https:"===R.protocol,r=n;S(n)&&(r=JSON.stringify(n));var a=-1===b.indexOf(e)?"; domain=".concat(m(e)):"",i=o?"; secure":"";document.cookie="".concat(t," = ").concat(r).concat(a).concat("; path=/").concat(i)}}(t,n)}function q(t){if(L()){var n=U(sessionStorage.getItem(t));try{return n=JSON.parse(n)}catch(t){return n}}return function(t){if(t){var n=decodeURIComponent(document.cookie),e="";return O(n.split(";"),(function(n){var o="".concat(t,"="),r=n.indexOf(o);if(r>-1)return e=m(n.substring(r+o.length,n.length)),!1})),e}return""}(t)}var F={set:function(){return J.apply(this,arguments)},get:function(){return q.apply(this,arguments)}},K=new(function(){function t(){o(this,t)}return a(t,[{key:"getDataFromStore",value:function(t){return A(F.get("routeStore"))[t]}},{key:"setDataToStore",value:function(t,n){var e=A(F.get("routeStore"));return!(e[t]&&(!n||C(n)&&0===Object.keys(n).length))&&F.set("routeStore",A({},e,i({},t,n)))}}]),t}()),H=function t(n,e){o(this,t);var r=c(n,3),a=r[0],i=r[1],u=r[2],s=u.config,l=s.location,f=s.preservePath;this.route=a.path,this.hashRouting=a.hash,this.routerInstance=u,this.virtualEvent=e||{},this.originalEvent=i||{},this.path=m(l.pathname),this.hash=l.hash,this.search=m(l.search.substring(1)),this.hashSearch=m(l.hash&&l.hash.split("?")[1]);var h=a.path;this.hashRouting&&(h="/#".concat(h),f&&(h="".concat(l.pathname).concat(h.substring(1)))),K.setDataToStore(h,this.originalEvent.state&&this.originalEvent.state.data),this.data=K.getDataFromStore(h)};function Q(){var n=this;return function(e){return new t((function(t){var o=e.subscribe({next:function(e){c(e.detail,3)[2]===n&&t.next(new H(e.detail,e))},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){o.unsubscribe()}}))}}function V(){var t=this,e=this.config,o=e.context,r=e.location,a=e.hashRouting;this.popStateSubscription=n(window,"popstate").subscribe((function(n){var e=m(a?r.hash.substring(1).split("?")[0]:r.pathname);e&&M(o,"vpushstate",[{path:e,hash:a},n,t])})),this.listeners=n(o,"vpushstate").pipe(Q.apply(this)),a&&!r.hash&&this.set("/",!0,!1)}function $(t,n,e){S(e)?Object.keys(e).forEach((function(o){$(t,"".concat(n,"[").concat(g(e)?"":o,"]"),e[o])})):"function"!=typeof e&&t.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(e)))}function G(t){var n=[];return S(t)?(Object.keys(t).forEach((function(e){$(n,e,t[e])})),n.join("&")):"string"==typeof t?t:""}function W(t){return p.test(t)}function X(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.search,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"?"===(n=m(n)).charAt(0)&&(n=n.replace("?",""));var o={};return n&&n.split("&").forEach((function(n){var r=n.split("=").map((function(t){return decodeURIComponent(t)}));(W(r[0])?tt:nt).apply(t,[].concat(u(r),[o,e,!1]))})),o}function Y(t,n){return n?void 0===t?[]:t:(o={},g(e=t)&&e.forEach((function(t,n){o[n]=t})),o);var e,o}function Z(t,n){return C(t)?{ob:t}:g(t)||void 0===t?{ob:Y(t,w(n))}:{ob:[t],push:null!==t}}function tt(t,n,e){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=t.match(v)||[];if(3===r.length){var a=r[1],c=r[2];if(W(t=t.replace(d,"")))""===c&&(c="0"),tt(t=t.replace(y,c),n,e[a]=Z(e[a],c).ob,o);else if(c){var u=Z(e[a],c);e[a]=u.ob;var s=o?et(n):n;u.push?e[a].push(i({},c,s)):e[a][c]=s}else nt(a,n,e,o,!0)}}function nt(t,n,e){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4?arguments[4]:void 0;o&&(n=et(n)),t in e?(e[t]=g(e[t])?e[t]:[e[t]],e[t].push(n)):e[t]=r?[n]:n}function et(t){if(null==t)return"";if("string"!=typeof t)return t;if(w(t=m(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function ot(){return X.apply(this,arguments)}function rt(t,n){var e=this.config.location,o=m(e.search&&e.search.substring(1)),r=m(n?e.hash.split("?")[1]:o);return r?G(A(ot(o),ot(r),ot(t))):t}function at(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=this.config,r=o.preservePath,a=o.hashRouting,i=o.location,c=o.history,u=A({replace:n,exec:e},"string"==typeof t?{route:t}:t);n=u.replace,e=u.exec;var s=u.route,l=u.queryString,f=u.preserveQuery,h=u.data,p=u.pageTitle,v=void 0===p?document.querySelector("head title").textContent:p,d=s.split("?");if(S(l)&&(l=G(l)),l=m(l||d[1]),s=m(d[0]),f&&(l=rt.apply(this,[l,a])),!k(s))throw new TypeError(_);var y=s;return a&&(s="/#".concat(s),r&&(s="".concat(s.substring(1)))),K.setDataToStore(r?"".concat(i.pathname).concat(s):s,h),s="".concat(s).concat(l?"?".concat(l):""),c[n?"replaceState":"pushState"]({data:h},v,s),e&&y&&M(this.config.context,"vpushstate",[{path:y,hash:a},void 0,this]),this}function it(n){var e=this,o=this.config,r=o.hashRouting,a=o.location,i=m(r?a.hash.substring(1).split("?")[0]:a.pathname);return function(o){return new t((function(t){var a=o.subscribe({next:function(){t.next.apply(t,arguments)},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return n||(n=!0,i&&t.next(new H([{path:i,hash:r},void 0,e]))),function(){a.unsubscribe()}}))}}var ct=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(o(this,t),!window.history.pushState)throw new Error("Current browser does not support history object");n=A({hashRouting:!1,preservePath:!1,context:document.body,location:window.location,history:window.history},n),this.config=Object.freeze(n),this.__paths__=[],V.apply(this)}return a(t,[{key:"pipe",value:function(){var t;return(t=this.listeners).pipe.apply(t,[it.apply(this)].concat(Array.prototype.slice.call(arguments)))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe(it.apply(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){return at.apply(this,arguments)}},{key:"destroy",value:function(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}]),t}();function ut(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.pathname,e={};if(f.test(t)){var o=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(f.lastIndex=0,o.test(n)){var r=u(t.match(f)).map((function(t){return t.replace(":","")})),a=u(n.match(o));a.shift(),r.forEach((function(t,n){e[t]=a[n]}))}}return e}function st(t,n,e){O(Object.keys(t),(function(o){S(t[o])&&S(n[o])?st(t[o],n[o],e):e.break=t[o]!==n[o]}))}var lt=Object.freeze({__proto__:null,route:function(n,e,o){if("boolean"==typeof e&&(o=e,e=void 0),n=m(n),e instanceof ct){var r=e.__paths__;-1===r.indexOf(n)&&r.push(n)}return function(r){return new t((function(t){var a=r.subscribe({next:function(e){var r=e.route;if(k(n)){o&&(n=n.toLowerCase(),r=r.toLowerCase());var a=ut(n,r),i=Object.keys(a).length;(r===n||i>0)&&(i>0&&(e.params=a),t.next(e))}else t.error(new Error(_))},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){if(e instanceof ct){var t=e.__paths__,o=t.indexOf(n);o>-1&&t.splice(o,1)}a.unsubscribe()}}))}},deparam:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e){return new t((function(t){var o=e.subscribe({next:function(e){try{e.search=ot(e.search,n),e.hashSearch=ot(e.hashSearch,n),t.next(e)}catch(n){t.error(n)}},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){o.unsubscribe()}}))}},noMatch:function(n){return function(e){return new t((function(t){var o=e.subscribe({next:function(e){if(n instanceof ct){var o=n.__paths__;if(o.length>0){for(var r=e.route,a=!1,i=0;i<o.length;i++)if(o[i]===r||Object.keys(ut(o[i],r)).length){a=!0;break}a||(e.noMatch=!0,t.next(e))}}},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){o.unsubscribe()}}))}},cache:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o={};return"boolean"==typeof n&&(e=n,n=x),function(r){return new t((function(t){var a=r.subscribe({next:function(r){O(n,(function(n){if(e&&S(r[n])&&S(o[n])){var a={};if(st(r[n],o[n],a),a.break)return A(o,r),t.next(r),!1}else if(r[n]!==o[n])return A(o,r),t.next(r),!1}))},error:function(){t.error.apply(t,arguments)},complete:function(){t.complete()}});return function(){a.unsubscribe(),o={}}}))}}});export{ct as Router,lt as operators};
