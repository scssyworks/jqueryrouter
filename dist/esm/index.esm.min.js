/**!
 * Router plugin for single page applications with routes
 * Released under MIT license
 * @name Silk router
 * @author Sachin Singh <contactsachinsingh@gmail.com>
 * @version 3.4.10
 * @license MIT
 */
const t=/:[^\/]+/g,e=/^\/(?=[^?]*)/,n=/\?.+/,o=["localhost","0.0.0.0","127.0.0.1",null],a=Array.isArray;function r(t){return"string"==typeof t?t.trim():""}function c(t){return t=r(`${t}`),!(["null","undefined",""].indexOf(t)>-1)&&!isNaN(+t)}function i(t){return t&&"object"==typeof t}function s(t){return i(t)&&!a(t)}function u(t,e){return void 0===t?e:t}function l(t){return Array.prototype.slice.call(t)}function h(t){return"string"==typeof t&&e.test(t)}function f(t){return"string"==typeof t&&"#"===t.charAt(0)}function p(t){return"function"==typeof t}function d(t,e){return{type:t,state:{data:e}}}function _(t){return t?Object.keys(t):[]}function x(t,e){return Object.prototype.hasOwnProperty.call(t,e)}const g=window.location,v=String.fromCharCode;function y(e,n){n=u(n,g.pathname);const o={};if(t.test(e)){const a=new RegExp(e.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)"));if(t.lastIndex=0,a.test(n)){const r=l(e.match(t)).map(t=>t.replace(":","")),c=l(n.match(a));c.shift(),r.forEach((t,e)=>{o[t]=c[e]})}}return o}function m(t){let e=[];return i(t)?(_(t).forEach(n=>{!function t(e,n,o){i(o)?_(o).forEach(r=>{t(e,`${n}[${a(o)?"":r}]`,o[r])}):"function"!=typeof o&&e.push(`${encodeURIComponent(n)}=${encodeURIComponent(o)}`)}(e,n,t[n])}),e.join("&")):"string"==typeof t?t:""}function w(t){return/\[/.test(t)}function $(t,e){"?"===(t=r(u(t,g.search))).charAt(0)&&(t=t.replace("?",""));const n={};return t&&t.split("&").forEach(t=>{const o=t.split("=").map(t=>decodeURIComponent(t));(w(o[0])?C:E).apply(this,[].concat(o,[n,u(e,!1),!1]))}),n}function b(t,e){return e?void 0===t?[]:t:(o={},a(n=t)&&n.forEach((t,e)=>{o[e]=t}),o);var n,o}function S(t,e){return s(t)?{ob:t}:a(t)||void 0===t?{ob:b(t,c(e))}:{ob:[t],push:null!==t}}function C(t,e,n,o){o=u(o,!0);const a=t.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===a.length){const r=a[1];let c=a[2];if(w(t=t.replace(/\[([^\[]*)\]/,"")))""===c&&(c="0"),C(t=t.replace(/[^\[]+/,c),e,n[r]=S(n[r],c).ob,o);else if(c){const t=S(n[r],c);n[r]=t.ob;const a=o?I(e):e;if(t.push){const t={};t[c]=a,n[r].push(t)}else n[r][c]=a}else E(r,e,n,o,!0)}}function E(t,e,n,o,r){u(o,!0)&&(e=I(e)),t in n?(n[t]=a(n[t])?n[t]:[n[t]],n[t].push(e)):n[t]=r?[e]:e}function I(t){if(null==t)return"";if("string"!=typeof t)return t;if(c(t=r(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function A(){return $.apply(this,arguments)}function O(t,e){i(t)&&_(t).forEach((function(n){e[n]=t[n]}))}function M(){const t=i(arguments[0])?arguments[0]:{};for(let e=1;e<arguments.length;e++)O(arguments[e],t);return t}function N(t,e,n){t.context_data_position==e-1?(t.context_data_position=0,t.context_data.push(n(t.context_data_val)),t.context_data_val=0):t.context_data_position++}function k(t){t.context_enlargeIn--,0==t.context_enlargeIn&&(t.context_enlargeIn=2**t.context_numBits,t.context_numBits++)}function T(t,e,n){if(x(t.context_dictionaryToCreate,t.context_w)){if(t.context_w.charCodeAt(0)<256){for(let o=0;o<t.context_numBits;o++)t.context_data_val=t.context_data_val<<1,N(t,e,n);t.value=t.context_w.charCodeAt(0);for(let o=0;o<8;o++)t.context_data_val=t.context_data_val<<1|1&t.value,N(t,e,n),t.value=t.value>>1}else{t.value=1;for(let o=0;o<t.context_numBits;o++)t.context_data_val=t.context_data_val<<1|t.value,N(t,e,n),t.value=0;t.value=t.context_w.charCodeAt(0);for(let o=0;o<16;o++)t.context_data_val=t.context_data_val<<1|1&t.value,N(t,e,n),t.value=t.value>>1}k(t),delete t.context_dictionaryToCreate[t.context_w]}else{t.value=t.context_dictionary[t.context_w];for(let o=0;o<t.context_numBits;o++)t.context_data_val=t.context_data_val<<1|1&t.value,N(t,e,n),t.value=t.value>>1}k(t)}function D(t,e,n,o){let a=0,r=1;for(;r!==e;){const e=t.val&t.position;t.position>>=1,0===t.position&&(t.position=n,t.val=o(t.index++)),a|=(e>0?1:0)*r,r<<=1}return a}function j(t){return null==t?"":function(t,e,n){if(null==t)return"";const o={context_dictionary:{},context_dictionaryToCreate:{},context_data:[],context_c:"",context_wc:"",context_w:"",context_enlargeIn:2,context_dictSize:3,context_numBits:2,context_data_val:0,context_data_position:0};let a=0;for(let a=0;a<t.length;a+=1)o.context_c=t.charAt(a),x(o.context_dictionary,o.context_c)||(o.context_dictionary[o.context_c]=o.context_dictSize++,o.context_dictionaryToCreate[o.context_c]=!0),o.context_wc=o.context_w+o.context_c,x(o.context_dictionary,o.context_wc)?o.context_w=o.context_wc:(T(o,e,n),o.context_dictionary[o.context_wc]=o.context_dictSize++,o.context_w=String(o.context_c));for(""!==o.context_w&&T(o,e,n),o.value=2,a=0;a<o.context_numBits;a++)o.context_data_val=o.context_data_val<<1|1&o.value,N(o,e,n),o.value=o.value>>1;for(;;){if(o.context_data_val=o.context_data_val<<1,o.context_data_position==e-1){o.context_data.push(n(o.context_data_val));break}o.context_data_position++}return o.context_data.join("")}(t,15,t=>v(t+32))+" "}function B(t){return null==t?"":""===t?null:function(t,e,n){const o=[],a={val:n(0),position:e,index:1},r=[];let c,i,s=4,u=4,l=3,h="";for(let t=0;t<3;t++)o[t]=t;switch(D(a,Math.pow(2,2),e,n)){case 0:i=v(D(a,Math.pow(2,8),e,n));break;case 1:i=v(D(a,Math.pow(2,16),e,n));break;case 2:return""}for(o[3]=i,c=i,r.push(i);;){if(a.index>t)return"";switch(i=D(a,Math.pow(2,l),e,n)){case 0:o[u++]=v(D(a,Math.pow(2,8),e,n)),i=u-1,s--;break;case 1:o[u++]=v(D(a,Math.pow(2,16),e,n)),i=u-1,s--;break;case 2:return r.join("")}if(0===s&&(s=Math.pow(2,l),l++),o[i])h=o[i];else{if(i!==u)return null;h=c+c.charAt(0)}r.push(h),o[u++]=c+h.charAt(0),s--,c=h,0===s&&(s=Math.pow(2,l),l++)}}(t.length,16384,e=>t.charCodeAt(e)-32)}function R(){try{return sessionStorage.setItem("testKey","testValue"),sessionStorage.removeItem("testKey"),!0}catch(t){return!1}}function L(t,e){return R()?sessionStorage.setItem(t,j(i(e)?JSON.stringify(e):e)):function(t,e){if(t&&void 0!==e){const n=g.hostname,a="https:"===g.protocol;let c=e;i(e)&&(c=JSON.stringify(e));const s="; path=/",u=-1===o.indexOf(n)?`; domain=${r(n)}`:"",l=a?"; secure":"";document.cookie=`${t} = ${c}${u}${s}${l}`}}(t,e)}function U(t){if(R()){let e=B(sessionStorage.getItem(t));try{return e=JSON.parse(e),e}catch(t){return e}}return function(t){if(t){const e=decodeURIComponent(document.cookie);let n="";return function(t,e){if(t&&t.length)for(let n=0;n<t.length;n+=1)if("function"==typeof e){const o=e.apply(t,[t[n],n]);if("boolean"==typeof o){if(o)continue;break}}}(e.split(";"),e=>{const o=`${t}=`,a=e.indexOf(o);if(a>-1)return n=r(e.substring(a+o.length,e.length)),!1}),n}return""}(t)}const q={set(){return L.apply(this,arguments)},get(){return U.apply(this,arguments)}};function z(){this.handlers=[]}M(z.prototype,{getDataFromStore:(t,e)=>M(q.get("routeStore"))[`${e?"#":""}${t}`],setDataToStore(t,e,n){let o=M(q.get("routeStore"));if(o[t]&&(!n||s(n)&&0===_(n).length))return!1;const a={};return a[`${e?"#":""}${t}`]=n,o=M({},o,a),q.set("routeStore",o)},contains(t){return!!this.handlers.filter(t).length},remove(t){this.handlers.splice(this.handlers.indexOf(t),1).length}});const H=new z;function J(){const t=g.hash.match(n);return M({},A(),t?M({},A(t[0])):{})}function P(t,e,n){const o=f(e),a=(e=e.substring(+o)).split("?")[0];_(n=M(n)).length&&H.setDataToStore(a,o,n);const r=y(t,e);return{hasMatch:_(r).length>0||h(e)&&(t===e||"*"===t),data:H.getDataFromStore(a,o),params:r}}function F(t){t.type=t.hash?"hashchange":"popstate";const e=u(t.originalData,{});t.originalEvent=u(t.originalEvent,d(t.type,e)),delete t.originalData,function(t,e,n){n=M(n),H.handlers.forEach(o=>{if(o.eventName===t){const t=g[e.hash?"hash":"pathname"],a=P(o.isCaseInsensitive?o.route.toLowerCase():o.route,o.isCaseInsensitive?t.toLowerCase():t,n);a.hasMatch&&(!o.hash||o.hash&&e.hash)&&o.handler(M({},e,{data:a.data,params:a.params,query:J()}))}})}("route.changed",t,e)}function K(t,e,n){let o=M({replaceMode:e,noTrigger:n},"string"==typeof t?{route:t}:t);if("string"==typeof o.route){const t=f(o.route),e=r(o.route).split("?"),n=e[0].substring(+t),a=m(r(e[1])||r(o.queryString));if(!h(n))throw new TypeError("Route string is not a pure route");{H.setDataToStore(n,t,o.data);const e=function(t,e,n,o){n=r(n.substring(+("?"===n.charAt(0))));const a=o?g.search:"";return e?`${g.pathname}${a}#${t}${n?`?${n}`:""}`:`${t}${a}${n?`${a?"&":"?"}${n}`:""}`}(n,t,a,o.appendQuery);history[o.replaceMode?"replaceState":"pushState"]({data:o.data},o.title,e),o.noTrigger||F({route:`${t?"#":""}${n}`,hash:t})}}}function Q(t,e,n){let o="string"==typeof t&&0===t.indexOf("$$");if(p(t)&&(n=e,e=t,t="*"),a(t))return function(t,e){H.contains(t=>t.prevHandler===e)||Q(n=>{p(e)&&t.indexOf(`${n.hash?"#":""}${n.route.substring(+n.hash)}`)>-1&&e.apply(this,[n])},e)}(t,e);const c=f(t=t.substring(o?"$$".length:0));t=t.substring(+c),!H.contains(n=>n.handler===e&&n.route===t)&&p(e)&&H.handlers.push({eventName:"route.changed",handler:e,prevHandler:n,route:t,hash:c,isCaseInsensitive:o}),(c?[g.hash]:[g.pathname,g.hash]).filter(t=>r(t)).forEach(n=>{const a=f(n),r=P(o?t.toLowerCase():t,o?n.toLowerCase():n);if(r.hasMatch&&p(e)){const t=a?"hashchange":"popstate";e({originalEvent:d(t,r.data),route:n,hash:a,eventName:t,data:r.data,params:r.params,query:J(),isCaseInsensitive:o})}})}function V(t,e){const n=H.handlers.length;let o=a(t);if(o&&!e)return 0;const r=l(arguments);return 0===r.length?(H.handlers.length=0,n):(t=o?"*":t,H.handlers.forEach(n=>{let a=n.route===t;const c=1===r.length;c&&"string"==typeof t&&!o||(c&&p(t)&&(e=t,t="*"),a=a&&(n.handler===e||n.prevHandler===e)),a&&H.remove(n)}),n-H.handlers.length)}function G(t,e){if(e=r(e),!Array.isArray(t))throw new TypeError("Provide a valid list of routes");let n=!1;for(let o=0;o<t.length;o++){const a=r(t[o]);if(["*",e].indexOf(a)>-1||Object.keys(y(a,e)).length){n=!0;break}}return n}const W={set(){return K.apply(this,arguments)},includes(){return G.apply(this,arguments)},list(){const t=[];return H.handlers.forEach(e=>{let n=`${e.hash?"#":""}${e.route}`;-1===t.indexOf(n)&&t.push(n)}),t}};function X(){return Q.apply(this,arguments)}function Y(t){"string"==typeof t&&X.apply(this,[`$$${t}`,l(arguments).slice(1)])}function Z(){return V.apply(this,arguments)}window.addEventListener("popstate",(function(t){const e=`${g.pathname}${g.hash}`.split("#"),n={originalEvent:t,originalData:M(t.state&&t.state.data)};F(M({},n,{route:e[0],hash:!1})),e[1]&&F(M({},n,{route:`#${e[1]}`,hash:!0}))}));export{A as deparam,m as param,X as route,Y as routeIgnoreCase,y as routeParams,W as router,Z as unroute};
