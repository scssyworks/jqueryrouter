/**!
 * Router plugin for single page applications with routes
 * Released under MIT license
 * @name Silk router
 * @author Sachin Singh <contactsachinsingh@gmail.com>
 * @version 3.4.6
 * @license MIT
 */
const t="hashchange",e="popstate",n="route.changed",o=/:[^\/]+/g,a=/^\/(?=[^?]*)/,r=/\?.+/,c="Route string is not a pure route",i="$$",s=["localhost","0.0.0.0","127.0.0.1",null],u=Array.isArray;function l(t){return"string"==typeof t?t.trim():""}function h(t){return t=l(`${t}`),!(["null","undefined",""].indexOf(t)>-1)&&!isNaN(+t)}function f(t){return t&&"object"==typeof t}function p(t){return f(t)&&!u(t)}function d(t,e){return void 0===t?e:t}function _(t){return Array.prototype.slice.call(t)}function x(t){return"string"==typeof t&&a.test(t)}function g(t){return"string"==typeof t&&"#"===t.charAt(0)}function v(t){return"function"==typeof t}function y(t,e){return{type:t,state:{data:e}}}function m(t){return t?Object.keys(t):[]}function w(t,e){return Object.prototype.hasOwnProperty.call(t,e)}const $=window.location,S=String.fromCharCode;function b(t,e){e=d(e,$.pathname);const n={};if(o.test(t)){const a=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)"));if(o.lastIndex=0,a.test(e)){const r=_(t.match(o)).map(t=>t.replace(":","")),c=_(e.match(a));c.shift(),r.forEach((t,e)=>{n[t]=c[e]})}}return n}function C(t){let e=[];return f(t)?(m(t).forEach(n=>{!function t(e,n,o){f(o)?m(o).forEach(a=>{t(e,`${n}[${u(o)?"":a}]`,o[a])}):"function"!=typeof o&&e.push(`${encodeURIComponent(n)}=${encodeURIComponent(o)}`)}(e,n,t[n])}),e.join("&")):"string"==typeof t?t:""}function I(t){return/\[/.test(t)}function E(t,e){"?"===(t=l(d(t,$.search))).charAt(0)&&(t=t.replace("?",""));const n={};return t&&t.split("&").forEach(t=>{const o=t.split("=").map(t=>decodeURIComponent(t));(I(o[0])?N:O).apply(this,[].concat(o,[n,d(e,!1),!1]))}),n}function A(t,e){return e?void 0===t?[]:t:(o={},u(n=t)&&n.forEach((t,e)=>{o[e]=t}),o);var n,o}function M(t,e){return p(t)?{ob:t}:u(t)||void 0===t?{ob:A(t,h(e))}:{ob:[t],push:null!==t}}function N(t,e,n,o){o=d(o,!0);const a=t.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===a.length){const r=a[1];let c=a[2];if(I(t=t.replace(/\[([^\[]*)\]/,"")))""===c&&(c="0"),N(t=t.replace(/[^\[]+/,c),e,n[r]=M(n[r],c).ob,o);else if(c){const t=M(n[r],c);n[r]=t.ob;const a=o?T(e):e;if(t.push){const t={};t[c]=a,n[r].push(t)}else n[r][c]=a}else O(r,e,n,o,!0)}}function O(t,e,n,o,a){d(o,!0)&&(e=T(e)),t in n?(n[t]=u(n[t])?n[t]:[n[t]],n[t].push(e)):n[t]=a?[e]:e}function T(t){if(null==t)return"";if("string"!=typeof t)return t;if(h(t=l(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function k(){return E.apply(this,arguments)}function D(t,e){f(t)&&m(t).forEach((function(n){e[n]=t[n]}))}function B(){const t=f(arguments[0])?arguments[0]:{};for(let e=1;e<arguments.length;e++)D(arguments[e],t);return t}function j(t,e,n){t.context_data_position==e-1?(t.context_data_position=0,t.context_data.push(n(t.context_data_val)),t.context_data_val=0):t.context_data_position++}function R(t){t.context_enlargeIn--,0==t.context_enlargeIn&&(t.context_enlargeIn=2**t.context_numBits,t.context_numBits++)}function L(t,e,n){if(w(t.context_dictionaryToCreate,t.context_w)){if(t.context_w.charCodeAt(0)<256){for(let o=0;o<t.context_numBits;o++)t.context_data_val=t.context_data_val<<1,j(t,e,n);t.value=t.context_w.charCodeAt(0);for(let o=0;o<8;o++)t.context_data_val=t.context_data_val<<1|1&t.value,j(t,e,n),t.value=t.value>>1}else{t.value=1;for(let o=0;o<t.context_numBits;o++)t.context_data_val=t.context_data_val<<1|t.value,j(t,e,n),t.value=0;t.value=t.context_w.charCodeAt(0);for(let o=0;o<16;o++)t.context_data_val=t.context_data_val<<1|1&t.value,j(t,e,n),t.value=t.value>>1}R(t),delete t.context_dictionaryToCreate[t.context_w]}else{t.value=t.context_dictionary[t.context_w];for(let o=0;o<t.context_numBits;o++)t.context_data_val=t.context_data_val<<1|1&t.value,j(t,e,n),t.value=t.value>>1}R(t)}function U(t,e,n,o){let a=0,r=1;for(;r!==e;){const e=t.val&t.position;t.position>>=1,0===t.position&&(t.position=n,t.val=o(t.index++)),a|=(e>0?1:0)*r,r<<=1}return a}function q(t){return null==t?"":function(t,e,n){if(null==t)return"";const o={context_dictionary:{},context_dictionaryToCreate:{},context_data:[],context_c:"",context_wc:"",context_w:"",context_enlargeIn:2,context_dictSize:3,context_numBits:2,context_data_val:0,context_data_position:0};let a=0;for(let a=0;a<t.length;a+=1)o.context_c=t.charAt(a),w(o.context_dictionary,o.context_c)||(o.context_dictionary[o.context_c]=o.context_dictSize++,o.context_dictionaryToCreate[o.context_c]=!0),o.context_wc=o.context_w+o.context_c,w(o.context_dictionary,o.context_wc)?o.context_w=o.context_wc:(L(o,e,n),o.context_dictionary[o.context_wc]=o.context_dictSize++,o.context_w=String(o.context_c));for(""!==o.context_w&&L(o,e,n),o.value=2,a=0;a<o.context_numBits;a++)o.context_data_val=o.context_data_val<<1|1&o.value,j(o,e,n),o.value=o.value>>1;for(;;){if(o.context_data_val=o.context_data_val<<1,o.context_data_position==e-1){o.context_data.push(n(o.context_data_val));break}o.context_data_position++}return o.context_data.join("")}(t,15,t=>S(t+32))+" "}function z(t){return null==t?"":""===t?null:function(t,e,n){const o=[],a={val:n(0),position:e,index:1},r=[];let c,i,s=4,u=4,l=3,h="";for(let t=0;t<3;t++)o[t]=t;switch(U(a,Math.pow(2,2),e,n)){case 0:i=S(U(a,Math.pow(2,8),e,n));break;case 1:i=S(U(a,Math.pow(2,16),e,n));break;case 2:return""}for(o[3]=i,c=i,r.push(i);;){if(a.index>t)return"";switch(i=U(a,Math.pow(2,l),e,n)){case 0:o[u++]=S(U(a,Math.pow(2,8),e,n)),i=u-1,s--;break;case 1:o[u++]=S(U(a,Math.pow(2,16),e,n)),i=u-1,s--;break;case 2:return r.join("")}if(0===s&&(s=Math.pow(2,l),l++),o[i])h=o[i];else{if(i!==u)return null;h=c+c.charAt(0)}r.push(h),o[u++]=c+h.charAt(0),c=h,0===--s&&(s=Math.pow(2,l),l++)}}(t.length,16384,e=>t.charCodeAt(e)-32)}function H(){try{return sessionStorage.setItem("testKey","testValue"),sessionStorage.removeItem("testKey"),!0}catch(t){return!1}}function J(t,e){return H()?sessionStorage.setItem(t,q(f(e)?JSON.stringify(e):e)):function(t,e){if(t&&void 0!==e){const n=$.hostname,o="https:"===$.protocol;let a=e;f(e)&&(a=JSON.stringify(e));const r="; path=/",c=-1===s.indexOf(n)?`; domain=${l(n)}`:"",i=o?"; secure":"";document.cookie=`${t} = ${a}${c}${r}${i}`}}(t,e)}function F(t){if(H()){let e=z(sessionStorage.getItem(t));try{return e=JSON.parse(e)}catch(t){return e}}return function(t){if(t){const e=decodeURIComponent(document.cookie);let n="";return function(t,e){if(t&&t.length)for(let n=0;n<t.length;n+=1)if("function"==typeof e){const o=e.apply(t,[t[n],n]);if("boolean"==typeof o){if(o)continue;break}}}(e.split(";"),e=>{const o=`${t}=`,a=e.indexOf(o);if(a>-1)return n=l(e.substring(a+o.length,e.length)),!1}),n}return""}(t)}const K={set(){return J.apply(this,arguments)},get(){return F.apply(this,arguments)}};function P(){this.handlers=[]}B(P.prototype,{getDataFromStore:(t,e)=>B(K.get("routeStore"))[`${e?"#":""}${t}`],setDataToStore(t,e,n){let o=B(K.get("routeStore"));if(o[t]&&(!n||p(n)&&0===m(n).length))return!1;const a={};return a[`${e?"#":""}${t}`]=n,o=B({},o,a),K.set("routeStore",o)},contains(t){return!!this.handlers.filter(t).length},remove(t){this.handlers.splice(this.handlers.indexOf(t),1).length}});const Q=new P;function V(){const t=$.hash.match(r);return B({},k(),t?B({},k(t[0])):{})}function G(t,e,n){const o=g(e),a=(e=e.substring(+o)).split("?")[0];m(n=B(n)).length&&Q.setDataToStore(a,o,n);const r=b(t,e);return{hasMatch:m(r).length>0||x(e)&&(t===e||"*"===t),data:Q.getDataFromStore(a,o),params:r}}function W(o){o.type=o.hash?t:e;const a=d(o.originalData,{});o.originalEvent=d(o.originalEvent,y(o.type,a)),delete o.originalData,function(t,e,n){n=B(n),Q.handlers.forEach(o=>{if(o.eventName===t){const t=$[e.hash?"hash":"pathname"],a=G(o.isCaseInsensitive?o.route.toLowerCase():o.route,o.isCaseInsensitive?t.toLowerCase():t,n);a.hasMatch&&(!o.hash||o.hash&&e.hash)&&o.handler(B({},e,{data:a.data,params:a.params,query:V()}))}})}(n,o,a)}function X(t,e,n){let o=B({replaceMode:e,noTrigger:n},"string"==typeof t?{route:t}:t);if("string"==typeof o.route){const t=g(o.route),e=l(o.route).split("?"),n=e[0].substring(+t),a=C(l(e[1])||l(o.queryString));if(!x(n))throw new TypeError(c);{Q.setDataToStore(n,t,o.data);const e=function(t,e,n,o){n=l(n.substring(+("?"===n.charAt(0))));const a=o?$.search:"";return e?`${$.pathname}${a}#${t}${n?`?${n}`:""}`:`${t}${a}${n?`${a?"&":"?"}${n}`:""}`}(n,t,a,o.appendQuery);history[o.replaceMode?"replaceState":"pushState"]({data:o.data},o.title,e),o.noTrigger||W({route:`${t?"#":""}${n}`,hash:t})}}}function Y(o,a,r){let c="string"==typeof o&&0===o.indexOf(i);if(v(o)&&(r=a,a=o,o="*"),u(o))return function(t,e){Q.contains(t=>t.prevHandler===e)||Y(n=>{v(e)&&t.indexOf(`${n.hash?"#":""}${n.route.substring(+n.hash)}`)>-1&&e.apply(this,[n])},e)}(o,a);const s=g(o=o.substring(c?i.length:0));o=o.substring(+s),!Q.contains(t=>t.handler===a&&t.route===o)&&v(a)&&Q.handlers.push({eventName:n,handler:a,prevHandler:r,route:o,hash:s,isCaseInsensitive:c}),(s?[$.hash]:[$.pathname,$.hash]).filter(t=>l(t)).forEach(n=>{const r=g(n),i=G(c?o.toLowerCase():o,c?n.toLowerCase():n);if(i.hasMatch&&v(a)){const o=r?t:e;a({originalEvent:y(o,i.data),route:n,hash:r,eventName:o,data:i.data,params:i.params,query:V(),isCaseInsensitive:c})}})}function Z(t,e){const n=Q.handlers.length;let o=u(t);if(o&&!e)return 0;const a=_(arguments);return 0===a.length?(Q.handlers.length=0,n):(t=o?"*":t,Q.handlers.forEach(n=>{let r=n.route===t;const c=1===a.length;c&&"string"==typeof t&&!o||(c&&v(t)&&(e=t,t="*"),r=r&&(n.handler===e||n.prevHandler===e)),r&&Q.remove(n)}),n-Q.handlers.length)}const tt={set(){return X.apply(this,arguments)}};function et(){return Y.apply(this,arguments)}function nt(t){"string"==typeof t&&et.apply(this,[`${i}${t}`,_(arguments).slice(1)])}function ot(){return Z.apply(this,arguments)}window.addEventListener(`${e}`,(function(t){const e=`${$.pathname}${$.hash}`.split("#"),n={originalEvent:t,originalData:B(t.state&&t.state.data)};W(B({},n,{route:e[0],hash:!1})),e[1]&&W(B({},n,{route:`#${e[1]}`,hash:!0}))}));export{k as deparam,C as param,et as route,nt as routeIgnoreCase,b as routeParams,tt as router,ot as unroute};
