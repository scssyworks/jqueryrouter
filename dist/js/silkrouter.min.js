!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("deparam.js"),require("lzstorage")):"function"==typeof define&&define.amd?define(["exports","deparam.js","lzstorage"],e):e((t=t||self).silkrouter={},t.deparam,t.LZStorage)}(this,function(t,n,e){"use strict";function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function O(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){a=!0,o=t}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function h(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n=n&&n.hasOwnProperty("default")?n.default:n,e=e&&e.hasOwnProperty("default")?e.default:e;var j="hashchange",A="popstate",o="route.changed",f=/:[^\/]+/g,r=/^\/(?=[^?]*)/,i=/\?.+/,c=new e({compression:!0}),E={getDataFromStore:function(t,e){return(c.get("routeStore")||{})["".concat(e?"#":"").concat(t)]},setDataToStore:function(t,e,n){var r=c.get("routeStore")||{};return r=S({},r,a({},"".concat(e?"#":"").concat(t),n)),c.set("routeStore",r,!0)},handlers:[]};function p(t){return t.replace(/^([^a-zA-Z0-9]+)|([^a-zA-Z0-9]+)$/g,"")}function T(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};l.api.trigger(o,{route:t,eventType:e,hash:n},r)}function x(t){return"string"==typeof t&&r.test(t)}function d(){var t=n(window.location.search),e={};return window.location.hash.match(i)&&(e=S({},e,n(window.location.hash.match(i)[0]))),S({},t,e)}function u(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r="string"==typeof t?{route:t}:S({},t),a=r=S({},r,{replaceMode:e,noTrigger:n}),o=a.route,i=a.replaceMode,c=a.noTrigger,u=a.queryString,l=void 0===u?"":u,s=a.data,h=a.title,f=void 0===h?null:h,p=a.appendQuery;if("string"==typeof o){var d="#"===o.charAt(0)?1:0,g=O(o.trim().split("?"),2),v=g[0],y=g[1],m=void 0===y?"":y,w="".concat(i?"replace":"push","State");if(m=m||l,!x(v=v.substring(d)))throw new Error("Route string is not a pure route");E.setDataToStore(v,1==d,s);var b=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return n="?"===n.charAt(0)?n.substring(1).trim():n.trim(),e?n?"".concat(location.pathname).concat(location.search,"#").concat(t,"?").concat(n):"".concat(location.pathname).concat(location.search,"#").concat(t):r?n?"".concat(t).concat(location.search,"&").concat(n):"".concat(t).concat(location.search):n?"".concat(t,"?").concat(n):t}(v,1==d,m,p);history[w]({data:s},f,b),c||T("".concat(d?"#":"").concat(v),d?j:A,1==d)}}function g(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r="#"===e.charAt(0);r&&(e=e.substring(1));var a=O(e.split("?"),1)[0];Object.keys(n).length&&E.setDataToStore(a,r,n);var o=S({},E.getDataFromStore(a,r)),i={},c=!1;if(f.lastIndex=0,f.test(t)){var u=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)"));if(u.test(e)){c=!0,f.lastIndex=0;var l=h(t.match(f)).map(p),s=h(e.match(u));s.shift(),l.forEach(function(t,e){i[t]=s[e]})}}else c=x(e)&&(t===e||"*"===t);return{hasMatch:c,data:o,params:i}}var l={api:{trigger:function(){return function(o,i){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},u=i.hash,t=window.location,l=t.hash,s=t.pathname;E.handlers.forEach(function(t){if(t.eventName===o){var e=g(t.route,u?l:s,c),n=e.hasMatch,r=e.data,a=e.params;n&&t.handler(S({},i,{data:r,params:a,query:d()}))}})}.apply(this,arguments)}},set:function(){return u.apply(this,arguments)}};window.addEventListener("".concat(A),function(t){var e=O("".concat(location.pathname).concat(location.hash).split("#"),2),n=e[0],r=e[1],a={};if(t.state){var o=t.state.data;o&&(a=o)}T(n,t.type,!1,a),r&&T("#".concat(r),j,!0,a)}),t.route=function(){return function(i,c){var n=this,r=c;"function"==typeof c&&(c=c.bind(this)),"function"==typeof i&&(c=(r=i).bind(this),i="*"),E.handlers.filter(function(t){var e=t.originalHandler===r&&t.route===i;return n&&(e=e&&t.element===n),e}).length||"function"!=typeof c||E.handlers.push({eventName:o,originalHandler:r,handler:c,element:this,route:i});var t=window.location;[t.pathname,t.hash].forEach(function(t){var e="#"===t.charAt(0)?1:0,n=g(i,t),r=n.hasMatch,a=n.data,o=n.params;r&&"function"==typeof c&&c({route:t,hash:1==e,eventName:e?j:A,data:a,params:o,query:d()})})}.apply(this,arguments)},t.router=l,t.unroute=function(){return function(e,n){var r=arguments;0===r.length&&(E.handlers.length=0),E.handlers=E.handlers.filter(function(t){return 1===r.length&&"string"==typeof r[0]?t.route!==e:(1===r.length&&"function"==typeof r[0]&&(n=r[0],e="*"),!(t.route===e&&t.handler===n))})}.apply(this,arguments)},Object.defineProperty(t,"__esModule",{value:!0})});
