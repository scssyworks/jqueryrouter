/**!
 * Router plugin for single page applications with routes
 * Released under MIT license
 * @name Silk router
 * @author Sachin Singh <contactsachinsingh@gmail.com>
 * @version 3.3.1
 * @license MIT
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("lzstorage")):"function"==typeof define&&define.amd?define(["exports","lzstorage"],n):n((t=t||self).silkrouter={},t.LZStorage)}(this,function(t,n){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;var w="hashchange",A="popstate",c="route.changed",i=/:[^\/]+/g,e=/^\/(?=[^?]*)/,r=/\?.+/,u=/^([^a-zA-Z0-9]+)|([^a-zA-Z0-9]+)$/g,a="$$",h=Array.isArray;function S(t){return"string"==typeof t?t.trim():""}function o(t){return t=S("".concat(t)),!(-1<["null","undefined",""].indexOf(t))&&!isNaN(Number(t))}function l(t,n){return void 0===t?n:t}function s(t){return Array.prototype.slice.call(t)}function j(t){return"string"==typeof t&&e.test(t)}var E=window.location;function f(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:E.pathname;if(i.test(t)){var e=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)")),r={};if(e.test(n)){i.lastIndex=0;var a=s(t.match(i)).map(function(t){return t.replace(u,"")}),o=s(n.match(e));o.shift(),a.forEach(function(t,n){r[t]=o[n]})}return r}return{}}function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(n){var e=[];return n&&"object"===p(n)?(Object.keys(n).forEach(function(t){!function e(r,a,o){if(o&&"object"===p(o)){var c=h(o);Object.keys(o).forEach(function(t){var n=c?"":t;e(r,"".concat(a,"[").concat(n,"]"),o[t])})}else-1<["string","number","boolean","undefined","object"].indexOf(p(o))&&r.push("".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(o)))}(e,t,n[t])}),e.join("&")):"string"==typeof n?n:""}function v(t){return/\[/.test(t)}function y(t,e){var r=this;t=S(l(t,E.search)),e=l(e,!0),"?"===t.charAt(0)&&(t=t.replace("?",""));var n=t.split("&"),a={};return t&&n.forEach(function(t){var n=t.split("=").map(function(t){return decodeURIComponent(t)});v(n[0])?function t(n,e,r,a){a=l(a,!0);var o=n.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===o.length){var c=o[1],i=o[2];if(v(n=n.replace(/\[([^\[]*)\]/,"")))""===i&&(i="0"),n=n.replace(/[^\[]+/,i),t(n,e,r[c]=d(r[c],i).ob,a);else if(i){var u=d(r[c],i),s=u.ob,f=u.push;if(r[c]=s,f){var h={};h[i]=a?b(e):e,r[c].push(h)}else r[c][i]=a?b(e):e}else m([o[1],e],r,!0)}}.apply(r,[].concat(n).concat([a,e])):m.apply(r,[n,a,!1,e])}),a}function g(t,n){return void 0===t?n?[]:{}:n?t:function(t){var e={};return h(t)&&t.forEach(function(t,n){e[n]=t}),e}(t)}function d(t,n){return function(t){return null!=t&&!h(t)&&"[object Object]"===t.toString()}(t)?{ob:t}:h(t)||void 0===t?{ob:g(t,o(n))}:{ob:[t],push:null!==t}}function m(t,n,e,r){r=l(r,!0);var a=t[0],o=t[1];r&&(o=b(o)),a in n?(n[a]=h(n[a])?n[a]:[n[a]],n[a].push(o)):n[a]=e?[o]:o}function b(t){if(null==t)return"";if("string"!=typeof t)return t;if(o(t=S(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function C(){return y.apply(this,arguments)}function x(n,e){null!=n&&"object"===p(n)&&Object.keys(n).forEach(function(t){e[t]=n[t]})}function N(){var t=0,n="object"!==p(arguments[0])||null==arguments[0]?{}:arguments[0];for(t=1;t<arguments.length;t++)x(arguments[t],n);return n}var D=new n({compression:!0}),I={getDataFromStore:function(t,n){return(D.get("routeStore")||{})["".concat(n?"#":"").concat(t)]},setDataToStore:function(t,n,e){var r=D.get("routeStore")||{};if(r[t]&&(!e||"object"===p(e)&&0===Object.keys(e).length))return!1;var a={};return a["".concat(n?"#":"").concat(t)]=e,r=N({},r,a),D.set("routeStore",r,!0)},handlers:[]};function k(){var t=C(E.search,!1),n={},e=E.hash.match(r);return e&&(n=N({},n,C(e[0],!1))),N({},t,n)}function H(t,n,e){e=N(e);var r="#"===n.charAt(0);r&&(n=n.substring(1));var a=n.split("?")[0];Object.keys(e).length&&I.setDataToStore(a,r,e);var o=I.getDataFromStore(a,r),c=f(t,n);return{hasMatch:0<Object.keys(c).length||j(n)&&(t===n||"*"===t),data:o,params:c}}function L(i,u,s){s=N(s);var f=u.hash,h=E.hash,l=E.pathname;I.handlers.forEach(function(t){if(t.eventName===i){var n=t.route,e=f?h:l;t.isCaseInsensitive&&(n=n.toLowerCase(),e=e.toLowerCase());var r=H(n,e,s),a=r.hasMatch,o=r.data,c=r.params;a&&(!t.hash||t.hash&&f)&&t.handler(N({},u,{data:o,params:c,query:k()}))}})}function M(t){var n=t.originalEvent,e=t.route,r=t.type,a=t.hash,o=t.originalData;L(c,{originalEvent:n,route:e,type:r,hash:a},o)}function R(t,n,e){var r="string"==typeof t?{route:t}:N({},t),a=r=N({},r,{replaceMode:n,noTrigger:e}),o=a.route,c=a.replaceMode,i=a.noTrigger,u=a.queryString,s=void 0===u?"":u,f=a.data,h=a.title,l=void 0===h?null:h,p=a.appendQuery;if("string"==typeof o){var v="#"===o.charAt(0)?1:0,y=S(o).split("?"),g=y[0],d=S(y[1]),m="".concat(c?"replace":"push","State");if(d=O(d||s),!j(g=g.substring(v)))throw new Error("Route string is not a pure route");I.setDataToStore(g,1==v,f);var b=function(t,n,e,r){return e=S(e.substring("?"===e.charAt(0)?1:0)),n?"".concat(E.pathname).concat(E.search,"#").concat(t).concat(e?"?".concat(e):""):r?"".concat(t).concat(E.search).concat(e?"&".concat(e):""):"".concat(t).concat(e?"?".concat(e):"")}(g,1==v,d,p);history[m]({data:f},l,b),i||M({originalEvent:{},route:"".concat(v?"#":"").concat(g),type:v?w:A,hash:1==v,originalData:{}})}}function T(u,s,t){var f=!1;if("function"==typeof u&&(t=s,s=u,u="*"),h(u))!function(o,c){var i=this;I.handlers.filter(function(t){return t.prevHandler===c}).length||T(function(){if("function"==typeof c){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];var r=n[0],a=r.route;"#"===a.charAt(0)&&(a=a.substring(1)),-1<o.indexOf(a)?c.apply(i,n):-1<o.indexOf("#".concat(a))&&r.hash&&c.apply(i,n)}},c)}(u,s);else{0===u.indexOf(a)&&(f=!0,u=u.substring(a.length));var n="#"===u.charAt(0)?1:0;u=u.substring(n),I.handlers.filter(function(t){return t.handler===s&&t.route===u}).length||"function"!=typeof s||I.handlers.push({eventName:c,handler:s,prevHandler:t,route:u,hash:1==n,isCaseInsensitive:f});var e=E.pathname,r=E.hash;(1==n?[r]:[e,r]).filter(function(t){return S(t)}).forEach(function(t){var n=u,e=t;f&&(n=n.toLowerCase(),e=e.toLowerCase());var r="#"===t.charAt(0)?1:0,a=H(n,e),o=a.hasMatch,c=a.data,i=a.params;o&&"function"==typeof s&&s({route:t,hash:1==r,eventName:1==r?w:A,data:c,params:i,query:k(),isCaseInsensitive:f})})}}var q={api:{trigger:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return L.apply(this,n)},extractParams:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return f.apply(this,n)},toQueryString:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return O.apply(this,n)}},set:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return R.apply(this,n)}};function z(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return T.apply(this,n)}window.addEventListener("".concat(A),function(t){var n="".concat(E.pathname).concat(E.hash).split("#"),e=n[0],r=n[1],a={};if(t.state){var o=t.state.data;o&&(a=o)}M({originalEvent:t,route:e,type:t.type,hash:!1,originalData:a}),r&&M({originalEvent:t,route:"#".concat(r),type:HASH_CHANGE,hash:!0,originalData:a})}),t.deparam=C,t.param=O,t.route=z,t.routeIgnoreCase=function(t){if("string"==typeof t){for(var n=arguments.length,e=new Array(1<n?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];z.apply(this,["".concat(a).concat(t)].concat(e))}},t.routeParams=f,t.router=q,t.unroute=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];var r=n[0],a=n[1],o=I.handlers.length,c=!1;return 0===n.length&&(I.handlers.length=0),h(r)&&(r="*",c=!0),I.handlers=I.handlers.filter(function(t){return 1!==n.length||"string"!=typeof n[0]||c?(1===n.length&&"function"==typeof n[0]&&(a=n[0],r="*"),!(t.route===r&&(t.handler===a||t.prevHandler===a))):t.route!==r}),o>I.handlers.length}.apply(this,n)},Object.defineProperty(t,"__esModule",{value:!0})});
