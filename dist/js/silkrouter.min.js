/**!
 * Router plugin for single page applications with routes
 * Released under MIT license
 * @name Silk router
 * @author Sachin Singh <contactsachinsingh@gmail.com>
 * @version 3.2.0
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("deparam.js"),require("lzstorage")):"function"==typeof define&&define.amd?define(["exports","deparam.js","lzstorage"],e):e((t=t||self).silkrouter={},t.deparam,t.LZStorage)}(this,function(t,n,e){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n,e=e&&e.hasOwnProperty("default")?e.default:e;var w="hashchange",A="popstate",c="route.changed",i=/:[^\/]+/g,r=/^\/(?=[^?]*)/,a=/\?.+/,u=/^([^a-zA-Z0-9]+)|([^a-zA-Z0-9]+)$/g,o="$$";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(e,r){null!=e&&"object"===s(e)&&Object.keys(e).forEach(function(t){r[t]=e[t]})}function j(){var t=0,e="object"!==s(arguments[0])||null==arguments[0]?{}:arguments[0];for(t=1;t<arguments.length;t++)f(arguments[t],e);return e}var h=new e({compression:!0}),S={getDataFromStore:function(t,e){return(h.get("routeStore")||{})["".concat(e?"#":"").concat(t)]},setDataToStore:function(t,e,r){var n=h.get("routeStore")||{};if(n[t]&&(!r||"object"===s(r)&&0===Object.keys(r).length))return!1;var a={};return a["".concat(e?"#":"").concat(t)]=r,n=j({},n,a),h.set("routeStore",n,!0)},handlers:[]};function l(t){return Array.prototype.slice.call(t)}function p(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:window.location.pathname;if(i.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)")),n={};if(r.test(e)){i.lastIndex=0;var a=[].concat(l(t.match(i))).map(function(t){return t.replace(u,"")}),o=[].concat(l(e.match(r)));o.shift(),a.forEach(function(t,e){n[t]=o[e]})}return n}return{}}function E(e){var r=[];return e&&"object"===s(e)?(Object.keys(e).forEach(function(t){!function e(r,n,a){a&&"object"===s(a)?Object.keys(a).forEach(function(t){e(r,"".concat(n,"[").concat(t,"]"),a[t])}):-1<["string","number","boolean","undefined","object"].indexOf(s(a))&&r.push("".concat(n,"=").concat(a))}(r,t,e[t])}),r.join("&")):"string"==typeof e?e:""}var O=window.location;function x(t){return"string"==typeof t?t.trim():""}function D(t){var e=t.originalEvent,r=t.route,n=t.type,a=t.hash,o=t.originalData;m(c,{originalEvent:e,route:r,type:n,hash:a},o)}function C(t){return"string"==typeof t&&r.test(t)}function y(){var t=n(O.search,!1),e={},r=O.hash.match(a);return r&&(e=j({},e,n(r[0],!1))),j({},t,e)}function g(t,e,r){var n="string"==typeof t?{route:t}:j({},t),a=n=j({},n,{replaceMode:e,noTrigger:r}),o=a.route,c=a.replaceMode,i=a.noTrigger,u=a.queryString,s=void 0===u?"":u,f=a.data,h=a.title,l=void 0===h?null:h,p=a.appendQuery;if("string"==typeof o){var y="#"===o.charAt(0)?1:0,g=x(o).split("?"),v=g[0],d=x(g[1]),m="".concat(c?"replace":"push","State");if(d=E(d||s),!C(v=v.substring(y)))throw new Error("Route string is not a pure route");S.setDataToStore(v,1==y,f);var b=function(t,e,r,n){return r=x(r.substring("?"===r.charAt(0)?1:0)),e?"".concat(O.pathname).concat(O.search,"#").concat(t).concat(r?"?".concat(r):""):n?"".concat(t).concat(O.search).concat(r?"&".concat(r):""):"".concat(t).concat(r?"?".concat(r):"")}(v,1==y,d,p);history[m]({data:f},l,b),i||D({originalEvent:{},route:"".concat(y?"#":"").concat(v),type:y?w:A,hash:1==y,originalData:{}})}}function v(u,s,t){var f=!1;if("function"==typeof u&&(t=s,s=u,u="*"),Array.isArray(u))!function(o,c){var i=this;S.handlers.filter(function(t){return t.prevHandler===c}).length||v(function(){if("function"==typeof c){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e[0],a=n.route;"#"===a.charAt(0)&&(a=a.substring(1)),-1<o.indexOf(a)?c.apply(i,e):-1<o.indexOf("#".concat(a))&&n.hash&&c.apply(i,e)}},c)}(u,s);else{0===u.indexOf(o)&&(f=!0,u=u.substring(o.length));var e="#"===u.charAt(0)?1:0;u=u.substring(e),S.handlers.filter(function(t){return t.handler===s&&t.route===u}).length||"function"!=typeof s||S.handlers.push({eventName:c,handler:s,prevHandler:t,route:u,hash:1==e,isCaseInsensitive:f});var r=O.pathname,n=O.hash;(1==e?[n]:[r,n]).filter(function(t){return x(t)}).forEach(function(t){var e=u,r=t;f&&(e=e.toLowerCase(),r=r.toLowerCase());var n="#"===t.charAt(0)?1:0,a=d(e,r),o=a.hasMatch,c=a.data,i=a.params;o&&"function"==typeof s&&s({route:t,hash:1==n,eventName:1==n?w:A,data:c,params:i,query:y(),isCaseInsensitive:f})})}}function d(t,e,r){r=j(r);var n="#"===e.charAt(0);n&&(e=e.substring(1));var a=e.split("?")[0];Object.keys(r).length&&S.setDataToStore(a,n,r);var o=S.getDataFromStore(a,n),c=p(t,e);return{hasMatch:0<Object.keys(c).length||C(e)&&(t===e||"*"===t),data:o,params:c}}function m(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(i,u,s){s=j(s);var f=u.hash,h=O.hash,l=O.pathname;S.handlers.forEach(function(t){if(t.eventName===i){var e=t.route,r=f?h:l;t.isCaseInsensitive&&(e=e.toLowerCase(),r=r.toLowerCase());var n=d(e,r,s),a=n.hasMatch,o=n.data,c=n.params;a&&(!t.hash||t.hash&&f)&&t.handler(j({},u,{data:o,params:c,query:y()}))}})}.apply(this,e)}var b={api:{trigger:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return m.apply(this,e)},extractParams:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return p.apply(this,e)},toQueryString:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return E.apply(this,e)}},set:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return g.apply(this,e)}};function k(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return v.apply(this,e)}window.addEventListener("".concat(A),function(t){var e="".concat(O.pathname).concat(O.hash).split("#"),r=e[0],n=e[1],a={};if(t.state){var o=t.state.data;o&&(a=o)}D({originalEvent:t,route:r,type:t.type,hash:!1,originalData:a}),n&&D({originalEvent:t,route:"#".concat(n),type:w,hash:!0,originalData:a})}),t.route=k,t.routeIgnoreCase=function(t){if("string"==typeof t){for(var e=arguments.length,r=new Array(1<e?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];k.apply(this,["".concat(o).concat(t)].concat(r))}},t.router=b,t.unroute=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e[0],a=e[1],o=S.handlers.length,c=!1;return 0===e.length&&(S.handlers.length=0),Array.isArray(n)&&(n="*",c=!0),S.handlers=S.handlers.filter(function(t){return 1!==e.length||"string"!=typeof e[0]||c?(1===e.length&&"function"==typeof e[0]&&(a=e[0],n="*"),!(t.route===n&&(t.handler===a||t.prevHandler===a))):t.route!==n}),o>S.handlers.length}.apply(this,e)},Object.defineProperty(t,"__esModule",{value:!0})});
