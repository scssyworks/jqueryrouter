/**!
 * Router plugin for single page applications with routes
 * Release under the MIT license
 * @name Silk router
 * @author Sachin Singh <ssingh.300889@gmail.com>
 * @version 3.0.0.beta.6
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("deparam.js"),require("lzstorage")):"function"==typeof define&&define.amd?define(["exports","deparam.js","lzstorage"],e):e((t=t||self).silkrouter={},t.deparam,t.LZStorage)}(this,function(t,n,e){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function j(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n=n&&n.hasOwnProperty("default")?n.default:n,e=e&&e.hasOwnProperty("default")?e.default:e;var O="hashchange",A="popstate",l="route.changed",f=/:[^\/]+/g,r=/^\/(?=[^?]*)/,i=/\?.+/,c=new e({compression:!0}),E={getDataFromStore:function(t,e){return(c.get("routeStore")||{})["".concat(e?"#":"").concat(t)]},setDataToStore:function(t,e,n){var r=c.get("routeStore")||{};return!(r[t]&&(!n||"object"===o(n)&&0===Object.keys(n).length))&&(r=S({},r,a({},"".concat(e?"#":"").concat(t),n)),c.set("routeStore",r,!0))},handlers:[]};function p(t){return t.replace(/^([^a-zA-Z0-9]+)|([^a-zA-Z0-9]+)$/g,"")}function D(t){var e=t.originalEvent,n=void 0===e?{}:e,r=t.route,o=t.type,a=t.hash,i=void 0!==a&&a,c=t.originalData,u=void 0===c?{}:c;router.api.trigger(l,{originalEvent:n,route:r,type:o,hash:i},u)}function x(t){return"string"==typeof t&&r.test(t)}function d(){var t=n(window.location.search),e={};return window.location.hash.match(i)&&(e=S({},e,n(window.location.hash.match(i)[0]))),S({},t,e)}function u(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r="string"==typeof t?{route:t}:S({},t),o=r=S({},r,{replaceMode:e,noTrigger:n}),a=o.route,i=o.replaceMode,c=o.noTrigger,u=o.queryString,l=void 0===u?"":u,h=o.data,s=o.title,f=void 0===s?null:s,p=o.appendQuery;if("string"==typeof a){var d="#"===a.charAt(0)?1:0,y=j(a.trim().split("?"),2),g=y[0],v=y[1],m=void 0===v?"":v,b="".concat(i?"replace":"push","State");if(m=m||l,!x(g=g.substring(d)))throw new Error("Route string is not a pure route");E.setDataToStore(g,1==d,h);var w=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return n="?"===n.charAt(0)?n.substring(1).trim():n.trim(),e?n?"".concat(location.pathname).concat(location.search,"#").concat(t,"?").concat(n):"".concat(location.pathname).concat(location.search,"#").concat(t):r?n?"".concat(t).concat(location.search,"&").concat(n):"".concat(t).concat(location.search):n?"".concat(t,"?").concat(n):t}(g,1==d,m,p);history[b]({data:h},f,w),c||D({route:"".concat(d?"#":"").concat(g),type:d?O:A,hash:1==d})}}function y(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r="#"===e.charAt(0);r&&(e=e.substring(1));var o=j(e.split("?"),1)[0];Object.keys(n).length&&E.setDataToStore(o,r,n);var a=E.getDataFromStore(o,r),i={},c=!1;if(f.lastIndex=0,f.test(t)){var u=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)"));if(u.test(e)){c=!0,f.lastIndex=0;var l=s(t.match(f)).map(p),h=s(e.match(u));h.shift(),l.forEach(function(t,e){i[t]=h[e]})}}else c=x(e)&&(t===e||"*"===t);return{hasMatch:c,data:a,params:i}}var h={api:{trigger:function(){return function(a,i){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},u=i.hash,t=window.location,l=t.hash,h=t.pathname;E.handlers.forEach(function(t){if(t.eventName===a){var e=y(t.route,u?l:h,c),n=e.hasMatch,r=e.data,o=e.params;n&&(!t.hash||t.hash&&u)&&t.handler(S({},i,{data:r,params:o,query:d()}))}})}.apply(this,arguments)}},set:function(){return u.apply(this,arguments)}};window.addEventListener("".concat(A),function(t){var e=j("".concat(location.pathname).concat(location.hash).split("#"),2),n=e[0],r=e[1],o={};if(t.state){var a=t.state.data;a&&(o=a)}D({originalEvent:t,route:n,type:t.type,hash:!1,originalData:o}),r&&D({originalEvent:t,route:"#".concat(r),type:O,hash:!0,originalData:o})}),t.route=function(){return function(i,c){"function"==typeof i&&(c=i,i="*");var t="#"===i.charAt(0)?1:0;i=i.substring(t),E.handlers.filter(function(t){return t.handler===c&&t.route===i}).length||"function"!=typeof c||E.handlers.push({eventName:l,handler:c,route:i,hash:1==t});var e=window.location,n=e.pathname,r=e.hash;(1==t?[r]:[n,r]).filter(function(t){return t.trim()}).forEach(function(t){var e="#"===t.charAt(0)?1:0,n=y(i,t),r=n.hasMatch,o=n.data,a=n.params;r&&"function"==typeof c&&c({route:t,hash:1==e,eventName:1==e?O:A,data:o,params:a,query:d()})})}.apply(this,arguments)},t.router=h,t.unroute=function(){return function(e,n){var r=arguments;0===r.length&&(E.handlers.length=0),E.handlers=E.handlers.filter(function(t){return 1===r.length&&"string"==typeof r[0]?t.route!==e:(1===r.length&&"function"==typeof r[0]&&(n=r[0],e="*"),!(t.route===e&&t.handler===n))})}.apply(this,arguments)},Object.defineProperty(t,"__esModule",{value:!0})});
