/**!
 * Router plugin for single page applications with routes
 * Released under MIT license
 * @name Silk router
 * @author Sachin Singh <contactsachinsingh@gmail.com>
 * @version 3.2.0
 * @license MIT
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("lzstorage")):"function"==typeof define&&define.amd?define(["exports","lzstorage"],n):n((t=t||self).silkrouter={},t.LZStorage)}(this,function(t,n){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;var w="hashchange",A="popstate",c="route.changed",i=/:[^\/]+/g,r=/^\/(?=[^?]*)/,e=/\?.+/,u=/^([^a-zA-Z0-9]+)|([^a-zA-Z0-9]+)$/g,a="$$";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(n,r){null!=n&&"object"===o(n)&&Object.keys(n).forEach(function(t){r[t]=n[t]})}function S(){var t=0,n="object"!==o(arguments[0])||null==arguments[0]?{}:arguments[0];for(t=1;t<arguments.length;t++)s(arguments[t],n);return n}var f=new n({compression:!0}),j={getDataFromStore:function(t,n){return(f.get("routeStore")||{})["".concat(n?"#":"").concat(t)]},setDataToStore:function(t,n,r){var e=f.get("routeStore")||{};if(e[t]&&(!r||"object"===o(r)&&0===Object.keys(r).length))return!1;var a={};return a["".concat(n?"#":"").concat(t)]=r,e=S({},e,a),f.set("routeStore",e,!0)},handlers:[]};function h(t){return Array.prototype.slice.call(t)}function l(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:window.location.pathname;if(i.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)")),e={};if(r.test(n)){i.lastIndex=0;var a=[].concat(h(t.match(i))).map(function(t){return t.replace(u,"")}),o=[].concat(h(n.match(r)));o.shift(),a.forEach(function(t,n){e[t]=o[n]})}return e}return{}}function E(n){var r=[];return n&&"object"===o(n)?(Object.keys(n).forEach(function(t){!function n(r,e,a){a&&"object"===o(a)?Object.keys(a).forEach(function(t){n(r,"".concat(e,"[").concat(t,"]"),a[t])}):-1<["string","number","boolean","undefined","object"].indexOf(o(a))&&r.push("".concat(e,"=").concat(a))}(r,t,n[t])}),r.join("&")):"string"==typeof n?n:""}var O=window.location,p=Array.isArray;function x(t){return"string"==typeof t?t.trim():""}function y(t){return t=x("".concat(t)),!(-1<["null","undefined",""].indexOf(t))&&!isNaN(Number(t))}function g(t,n){return void 0===t?n:t}function v(t){return/\[/.test(t)}function d(t,r){var e=this;t=x(g(t,O.search)),r=g(r,!0),"?"===t.charAt(0)&&(t=t.replace("?",""));var n=t.split("&"),a={};return t&&n.forEach(function(t){var n=t.split("=");n[1]&&(n[1]=decodeURIComponent(n[1])),v(n[0])?function t(n,r,e,a){a=g(a,!0);var o=n.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===o.length){var c=o[1],i=o[2];if(v(n=n.replace(/\[([^\[]*)\]/,"")))""===i&&(i="0"),n=n.replace(/[^\[]+/,i),t(n,r,e[c]=b(e[c],i).ob,a);else if(i){var u=b(e[c],i),s=u.ob,f=u.push;if(e[c]=s,f){var h={};h[i]=a?C(r):r,e[c].push(h)}else e[c][i]=a?C(r):r}else N([o[1],r],e,!0)}}.apply(e,[].concat(n).concat([a,r])):N.apply(e,[n,a,!1,r])}),a}function m(t,n){return void 0===t?n?[]:{}:n?t:function(t){var r={};return p(t)&&t.forEach(function(t,n){r[n]=t}),r}(t)}function b(t,n){return function(t){return null!=t&&!p(t)&&"[object Object]"===t.toString()}(t)?{ob:t}:p(t)||void 0===t?{ob:m(t,y(n))}:{ob:[t],push:null!==t}}function N(t,n,r,e){e=g(e,!0);var a=t[0],o=t[1];e&&(o=C(o)),a in n?(n[a]=p(n[a])?n[a]:[n[a]],n[a].push(o)):n[a]=r?[o]:o}function C(t){if(null==t)return"";if("string"!=typeof t)return t;if(y(t=x(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function D(){return d.apply(this,arguments)}function k(t){var n=t.originalEvent,r=t.route,e=t.type,a=t.hash,o=t.originalData;z(c,{originalEvent:n,route:r,type:e,hash:a},o)}function I(t){return"string"==typeof t&&r.test(t)}function L(){var t=D(O.search,!1),n={},r=O.hash.match(e);return r&&(n=S({},n,D(r[0],!1))),S({},t,n)}function M(t,n,r){var e="string"==typeof t?{route:t}:S({},t),a=e=S({},e,{replaceMode:n,noTrigger:r}),o=a.route,c=a.replaceMode,i=a.noTrigger,u=a.queryString,s=void 0===u?"":u,f=a.data,h=a.title,l=void 0===h?null:h,p=a.appendQuery;if("string"==typeof o){var y="#"===o.charAt(0)?1:0,g=x(o).split("?"),v=g[0],d=x(g[1]),m="".concat(c?"replace":"push","State");if(d=E(d||s),!I(v=v.substring(y)))throw new Error("Route string is not a pure route");j.setDataToStore(v,1==y,f);var b=function(t,n,r,e){return r=x(r.substring("?"===r.charAt(0)?1:0)),n?"".concat(O.pathname).concat(O.search,"#").concat(t).concat(r?"?".concat(r):""):e?"".concat(t).concat(O.search).concat(r?"&".concat(r):""):"".concat(t).concat(r?"?".concat(r):"")}(v,1==y,d,p);history[m]({data:f},l,b),i||k({originalEvent:{},route:"".concat(y?"#":"").concat(v),type:y?w:A,hash:1==y,originalData:{}})}}function T(u,s,t){var f=!1;if("function"==typeof u&&(t=s,s=u,u="*"),p(u))!function(o,c){var i=this;j.handlers.filter(function(t){return t.prevHandler===c}).length||T(function(){if("function"==typeof c){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=n[0],a=e.route;"#"===a.charAt(0)&&(a=a.substring(1)),-1<o.indexOf(a)?c.apply(i,n):-1<o.indexOf("#".concat(a))&&e.hash&&c.apply(i,n)}},c)}(u,s);else{0===u.indexOf(a)&&(f=!0,u=u.substring(a.length));var n="#"===u.charAt(0)?1:0;u=u.substring(n),j.handlers.filter(function(t){return t.handler===s&&t.route===u}).length||"function"!=typeof s||j.handlers.push({eventName:c,handler:s,prevHandler:t,route:u,hash:1==n,isCaseInsensitive:f});var r=O.pathname,e=O.hash;(1==n?[e]:[r,e]).filter(function(t){return x(t)}).forEach(function(t){var n=u,r=t;f&&(n=n.toLowerCase(),r=r.toLowerCase());var e="#"===t.charAt(0)?1:0,a=q(n,r),o=a.hasMatch,c=a.data,i=a.params;o&&"function"==typeof s&&s({route:t,hash:1==e,eventName:1==e?w:A,data:c,params:i,query:L(),isCaseInsensitive:f})})}}function q(t,n,r){r=S(r);var e="#"===n.charAt(0);e&&(n=n.substring(1));var a=n.split("?")[0];Object.keys(r).length&&j.setDataToStore(a,e,r);var o=j.getDataFromStore(a,e),c=l(t,n);return{hasMatch:0<Object.keys(c).length||I(n)&&(t===n||"*"===t),data:o,params:c}}function z(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return function(i,u,s){s=S(s);var f=u.hash,h=O.hash,l=O.pathname;j.handlers.forEach(function(t){if(t.eventName===i){var n=t.route,r=f?h:l;t.isCaseInsensitive&&(n=n.toLowerCase(),r=r.toLowerCase());var e=q(n,r,s),a=e.hasMatch,o=e.data,c=e.params;a&&(!t.hash||t.hash&&f)&&t.handler(S({},u,{data:o,params:c,query:L()}))}})}.apply(this,n)}var H={api:{trigger:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return z.apply(this,n)},extractParams:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return l.apply(this,n)},toQueryString:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return E.apply(this,n)},fromQueryString:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return D.apply(this,n)}},set:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return M.apply(this,n)}};function P(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return T.apply(this,n)}window.addEventListener("".concat(A),function(t){var n="".concat(O.pathname).concat(O.hash).split("#"),r=n[0],e=n[1],a={};if(t.state){var o=t.state.data;o&&(a=o)}k({originalEvent:t,route:r,type:t.type,hash:!1,originalData:a}),e&&k({originalEvent:t,route:"#".concat(e),type:w,hash:!0,originalData:a})}),t.deparam=D,t.param=E,t.route=P,t.routeIgnoreCase=function(t){if("string"==typeof t){for(var n=arguments.length,r=new Array(1<n?n-1:0),e=1;e<n;e++)r[e-1]=arguments[e];P.apply(this,["".concat(a).concat(t)].concat(r))}},t.router=H,t.unroute=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=n[0],a=n[1],o=j.handlers.length,c=!1;return 0===n.length&&(j.handlers.length=0),p(e)&&(e="*",c=!0),j.handlers=j.handlers.filter(function(t){return 1!==n.length||"string"!=typeof n[0]||c?(1===n.length&&"function"==typeof n[0]&&(a=n[0],e="*"),!(t.route===e&&(t.handler===a||t.prevHandler===a))):t.route!==e}),o>j.handlers.length}.apply(this,n)},Object.defineProperty(t,"__esModule",{value:!0})});
