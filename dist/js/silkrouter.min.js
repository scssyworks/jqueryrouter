/**!
 * Router plugin for single page applications with routes
 * Released under MIT license
 * @name Silk router
 * @author Sachin Singh <ssingh.300889@gmail.com>
 * @version 3.1.2
 * @license MIT
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("deparam.js"),require("lzstorage")):"function"==typeof define&&define.amd?define(["exports","deparam.js","lzstorage"],n):n((t=t||self).silkrouter={},t.deparam,t.LZStorage)}(this,function(t,r,n){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function S(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{},r=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.forEach(function(t){o(n,t,e[t])})}return n}function A(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=[],r=!0,a=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done)&&(e.push(i.value),!n||e.length!==n);r=!0);}catch(t){a=!0,o=t}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return e}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n;function c(t){return l.test(t)}var O="hashchange",j="popstate",u="route.changed",l=/:[^\/]+/g,e=/^\/(?=[^?]*)/,h=/\?.+/,s=/^([^a-zA-Z0-9]+)|([^a-zA-Z0-9]+)$/g,f=new n({compression:!0}),E={getDataFromStore:function(t,n){return(f.get("routeStore")||{})["".concat(n?"#":"").concat(t)]},setDataToStore:function(t,n,e){var r=f.get("routeStore")||{};return!(r[t]&&(!e||"object"===a(e)&&0===Object.keys(e).length))&&(r=S({},r,o({},"".concat(n?"#":"").concat(t),e)),f.set("routeStore",r,!0))},handlers:[]},p=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:window.location.pathname;if(c(t)){var e=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)")),r={};if(e.test(n)){l.lastIndex=0;var a=i(t.match(l)).map(function(t){return t.replace(s,"")}),o=i(n.match(e));o.shift(),a.forEach(function(t,n){r[t]=o[n]})}return r}return{}};function x(t){var n=t.originalEvent,e=void 0===n?{}:n,r=t.route,a=t.type,o=t.hash,i=void 0!==o&&o,c=t.originalData;m(u,{originalEvent:e,route:r,type:a,hash:i},void 0===c?{}:c)}function D(t){return"string"==typeof t&&e.test(t)}function d(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=r(window.location.search,t),e={};return window.location.hash.match(h)&&(e=S({},e,r(window.location.hash.match(h)[0],t))),S({},n,e)}function y(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r="string"==typeof t?{route:t}:S({},t),a=r=S({},r,{replaceMode:n,noTrigger:e}),o=a.route,i=a.replaceMode,c=a.noTrigger,u=a.queryString,l=void 0===u?"":u,h=a.data,s=a.title,f=void 0===s?null:s,p=a.appendQuery;if("string"==typeof o){var d="#"===o.charAt(0)?1:0,y=A(o.trim().split("?"),2),g=y[0],v=y[1],m=void 0===v?"":v,b="".concat(i?"replace":"push","State");if(m=m||l,!D(g=g.substring(d)))throw new Error("Route string is not a pure route");E.setDataToStore(g,1==d,h);var w=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return e="?"===e.charAt(0)?e.substring(1).trim():e.trim(),n?e?"".concat(location.pathname).concat(location.search,"#").concat(t,"?").concat(e):"".concat(location.pathname).concat(location.search,"#").concat(t):r?e?"".concat(t).concat(location.search,"&").concat(e):"".concat(t).concat(location.search):e?"".concat(t,"?").concat(e):t}(g,1==d,m,p);history[b]({data:h},f,w),c||x({route:"".concat(d?"#":"").concat(g),type:d?O:j,hash:1==d})}}function g(i,c,t){if("function"==typeof i&&(t=c,c=i,i="*"),Array.isArray(i))!function(o,i){var c=this;E.handlers.filter(function(t){return t.prevHandler===i}).length||g(function(){if("function"==typeof i){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];var r=n[0],a=r.route;"#"===a.charAt(0)&&(a=a.substring(1)),-1<o.indexOf(a)?i.apply(c,n):-1<o.indexOf("#".concat(a))&&r.hash&&i.apply(c,n)}},i)}(i,c);else{var n="#"===i.charAt(0)?1:0;i=i.substring(n),E.handlers.filter(function(t){return t.handler===c&&t.route===i}).length||"function"!=typeof c||E.handlers.push({eventName:u,handler:c,prevHandler:t,route:i,hash:1==n});var e=window.location,r=e.pathname,a=e.hash;(1==n?[a]:[r,a]).filter(function(t){return t.trim()}).forEach(function(t){var n="#"===t.charAt(0)?1:0,e=v(i,t),r=e.hasMatch,a=e.data,o=e.params;r&&"function"==typeof c&&c({route:t,hash:1==n,eventName:1==n?O:j,data:a,params:o,query:d()})})}}function v(t,n){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r="#"===n.charAt(0);r&&(n=n.substring(1));var a=A(n.split("?"),1)[0];Object.keys(e).length&&E.setDataToStore(a,r,e);var o=E.getDataFromStore(a,r),i=p(t,n);return{hasMatch:0<Object.keys(i).length||D(n)&&(t===n||"*"===t),data:o,params:i}}function m(){return function(o,i){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},u=i.hash,t=window.location,l=t.hash,h=t.pathname;E.handlers.forEach(function(t){if(t.eventName===o){var n=v(t.route,u?l:h,c),e=n.hasMatch,r=n.data,a=n.params;e&&(!t.hash||t.hash&&u)&&t.handler(S({},i,{data:r,params:a,query:d()}))}})}.apply(this,arguments)}var b={api:{trigger:function(){return m.apply(this,arguments)},hasParams:function(){return c.apply(this,arguments)},extractParams:function(){return p.apply(this,arguments)}},set:function(){return y.apply(this,arguments)}};window.addEventListener("".concat(j),function(t){var n=A("".concat(location.pathname).concat(location.hash).split("#"),2),e=n[0],r=n[1],a={};if(t.state){var o=t.state.data;o&&(a=o)}x({originalEvent:t,route:e,type:t.type,hash:!1,originalData:a}),r&&x({originalEvent:t,route:"#".concat(r),type:O,hash:!0,originalData:a})}),t.route=function(){return g.apply(this,arguments)},t.router=b,t.unroute=function(){return function(n,e){var r=arguments,t=E.handlers.length,a=!1;return 0===r.length&&(E.handlers.length=0),Array.isArray(n)&&(n="*",a=!0),E.handlers=E.handlers.filter(function(t){return 1!==r.length||"string"!=typeof r[0]||a?(1===r.length&&"function"==typeof r[0]&&(e=r[0],n="*"),!(t.route===n&&(t.handler===e||t.prevHandler===e))):t.route!==n}),t>E.handlers.length}.apply(this,arguments)},Object.defineProperty(t,"__esModule",{value:!0})});
