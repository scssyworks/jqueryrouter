/**!
 * Router plugin for single page applications with routes
 * Release under the MIT license
 * @name Silk router
 * @author Sachin Singh <ssingh.300889@gmail.com>
 * @version 3.0.0.beta.6
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("deparam.js"),require("lzstorage")):"function"==typeof define&&define.amd?define(["exports","deparam.js","lzstorage"],e):e((t=t||self).silkrouter={},t.deparam,t.LZStorage)}(this,function(t,n,e){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function j(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,o=!1,a=void 0;try{for(var c,i=t[Symbol.iterator]();!(r=(c=i.next()).done)&&(n.push(c.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{r||null==i.return||i.return()}finally{if(o)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function h(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n=n&&n.hasOwnProperty("default")?n.default:n,e=e&&e.hasOwnProperty("default")?e.default:e;var O="hashchange",A="popstate",u="route.changed",f=/:[^\/]+/g,r=/^\/(?=[^?]*)/,c=/\?.+/,i=new e({compression:!0}),E={getDataFromStore:function(t,e){return(i.get("routeStore")||{})["".concat(e?"#":"").concat(t)]},setDataToStore:function(t,e,n){var r=i.get("routeStore")||{};return!(r[t]&&(!n||"object"===o(n)&&0===Object.keys(n).length))&&(r=S({},r,a({},"".concat(e?"#":"").concat(t),n)),i.set("routeStore",r,!0))},handlers:[]};function p(t){return t.replace(/^([^a-zA-Z0-9]+)|([^a-zA-Z0-9]+)$/g,"")}function T(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};s.api.trigger(u,{route:t,eventType:e,hash:n},r)}function x(t){return"string"==typeof t&&r.test(t)}function d(){var t=n(window.location.search),e={};return window.location.hash.match(c)&&(e=S({},e,n(window.location.hash.match(c)[0]))),S({},t,e)}function l(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r="string"==typeof t?{route:t}:S({},t),o=r=S({},r,{replaceMode:e,noTrigger:n}),a=o.route,c=o.replaceMode,i=o.noTrigger,u=o.queryString,l=void 0===u?"":u,s=o.data,h=o.title,f=void 0===h?null:h,p=o.appendQuery;if("string"==typeof a){var d="#"===a.charAt(0)?1:0,y=j(a.trim().split("?"),2),g=y[0],v=y[1],m=void 0===v?"":v,b="".concat(c?"replace":"push","State");if(m=m||l,!x(g=g.substring(d)))throw new Error("Route string is not a pure route");E.setDataToStore(g,1==d,s);var w=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return n="?"===n.charAt(0)?n.substring(1).trim():n.trim(),e?n?"".concat(location.pathname).concat(location.search,"#").concat(t,"?").concat(n):"".concat(location.pathname).concat(location.search,"#").concat(t):r?n?"".concat(t).concat(location.search,"&").concat(n):"".concat(t).concat(location.search):n?"".concat(t,"?").concat(n):t}(g,1==d,m,p);history[b]({data:s},f,w),i||T("".concat(d?"#":"").concat(g),d?O:A,1==d)}}function y(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r="#"===e.charAt(0);r&&(e=e.substring(1));var o=j(e.split("?"),1)[0];Object.keys(n).length&&E.setDataToStore(o,r,n);var a=E.getDataFromStore(o,r),c={},i=!1;if(f.lastIndex=0,f.test(t)){var u=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)"));if(u.test(e)){i=!0,f.lastIndex=0;var l=h(t.match(f)).map(p),s=h(e.match(u));s.shift(),l.forEach(function(t,e){c[t]=s[e]})}}else i=x(e)&&(t===e||"*"===t);return{hasMatch:i,data:a,params:c}}var s={api:{trigger:function(){return function(a,c){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},u=c.hash,t=window.location,l=t.hash,s=t.pathname;E.handlers.forEach(function(t){if(t.eventName===a){var e=y(t.route,u?l:s,i),n=e.hasMatch,r=e.data,o=e.params;n&&(!t.hash||t.hash&&u)&&t.handler(S({},c,{data:r,params:o,query:d()}))}})}.apply(this,arguments)}},set:function(){return l.apply(this,arguments)}};window.addEventListener("".concat(A),function(t){var e=j("".concat(location.pathname).concat(location.hash).split("#"),2),n=e[0],r=e[1],o={};if(t.state){var a=t.state.data;a&&(o=a)}T(n,t.type,!1,o),r&&T("#".concat(r),O,!0,o)}),t.route=function(){return function(c,i){"function"==typeof c&&(i=c,c="*");var t="#"===c.charAt(0)?1:0;c=c.substring(t),E.handlers.filter(function(t){return t.handler===i&&t.route===c}).length||"function"!=typeof i||E.handlers.push({eventName:u,handler:i,route:c,hash:1==t});var e=window.location,n=e.pathname,r=e.hash;(1==t?[r]:[n,r]).filter(function(t){return t.trim()}).forEach(function(t){var e="#"===t.charAt(0)?1:0,n=y(c,t),r=n.hasMatch,o=n.data,a=n.params;r&&"function"==typeof i&&i({route:t,hash:1==e,eventName:1==e?O:A,data:o,params:a,query:d()})})}.apply(this,arguments)},t.router=s,t.unroute=function(){return function(e,n){var r=arguments;0===r.length&&(E.handlers.length=0),E.handlers=E.handlers.filter(function(t){return 1===r.length&&"string"==typeof r[0]?t.route!==e:(1===r.length&&"function"==typeof r[0]&&(n=r[0],e="*"),!(t.route===e&&t.handler===n))})}.apply(this,arguments)},Object.defineProperty(t,"__esModule",{value:!0})});
