/**!
 * Router plugin for single page applications with routes
 * Released under MIT license
 * @name Silk router
 * @author Sachin Singh <contactsachinsingh@gmail.com>
 * @version 3.4.0
 * @license MIT
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("argon-storage")):"function"==typeof define&&define.amd?define(["exports","argon-storage"],n):n((t=t||self).silkrouter={},t.ArgonStorage)}(this,(function(t,n){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;var e="hashchange",r="popstate",a="route.changed",o=/:[^\/]+/g,c=/^\/(?=[^?]*)/,i=/\?.+/,u="Route string is not a pure route",s="$$",f=Array.isArray;function h(t){return"string"==typeof t?t.trim():""}function l(t){return t=h("".concat(t)),!(["null","undefined",""].indexOf(t)>-1)&&!isNaN(Number(t))}function p(t){return t&&!f(t)&&"[object Object]"===t.toString()}function d(t,n){return void 0===t?n:t}function g(t){return Array.prototype.slice.call(t)}function v(t){return"string"==typeof t&&c.test(t)}function y(t){return"string"==typeof t&&"#"===t.charAt(0)}function m(t){return"function"==typeof t}var b=window.location;function S(t,n){n=d(n,b.pathname);var e={};if(o.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)"));if(o.lastIndex=0,r.test(n)){var a=g(t.match(o)).map((function(t){return t.replace(":","")})),c=g(n.match(r));c.shift(),a.forEach((function(t,n){e[t]=c[n]}))}}return e}function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t){var n=[];return p(t)||f(t)?(Object.keys(t).forEach((function(e){!function t(n,e,r){var a=!1;p(r)||(a=f(r))?Object.keys(r).forEach((function(o){var c=a?"":o;t(n,"".concat(e,"[").concat(c,"]"),r[o])})):["string","number","boolean","undefined","object"].indexOf(w(r))>-1&&n.push("".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(r)))}(n,e,t[e])})),n.join("&")):"string"==typeof t?t:""}function O(t){return/\[/.test(t)}function j(t,n){var e=this;t=h(d(t,b.search)),n=d(n,!1),"?"===t.charAt(0)&&(t=t.replace("?",""));var r=t.split("&"),a={};return t&&r.forEach((function(t){var r=t.split("=").map((function(t){return decodeURIComponent(t)}));O(r[0])?N.apply(e,[].concat(r).concat([a,n])):x.apply(e,[r,a,!1,n])})),a}function C(t,n){return void 0===t&&(t=[]),n?t:(r={},f(e=t)&&e.forEach((function(t,n){r[n]=t})),r);var e,r}function I(t,n){return p(t)?{ob:t}:f(t)||void 0===t?{ob:C(t,l(n))}:{ob:[t],push:null!==t}}function N(t,n,e,r){r=d(r,!0);var a=t.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===a.length){var o=a[1],c=a[2];if(O(t=t.replace(/\[([^\[]*)\]/,"")))""===c&&(c="0"),N(t=t.replace(/[^\[]+/,c),n,e[o]=I(e[o],c).ob,r);else if(c){var i=I(e[o],c);e[o]=i.ob;var u=r?D(n):n;if(i.push){var s={};s[c]=u,e[o].push(s)}else e[o][c]=u}else x([a[1],n],e,!0)}}function x(t,n,e,r){r=d(r,!0);var a=t[0],o=t[1];r&&(o=D(o)),a in n?(n[a]=f(n[a])?n[a]:[n[a]],n[a].push(o)):n[a]=e?[o]:o}function D(t){if(null==t)return"";if("string"!=typeof t)return t;if(l(t=h(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function k(){return j.apply(this,arguments)}function A(t,n){p(t)&&Object.keys(t).forEach((function(e){n[e]=t[e]}))}function M(){for(var t=p(arguments[0])?arguments[0]:{},n=1;n<arguments.length;n++)A(arguments[n],t);return t}var L=new n({compress:!0}),R={getDataFromStore:function(t,n){return M(L.get("routeStore"))["".concat(n?"#":"").concat(t)]},setDataToStore:function(t,n,e){var r=M(L.get("routeStore"));if(r[t]&&(!e||p(e)&&0===Object.keys(e).length))return!1;var a={};return a["".concat(n?"#":"").concat(t)]=e,r=M({},r,a),L.set("routeStore",r,!0)},handlers:[],contains:function(t){return!!this.handlers.filter(t).length}};function T(){var t=k(),n={},e=b.hash.match(i);return e&&(n=M({},k(e[0]))),M({},t,n)}function q(t,n,e){e=M(e);var r=y(n),a=(n=n.substring(r?1:0)).split("?")[0];Object.keys(e).length&&R.setDataToStore(a,r,e);var o=R.getDataFromStore(a,r),c=S(t,n);return{hasMatch:Object.keys(c).length>0||v(n)&&(t===n||"*"===t),data:o,params:c}}function H(t){t.originalEvent=M(t.originalEvent),t.type=t.hash?e:r;var n=M(t.originalData);delete t.originalData,function(t,n,e){e=M(e),R.handlers.forEach((function(r){if(r.eventName===t){var a=r.route,o=n.hash?b.hash:b.pathname;r.isCaseInsensitive&&(a=a.toLowerCase(),o=o.toLowerCase());var c=q(a,o,e),i=c.hasMatch,u=c.data,s=c.params;i&&(!r.hash||r.hash&&n.hash)&&r.handler(M({},n,{data:u,params:s,query:T()}))}}))}(a,t,n)}function P(t,n,e){var r=M({replaceMode:n,noTrigger:e},"string"==typeof t?{route:t}:t);if("string"==typeof r.route){var a=y(r.route),o=h(r.route).split("?"),c=o[0].substring(a?1:0),i=h(o[1]);if(i=E(i||h(r.queryString)),!v(c))throw new Error(u);R.setDataToStore(c,a,r.data);var s=function(t,n,e,r){return e=h(e.substring("?"===e.charAt(0)?1:0)),n?"".concat(b.pathname).concat(b.search,"#").concat(t).concat(e?"?".concat(e):""):r?"".concat(t).concat(b.search).concat(e?"&".concat(e):""):"".concat(t).concat(e?"?".concat(e):"")}(c,a,i,r.appendQuery);history[r.replaceMode?"replaceState":"pushState"]({data:r.data},r.title,s),r.noTrigger||H({route:"".concat(a?"#":"").concat(c),hash:a})}}function U(t,n,o){var c="string"==typeof t&&0===t.indexOf(s);if(m(t)&&(o=n,n=t,t="*"),f(t))!function(t,n){var e=this;R.contains((function(t){return t.prevHandler===n}))||U((function(r){m(n)&&t.indexOf("".concat(r.hash?"#":"").concat(r.route.substring(r.hash?1:0)))>-1&&n.apply(e,[r])}),n)}(t,n);else{var i=y(t=t.substring(c?s.length:0));t=t.substring(i?1:0),!R.contains((function(e){return e.handler===n&&e.route===t}))&&m(n)&&R.handlers.push({eventName:a,handler:n,prevHandler:o,route:t,hash:i,caseIgnored:c,isCaseInsensitive:c}),(i?[b.hash]:[b.pathname,b.hash]).filter((function(t){return h(t)})).forEach((function(a){var o=c?t.toLowerCase():t,i=c?a.toLowerCase():a,u=y(a),s=q(o,i);s.hasMatch&&m(n)&&n({route:a,hash:u,eventName:u?e:r,data:s.data,params:s.params,query:T(),caseIgnored:c,isCaseInsensitive:c})}))}}function F(t,n){var e=R.handlers.length,r=f(t),a=g(arguments);return 0===a.length?(R.handlers.length=0,e):(r&&(t="*"),R.handlers=R.handlers.filter((function(e){return 1!==a.length||"string"!=typeof t||r?(1===a.length&&m(t)&&(n=t,t="*"),!(e.route===t&&(e.handler===n||e.prevHandler===n))):e.route!==t})),e-R.handlers.length)}var $={set:function(){return P.apply(this,arguments)}};function _(){return U.apply(this,arguments)}window.addEventListener("".concat(r),(function(t){var n="".concat(b.pathname).concat(b.hash).split("#"),e={originalEvent:t,originalData:M(t.state&&t.state.data)};H(M({},e,{route:n[0],hash:!1})),n[1]&&H(M({},e,{route:"#".concat(n[1]),hash:!0}))})),t.deparam=k,t.param=E,t.route=_,t.routeIgnoreCase=function(t){"string"==typeof t&&_.apply(this,["".concat(s).concat(t),g(arguments).slice(1)])},t.routeParams=S,t.router=$,t.unroute=function(){return F.apply(this,arguments)},Object.defineProperty(t,"__esModule",{value:!0})}));
