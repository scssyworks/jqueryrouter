/**!
 * Router plugin for single page applications with routes
 * Released under MIT license
 * @name Silk router
 * @author Sachin Singh <contactsachinsingh@gmail.com>
 * @version 3.2.0
 * @license MIT
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("deparam.js"),require("lzstorage")):"function"==typeof define&&define.amd?define(["exports","deparam.js","lzstorage"],n):n((t=t||self).silkrouter={},t.deparam,t.LZStorage)}(this,function(t,e,n){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function A(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},e=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),e.forEach(function(t){a(n,t,r[t])})}return n}function j(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var r=[],e=!0,a=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(e=(i=c.next()).done)&&(r.push(i.value),!n||r.length!==n);e=!0);}catch(t){a=!0,o=t}finally{try{e||null==c.return||c.return()}finally{if(a)throw o}}return r}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(t){return function(t){if(Array.isArray(t)){for(var n=0,r=new Array(t.length);n<t.length;n++)r[n]=t[n];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n;var O="hashchange",S="popstate",h="route.changed",c=/:[^\/]+/g,r=/^\/(?=[^?]*)/,u=/\?.+/,s=/^([^a-zA-Z0-9]+)|([^a-zA-Z0-9]+)$/g,f="$$",l=new n({compression:!0}),E={getDataFromStore:function(t,n){return(l.get("routeStore")||{})["".concat(n?"#":"").concat(t)]},setDataToStore:function(t,n,r){var e=l.get("routeStore")||{};return!(e[t]&&(!r||"object"===o(r)&&0===Object.keys(r).length))&&(e=A({},e,a({},"".concat(n?"#":"").concat(t),r)),l.set("routeStore",e,!0))},handlers:[]};function p(t){return c.test(t)}function y(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:window.location.pathname;if(p(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)")),e={};if(r.test(n)){c.lastIndex=0;var a=i(t.match(c)).map(function(t){return t.replace(s,"")}),o=i(n.match(r));o.shift(),a.forEach(function(t,n){e[t]=o[n]})}return e}return{}}function x(n){var r=[];return n&&"object"===o(n)?(Object.keys(n).forEach(function(t){!function n(r,e,a){a&&"object"===o(a)?Object.keys(a).forEach(function(t){n(r,"".concat(e,"[").concat(t,"]"),a[t])}):-1<["string","number","boolean","undefined","object"].indexOf(o(a))&&r.push("".concat(e,"=").concat(a))}(r,t,n[t])}),r.join("&")):"string"==typeof n?n:""}function D(t){var n=t.originalEvent,r=void 0===n?{}:n,e=t.route,a=t.type,o=t.hash,i=void 0!==o&&o,c=t.originalData;w(h,{originalEvent:r,route:e,type:a,hash:i},void 0===c?{}:c)}function P(t){return"string"==typeof t&&r.test(t)}function g(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=e(window.location.search,t),r={};return window.location.hash.match(u)&&(r=A({},r,e(window.location.hash.match(u)[0],t))),A({},n,r)}function d(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],e="string"==typeof t?{route:t}:A({},t),a=e=A({},e,{replaceMode:n,noTrigger:r}),o=a.route,i=a.replaceMode,c=a.noTrigger,u=a.queryString,s=void 0===u?"":u,l=a.data,h=a.title,f=void 0===h?null:h,p=a.appendQuery;if("string"==typeof o){var y="#"===o.charAt(0)?1:0,g=j(o.trim().split("?"),2),d=g[0],v=g[1],m=void 0===v?"":v,w="".concat(i?"replace":"push","State");if(m=x(m||s),!P(d=d.substring(y)))throw new Error("Route string is not a pure route");E.setDataToStore(d,1==y,l);var b=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",e=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return r="?"===r.charAt(0)?r.substring(1).trim():r.trim(),n?r?"".concat(location.pathname).concat(location.search,"#").concat(t,"?").concat(r):"".concat(location.pathname).concat(location.search,"#").concat(t):e?r?"".concat(t).concat(location.search,"&").concat(r):"".concat(t).concat(location.search):r?"".concat(t,"?").concat(r):t}(d,1==y,m,p);history[w]({data:l},f,b),c||D({route:"".concat(y?"#":"").concat(d),type:y?O:S,hash:1==y})}}function v(u,s,t){var l=!1;if("function"==typeof u&&(t=s,s=u,u="*"),Array.isArray(u))!function(o,i){var c=this;E.handlers.filter(function(t){return t.prevHandler===i}).length||v(function(){if("function"==typeof i){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=n[0],a=e.route;"#"===a.charAt(0)&&(a=a.substring(1)),-1<o.indexOf(a)?i.apply(c,n):-1<o.indexOf("#".concat(a))&&e.hash&&i.apply(c,n)}},i)}(u,s);else{0===u.indexOf(f)&&(l=!0,u=u.substring(f.length));var n="#"===u.charAt(0)?1:0;u=u.substring(n),E.handlers.filter(function(t){return t.handler===s&&t.route===u}).length||"function"!=typeof s||E.handlers.push({eventName:h,handler:s,prevHandler:t,route:u,hash:1==n,isCaseInsensitive:l});var r=window.location,e=r.pathname,a=r.hash;(1==n?[a]:[e,a]).filter(function(t){return t.trim()}).forEach(function(t){var n=u,r=t;l&&(n=n.toLowerCase(),r=r.toLowerCase());var e="#"===t.charAt(0)?1:0,a=m(n,r),o=a.hasMatch,i=a.data,c=a.params;o&&"function"==typeof s&&s({route:t,hash:1==e,eventName:1==e?O:S,data:i,params:c,query:g(),isCaseInsensitive:l})})}}function m(t,n){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e="#"===n.charAt(0);e&&(n=n.substring(1));var a=j(n.split("?"),1)[0];Object.keys(r).length&&E.setDataToStore(a,e,r);var o=E.getDataFromStore(a,e),i=y(t,n);return{hasMatch:0<Object.keys(i).length||P(n)&&(t===n||"*"===t),data:o,params:i}}function w(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return function(c,u){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},l=u.hash,t=window.location,h=t.hash,f=t.pathname;E.handlers.forEach(function(t){if(t.eventName===c){var n=t.route,r=l?h:f;t.isCaseInsensitive&&(n=n.toLowerCase(),r=r.toLowerCase());var e=m(n,r,s),a=e.hasMatch,o=e.data,i=e.params;a&&(!t.hash||t.hash&&l)&&t.handler(A({},u,{data:o,params:i,query:g()}))}})}.apply(this,n)}var b={api:{trigger:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return w.apply(this,n)},hasParams:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return p.apply(this,n)},extractParams:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return y.apply(this,n)},toQueryString:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return x.apply(this,n)}},set:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return d.apply(this,n)}};function C(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return v.apply(this,n)}window.addEventListener("".concat(S),function(t){var n=j("".concat(location.pathname).concat(location.hash).split("#"),2),r=n[0],e=n[1],a={};if(t.state){var o=t.state.data;o&&(a=o)}D({originalEvent:t,route:r,type:t.type,hash:!1,originalData:a}),e&&D({originalEvent:t,route:"#".concat(e),type:O,hash:!0,originalData:a})}),t.route=C,t.routeIgnoreCase=function(t){if("string"==typeof t){for(var n=arguments.length,r=new Array(1<n?n-1:0),e=1;e<n;e++)r[e-1]=arguments[e];C.apply(this,["".concat(f).concat(t)].concat(r))}},t.router=b,t.unroute=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=n[0],a=n[1],o=E.handlers.length,i=!1;return 0===n.length&&(E.handlers.length=0),Array.isArray(e)&&(e="*",i=!0),E.handlers=E.handlers.filter(function(t){return 1!==n.length||"string"!=typeof n[0]||i?(1===n.length&&"function"==typeof n[0]&&(a=n[0],e="*"),!(t.route===e&&(t.handler===a||t.prevHandler===a))):t.route!==e}),o>E.handlers.length}.apply(this,n)},Object.defineProperty(t,"__esModule",{value:!0})});
