/**!
 * Router plugin for single page applications with routes
 * Released under MIT license
 * @name Silk router
 * @author Sachin Singh <contactsachinsingh@gmail.com>
 * @version 3.3.6
 * @license MIT
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("lzstorage")):"function"==typeof define&&define.amd?define(["exports","lzstorage"],n):n((t=t||self).silkrouter={},t.LZStorage)}(this,function(t,n){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;var h="hashchange",l="popstate",a="route.changed",c=/:[^\/]+/g,e=/^\/(?=[^?]*)/,r=/\?.+/,o="$$",i=Array.isArray;function p(t){return"string"==typeof t?t.trim():""}function u(t){return t=p("".concat(t)),!(-1<["null","undefined",""].indexOf(t))&&!isNaN(Number(t))}function s(t){return t&&!i(t)&&"[object Object]"===t.toString()}function g(t,n){return void 0===t?n:t}function f(t){return Array.prototype.slice.call(t)}function d(t){return"string"==typeof t&&e.test(t)}function v(t){return"string"==typeof t&&"#"===t.charAt(0)}function y(t){return"function"==typeof t}var m=window.location;function b(t,n){n=g(n,m.pathname);var e={};if(c.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)"));if(c.lastIndex=0,r.test(n)){var a=f(t.match(c)).map(function(t){return t.replace(":","")}),o=f(n.match(r));o.shift(),a.forEach(function(t,n){e[t]=o[n]})}}return e}function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function S(n){var e=[];return s(n)||i(n)?(Object.keys(n).forEach(function(t){!function e(r,a,o){var c=!1;s(o)||(c=i(o))?Object.keys(o).forEach(function(t){var n=c?"":t;e(r,"".concat(a,"[").concat(n,"]"),o[t])}):-1<["string","number","boolean","undefined","object"].indexOf(w(o))&&r.push("".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(o)))}(e,t,n[t])}),e.join("&")):"string"==typeof n?n:""}function E(t){return/\[/.test(t)}function A(t,e){var r=this;t=p(g(t,m.search)),e=g(e,!1),"?"===t.charAt(0)&&(t=t.replace("?",""));var n=t.split("&"),a={};return t&&n.forEach(function(t){var n=t.split("=").map(function(t){return decodeURIComponent(t)});E(n[0])?function t(n,e,r,a){a=g(a,!0);var o=n.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===o.length){var c=o[1],i=o[2];if(E(n=n.replace(/\[([^\[]*)\]/,"")))""===i&&(i="0"),n=n.replace(/[^\[]+/,i),t(n,e,r[c]=j(r[c],i).ob,a);else if(i){var u=j(r[c],i),s=u.ob,f=u.push;if(r[c]=s,f){var h={};h[i]=a?x(e):e,r[c].push(h)}else r[c][i]=a?x(e):e}else C([o[1],e],r,!0)}}.apply(r,[].concat(n).concat([a,e])):C.apply(r,[n,a,!1,e])}),a}function O(t,n){return void 0===t?n?[]:{}:n?t:function(t){var e={};return i(t)&&t.forEach(function(t,n){e[n]=t}),e}(t)}function j(t,n){return s(t)?{ob:t}:i(t)||void 0===t?{ob:O(t,u(n))}:{ob:[t],push:null!==t}}function C(t,n,e,r){r=g(r,!0);var a=t[0],o=t[1];r&&(o=x(o)),a in n?(n[a]=i(n[a])?n[a]:[n[a]],n[a].push(o)):n[a]=e?[o]:o}function x(t){if(null==t)return"";if("string"!=typeof t)return t;if(u(t=p(t)))return+t;switch(t){case"null":return null;case"undefined":return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function N(){return A.apply(this,arguments)}function D(n,e){s(n)&&Object.keys(n).forEach(function(t){e[t]=n[t]})}function I(){for(var t=s(arguments[0])?arguments[0]:{},n=1;n<arguments.length;n++)D(arguments[n],t);return t}var k=new n({compression:!0}),L={getDataFromStore:function(t,n){return I(k.get("routeStore"))["".concat(n?"#":"").concat(t)]},setDataToStore:function(t,n,e){var r=I(k.get("routeStore"));if(r[t]&&(!e||s(e)&&0===Object.keys(e).length))return!1;var a={};return a["".concat(n?"#":"").concat(t)]=e,r=I({},r,a),k.set("routeStore",r,!0)},handlers:[],contains:function(t){return!!this.handlers.filter(t).length}};function M(){var t=N(),n={},e=m.hash.match(r);return e&&(n=I({},N(e[0]))),I({},t,n)}function R(t,n,e){e=I(e);var r=v(n),a=(n=n.substring(r?1:0)).split("?")[0];Object.keys(e).length&&L.setDataToStore(a,r,e);var o=L.getDataFromStore(a,r),c=b(t,n);return{hasMatch:0<Object.keys(c).length||d(n)&&(t===n||"*"===t),data:o,params:c}}function T(i,u,s){s=I(s),L.handlers.forEach(function(t){if(t.eventName===i){var n=t.route,e=u.hash?m.hash:m.pathname;t.isCaseInsensitive&&(n=n.toLowerCase(),e=e.toLowerCase());var r=R(n,e,s),a=r.hasMatch,o=r.data,c=r.params;a&&(!t.hash||t.hash&&u.hash)&&t.handler(I({},u,{data:o,params:c,query:M()}))}})}function q(t){t.originalEvent=I(t.originalEvent),t.type=t.hash?h:l;var n=I(t.originalData);delete t.originalData,T(a,t,n)}function P(t,n,e){var r=I({replaceMode:n,noTrigger:e},"string"==typeof t?{route:t}:t);if("string"==typeof r.route){var a=v(r.route),o=p(r.route).split("?"),c=o[0],i=p(o[1]);if(i=S(i||p(r.queryString)),!d(c=c.substring(a?1:0)))throw new Error("Route string is not a pure route");L.setDataToStore(c,a,r.data);var u=function(t,n,e,r){return e=p(e.substring("?"===e.charAt(0)?1:0)),n?"".concat(m.pathname).concat(m.search,"#").concat(t).concat(e?"?".concat(e):""):r?"".concat(t).concat(m.search).concat(e?"&".concat(e):""):"".concat(t).concat(e?"?".concat(e):"")}(c,a,i,r.appendQuery);history[r.replaceMode?"replaceState":"pushState"]({data:r.data},r.title,u),r.noTrigger||q({route:"".concat(a?"#":"").concat(c),hash:a})}}function H(u,s,t){var f=!1;if(y(u)&&(t=s,s=u,u="*"),i(u))!function(e,r){var a=this;L.contains(function(t){return t.prevHandler===r})||H(function(t){if(y(r)){var n=t.route.substring(t.hash?1:0);-1<e.indexOf("".concat(t.hash?"#":"").concat(n))&&r.apply(a,[t])}},r)}(u,s);else{0===u.indexOf(o)&&(f=!0,u=u.substring(o.length));var n=v(u);u=u.substring(n?1:0),!L.contains(function(t){return t.handler===s&&t.route===u})&&y(s)&&L.handlers.push({eventName:a,handler:s,prevHandler:t,route:u,hash:n,isCaseInsensitive:f});var e=m.pathname,r=m.hash;(n?[r]:[e,r]).filter(function(t){return p(t)}).forEach(function(t){var n=u,e=t;f&&(n=n.toLowerCase(),e=e.toLowerCase());var r=v(t),a=R(n,e),o=a.hasMatch,c=a.data,i=a.params;o&&y(s)&&s({route:t,hash:r,eventName:r?h:l,data:c,params:i,query:M(),isCaseInsensitive:f})})}}var U={api:{trigger:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return T.apply(this,n)},extractParams:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return b.apply(this,n)},toQueryString:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return S.apply(this,n)}},set:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return P.apply(this,n)}};function z(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return H.apply(this,n)}window.addEventListener("".concat(l),function(t){var n="".concat(m.pathname).concat(m.hash).split("#"),e={originalEvent:t,originalData:I(t.state&&t.state.data)};q(I({},e,{route:n[0],hash:!1})),n[1]&&q(I({},e,{route:"#".concat(n[1]),hash:!0}))}),t.deparam=N,t.param=S,t.route=z,t.routeIgnoreCase=function(t){if("string"==typeof t){for(var n=arguments.length,e=new Array(1<n?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];z.apply(this,["".concat(o).concat(t)].concat(e))}},t.routeParams=b,t.router=U,t.unroute=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return function(n,e){var r=arguments,t=L.handlers.length,a=!1;return 0===arguments.length&&(L.handlers.length=0),i(n)&&(n="*",a=!0),L.handlers=L.handlers.filter(function(t){return 1!==r.length||"string"!=typeof n||a?(1===r.length&&y(n)&&(e=n,n="*"),!(t.route===n&&(t.handler===e||t.prevHandler===e))):t.route!==n}),t-L.handlers.length}.apply(this,n)},Object.defineProperty(t,"__esModule",{value:!0})});
