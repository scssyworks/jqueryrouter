!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("jquery"),require("jquerydeparam"),require("lzstorage")):"function"==typeof define&&define.amd?define(["exports","jquery","jquerydeparam","lzstorage"],e):e((t=t||self).jqueryrouter={},t.jQuery,t.deparam,t.LZStorage)}(this,function(t,v,r,e){"use strict";function w(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}v=v&&v.hasOwnProperty("default")?v.default:v,r=r&&r.hasOwnProperty("default")?r.default:r,e=e&&e.hasOwnProperty("default")?e.default:e;var c="hashchange",m="popstate",b="route.changed",h=/:[^\/]+/g,n=/^\/(?=[^?]*)/,a=/\?.+/,i=new e({compression:!0}),x={getDataFromStore:function(t){return v.extend({},i.get("routeStore"))[t]},setDataToStore:function(t,e){var r,n,a,o=v.extend({},i.get("routeStore"));return v.extend(o,(a=e,(n=t)in(r={})?Object.defineProperty(r,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[n]=a,r)),i.set("routeStore",o,!0)},handlers:[]},S=!(!history||!history.pushState),A=!1;function f(t){return t.replace(/^([^a-zA-Z0-9]+)|([^a-zA-Z0-9]+)$/g,"")}function j(t){return"string"==typeof t&&n.test(t)}function q(t,e,r){if("string"==typeof e){if("?"===(e=e.trim()).charAt(0)&&(e=e.substring(1)),r&&e)return"".concat(t).concat(window.location.search,"&").concat(e);if(!r&&e)return"".concat(t,"?").concat(e)}return t}function l(){var t=r(window.location.search),e={};return window.location.hash.match(a)&&v.extend(e,r(window.location.hash.match(a)[0])),v.extend(t,e)}function p(t,e){"#"===e.charAt(0)&&(e=e.substring(1));var r=w(e.split("?"),1)[0],n=v.extend({},x.getDataFromStore(r)),a={},o=!1;if(h.lastIndex=0,h.test(t)){var i=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)"));if(i.test(e)){o=!0,h.lastIndex=0;var u=s(t.match(h)).map(f),c=s(e.match(i));c.shift(),u.forEach(function(t,e){a[t]=c[e]})}}else o=j(e)&&(t===e||"*"===t);return{hasMatch:o,data:n,params:a}}var T={api:{trigger:function(t,e){return function(o,i){var u=i.hash,t=window.location,c=t.hash,s=t.pathname;x.handlers.forEach(function(t){if(t.eventName===o){var e=p(t.route,S&&!u?s:c||s),r=e.hasMatch,n=e.data,a=e.params;S||c?r&&t.handler(v.extend(i,{data:n,params:a,query:l()})):window.location.replace("#".concat(s))}})}.apply(this,[t,e])}},set:function(){return function(t,e,r){var n="string"==typeof t?{route:t}:v.extend({},t);v.extend(n,{replaceMode:e,noTrigger:r});var a=n.route,o=n.replaceMode,i=n.noTrigger,u=n.queryString,c=n.data,s=n.title,h=void 0===s?null:s,f=n.appendQuery;if("string"==typeof a){var l="#"===a.charAt(0)?1:0,p=w(a.trim().split("?"),2),d=p[0],y=p[1],g="".concat(o?"replace":"push","State");if(y=y||u,A=i,!j(d=d.substring(l)))throw new Error("Route string is not a pure route");x.setDataToStore(d,c),S&&!l?(history[g]({data:c},h,q(d,y,f)),i||T.api.trigger(b,{route:d,eventType:m,hash:!1})):o?window.location.replace("#".concat(q(d,y,f))):window.location.hash=q(d,y,f)}}.apply(this,arguments)},isHistorySupported:S};function o(){return function(i,u){var r=this,n=u;"function"==typeof u&&(u=u.bind(this)),"function"==typeof i&&(u=(n=i).bind(this),i="*"),x.handlers.filter(function(t){var e=t.originalHandler===n&&t.route===i;return r&&(e=e&&t.element===r),e}).length||"function"!=typeof u||x.handlers.push({eventName:b,originalHandler:n,handler:u,element:this,route:i});var t=window.location;[t.pathname,t.hash].forEach(function(t){var e="#"===t.charAt(0)?1:0,r=p(i,t),n=r.hasMatch,a=r.data,o=r.params;n&&"function"==typeof u&&u({route:t,hash:1===e,eventName:e?c:m,data:a,params:o,query:l()})})}.apply(this,arguments)}"function"==typeof v&&(v.route=v.prototype.route=o,v.unroute=v.prototype.unroute=function(){return function(e,r){var n=arguments;0===n.length&&(x.handlers.length=0),x.handlers=x.handlers.filter(function(t){return 1===n.length&&"string"==typeof n[0]?t.route!==e:(1===n.length&&"function"==typeof n[0]&&(r=n[0],e="*"),!(t.route===e&&t.handler===r))})}.apply(this,arguments)},v.router=T),v(window).on("".concat(m," ").concat(c),function(t){var e="hashchange"===t.type,r=A;return function(t,e){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];3<arguments.length&&void 0!==arguments[3]&&arguments[3]?A=!1:T.api.trigger(b,{route:t,eventType:e,hash:r})}.apply(this,[window.location[e?"hash":"pathname"],t.type,e,r])}),t.router=T,t.route=o,Object.defineProperty(t,"__esModule",{value:!0})});
