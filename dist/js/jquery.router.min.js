!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("jquery"),require("jquerydeparam"),require("lzstorage")):"function"==typeof define&&define.amd?define(["exports","jquery","jquerydeparam","lzstorage"],e):e((t=t||self).jqueryrouter={},t.jQuery,t.deparam,t.LZStorage)}(this,function(t,v,r,e){"use strict";function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function l(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}v=v&&v.hasOwnProperty("default")?v.default:v,r=r&&r.hasOwnProperty("default")?r.default:r,e=e&&e.hasOwnProperty("default")?e.default:e;var c="hashchange",w="popstate",b="route.changed",f=/:[^\/]+/g,n=/^\/(?=[^?]*)/,a=/\?.+/,o=new e({compression:!0}),x={getDataFromStore:function(t,e){return v.extend({},o.get("routeStore"))["".concat(e?"#":"").concat(t)]},setDataToStore:function(t,e,r){var n=v.extend({},o.get("routeStore"));return v.extend(n,function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}({},"".concat(e?"#":"").concat(t),r)),o.set("routeStore",n,!0)},handlers:[]},S=!(!history||!history.pushState),j=!1;function p(t){return t.replace(/^([^a-zA-Z0-9]+)|([^a-zA-Z0-9]+)$/g,"")}function A(t){return"string"==typeof t&&n.test(t)}function q(t,e,r){if("string"==typeof e){if("?"===(e=e.trim()).charAt(0)&&(e=e.substring(1)),r&&e)return"".concat(t).concat(window.location.search,"&").concat(e);if(!r&&e)return"".concat(t,"?").concat(e)}return t}function d(){var t=r(window.location.search),e={};return window.location.hash.match(a)&&v.extend(e,r(window.location.hash.match(a)[0])),v.extend(t,e)}function y(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n="#"===e.charAt(0);n&&(e=e.substring(1));var a=m(e.split("?"),1)[0];v.isEmptyObject(r)||x.setDataToStore(a,n,r);var o=v.extend({},x.getDataFromStore(a,n)),i={},u=!1;if(f.lastIndex=0,f.test(t)){var c=new RegExp(t.replace(/\//g,"\\/").replace(/:[^\/\\]+/g,"([^\\/]+)"));if(c.test(e)){u=!0,f.lastIndex=0;var s=l(t.match(f)).map(p),h=l(e.match(c));h.shift(),s.forEach(function(t,e){i[t]=h[e]})}}else u=A(e)&&(t===e||"*"===t);return{hasMatch:u,data:o,params:i}}var E={api:{trigger:function(){return function(o,i){var u=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},c=i.hash,t=window.location,s=t.hash,h=t.pathname;x.handlers.forEach(function(t){if(t.eventName===o){var e=y(t.route,S&&!c?h:s||h,u),r=e.hasMatch,n=e.data,a=e.params;S||s?r&&t.handler(v.extend(i,{data:n,params:a,query:d()})):window.location.replace("#".concat(h))}})}.apply(this,arguments)}},set:function(){return function(t,e,r){var n="string"==typeof t?{route:t}:v.extend({},t);v.extend(n,{replaceMode:e,noTrigger:r});var a=n.route,o=n.replaceMode,i=n.noTrigger,u=n.queryString,c=n.data,s=n.title,h=void 0===s?null:s,l=n.appendQuery;if("string"==typeof a){var f="#"===a.charAt(0)?1:0,p=m(a.trim().split("?"),2),d=p[0],y=p[1],g="".concat(o?"replace":"push","State");if(y=y||u,j=i,!A(d=d.substring(f)))throw new Error("Route string is not a pure route");x.setDataToStore(d,1==f,c),S&&!f?(history[g]({data:c},h,q(d,y,l)),i||E.api.trigger(b,{route:d,eventType:w,hash:!1})):o?window.location.replace("#".concat(q(d,y,l))):window.location.hash=q(d,y,l)}}.apply(this,arguments)},isHistorySupported:S};function i(){return function(i,u){var r=this,n=u;"function"==typeof u&&(u=u.bind(this)),"function"==typeof i&&(u=(n=i).bind(this),i="*"),x.handlers.filter(function(t){var e=t.originalHandler===n&&t.route===i;return r&&(e=e&&t.element===r),e}).length||"function"!=typeof u||x.handlers.push({eventName:b,originalHandler:n,handler:u,element:this,route:i});var t=window.location;[t.pathname,t.hash].forEach(function(t){var e="#"===t.charAt(0)?1:0,r=y(i,t),n=r.hasMatch,a=r.data,o=r.params;n&&"function"==typeof u&&u({route:t,hash:1==e,eventName:e?c:w,data:a,params:o,query:d()})})}.apply(this,arguments)}"function"==typeof v&&(v.route=v.prototype.route=i,v.unroute=v.prototype.unroute=function(){return function(e,r){var n=arguments;0===n.length&&(x.handlers.length=0),x.handlers=x.handlers.filter(function(t){return 1===n.length&&"string"==typeof n[0]?t.route!==e:(1===n.length&&"function"==typeof n[0]&&(r=n[0],e="*"),!(t.route===e&&t.handler===r))})}.apply(this,arguments)},v.router=E),v(window).on("".concat(w," ").concat(c),function(t){var e="hashchange"===t.type,r=j,n=t.originalEvent,a={};if(n&&n.state){var o=n.state.data;v.extend(a,o)}return console.log(t.originalEvent.state),function(t,e){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};n?j=!1:E.api.trigger(b,{route:t,eventType:e,hash:r},a)}.apply(this,[window.location[e?"hash":"pathname"],t.type,e,r,a])}),t.route=i,t.router=E,Object.defineProperty(t,"__esModule",{value:!0})});
