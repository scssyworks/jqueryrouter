{"version":3,"file":"jquery.router.js","sources":["../../src/js/utils/constants.js","../../src/js/utils/libs.js","../../src/js/jquery.router.js"],"sourcesContent":["/**\n * Router constants\n */\nexport const HASH_CHANGE = 'hashchange';\nexport const POP_STATE = 'popstate';\nexport const ROUTE_CHANGED = 'route.changed';\nexport const REG_ROUTE_PARAMS = /:[^\\/]+/g;\nexport const REG_PATHNAME = /^\\/(?=[^?]*)/;\nexport const REG_HASH_QUERY = /\\?.+/;\nexport const INVALID_ROUTE = 'Route string is not a pure route';","import $ from 'jquery';\nimport LZStorage from 'lzstorage';\n\n// Object containing a map of attached handlers\nconst store = new LZStorage({\n    compression: true\n});\nexport const libs = {\n    getDataFromStore(path, isHash) {\n        const paths = $.extend({}, store.get('routeStore'));\n        return paths[`${isHash ? '#' : ''}${path}`];\n    },\n    setDataToStore(path, isHash, data) {\n        const paths = $.extend({}, store.get('routeStore'));\n        $.extend(paths, {\n            [`${isHash ? '#' : ''}${path}`]: data\n        });\n        return store.set('routeStore', paths, true);\n    },\n    handlers: []\n};","/**!\n * jQuery router plugin\n * This file contains SPA router methods to handle routing mechanism in single page applications (SPA). Supported versions IE9+, Chrome, Safari, Firefox\n *\n * @project      Jquery Routing Plugin\n * @date         2019-05-05\n * @author       Sachin Singh <ssingh.300889@gmail.com>\n * @dependencies jQuery, jquerydeparam, lzstorage\n * @version      3.0.0-beta.0\n */\n\nimport $ from 'jquery';\nimport deparam from 'jquerydeparam';\nimport { POP_STATE, HASH_CHANGE, ROUTE_CHANGED, REG_ROUTE_PARAMS, INVALID_ROUTE, REG_HASH_QUERY, REG_PATHNAME } from './utils/constants';\nimport { libs } from './utils/libs';\n\n// Variable to check if browser supports history API properly    \nconst isHistorySupported = !!(history && history.pushState);\n\n// Variable to ignore hashchange event\nlet ignoreHashChange = false;\n\n/**\n * Trims leading/trailing special characters\n * @param {string} param Parameters\n */\nfunction sanitize(str) {\n    return str.replace(/^([^a-zA-Z0-9]+)|([^a-zA-Z0-9]+)$/g, \"\");\n}\n\n/**\n * Triggers \"routeChanged\" event unless \"noTrigger\" flag is true\n */\nfunction triggerRoute(route, eventType, hash = false, noTrigger = false, originalData = {}) {\n    if (noTrigger) {\n        ignoreHashChange = false;\n    } else {\n        router.api.trigger(\n            ROUTE_CHANGED,\n            {\n                route,\n                eventType,\n                hash\n            },\n            originalData\n        );\n    }\n}\n\n/**\n * Checks if given route is valid\n * @param {string} route Route string\n */\nfunction isValidRoute(route) {\n    if (typeof route !== \"string\") {\n        return false;\n    };\n    return REG_PATHNAME.test(route);\n}\n\n/**\n * Adds a query string\n * @param {string} route Route string\n * @param {string} qString Query string\n * @param {boolean} appendQString Append query string flag\n */\nfunction resolveQuery(route, queryString, append) {\n    if (typeof queryString === 'string') {\n        queryString = queryString.trim();\n        if (queryString.charAt(0) === '?') {\n            queryString = queryString.substring(1);\n        }\n        if (append && queryString) {\n            return `${route}${window.location.search}&${queryString}`;\n        }\n        if (!append && queryString) {\n            return `${route}?${queryString}`;\n        }\n    }\n    return route;\n}\n\n/**\n * Converts current query string into an object\n */\nfunction getQueryParams() {\n    const qsObject = deparam(window.location.search);\n    const hashStringParams = {};\n    if (window.location.hash.match(REG_HASH_QUERY)) {\n        $.extend(hashStringParams, deparam(window.location.hash.match(REG_HASH_QUERY)[0]));\n    }\n    return $.extend(qsObject, hashStringParams);\n}\n\n/**\n * Set route for given view\n * @param {string|object} oRoute Route string or object\n * @param {boolean} replaceMode Replace mode\n * @param {boolean} noTrigger Do not trigger handler\n */\nfunction execRoute(route, replaceMode, noTrigger) {\n    const routeObject = typeof route === 'string' ? { route } : $.extend({}, route);\n    $.extend(routeObject, {\n        replaceMode,\n        noTrigger\n    });\n    const { route: sroute, replaceMode: rm, noTrigger: nt, queryString: qs, data, title = null, appendQuery } = routeObject;\n    if (typeof sroute === 'string') {\n        const isHash = sroute.charAt(0) === '#' ? 1 : 0;\n        let [pureRoute, queryString] = sroute.trim().split('?');\n        const routeMethod = `${rm ? 'replace' : 'push'}State`;\n        queryString = queryString || qs;\n        ignoreHashChange = nt;\n        pureRoute = pureRoute.substring(isHash);\n        if (isValidRoute(pureRoute)) {\n            libs.setDataToStore(pureRoute, isHash === 1, data);\n            if (isHistorySupported && !isHash) {\n                history[routeMethod]({ data }, title, resolveQuery(pureRoute, queryString, appendQuery));\n                if (!nt) {\n                    router.api.trigger(ROUTE_CHANGED, {\n                        route: pureRoute,\n                        eventType: POP_STATE,\n                        hash: false\n                    });\n                }\n            } else if (rm) {\n                window.location.replace(`#${resolveQuery(pureRoute, queryString, appendQuery)}`);\n            } else {\n                window.location.hash = resolveQuery(pureRoute, queryString, appendQuery);\n            }\n        } else {\n            throw new Error(INVALID_ROUTE);\n        }\n    }\n}\n\n/**\n * Attaches a route handler function\n * @param {string} route Route string\n * @param {function} handler Callback function\n */\nfunction bindRoute(route, handler) {\n    let originalHandler = handler;\n    const element = this;\n    if (typeof handler === 'function') {\n        handler = handler.bind(this);\n    }\n    // Resolve generic route\n    if (typeof route === 'function') {\n        originalHandler = route;\n        handler = route.bind(this);\n        route = '*';\n    }\n    // Check existence\n    const exists = libs.handlers.filter(ob => {\n        let test = (ob.originalHandler === originalHandler && ob.route === route);\n        if (this) {\n            test = test && ob.element === this;\n        }\n        return test;\n    }).length;\n    // Attach handler\n    if (!exists && typeof handler === 'function') {\n        libs.handlers.push({\n            eventName: ROUTE_CHANGED,\n            originalHandler,\n            handler,\n            element,\n            route\n        });\n    }\n    // Execute handler if matches current route (Replaces init method in version 2.0)\n    const { pathname, hash } = window.location;\n    [pathname, hash].forEach(currentPath => {\n        const isHash = currentPath.charAt(0) === '#' ? 1 : 0;\n        const { hasMatch, data, params } = testRoute(route, currentPath);\n        if (hasMatch && typeof handler === 'function') {\n            handler({\n                route: currentPath,\n                hash: isHash === 1,\n                eventName: isHash ? HASH_CHANGE : POP_STATE,\n                data,\n                params,\n                query: getQueryParams()\n            });\n        }\n    });\n}\n\n/**\n * Unbinds route handlers\n * @param {string} route Route string\n * @param {function} handler Callback function\n */\nfunction unbindRoute(route, handler) {\n    const args = arguments;\n    if (args.length === 0) {\n        libs.handlers.length = 0;\n    }\n    libs.handlers = libs.handlers.filter(ob => {\n        if (args.length === 1 && typeof args[0] === 'string') {\n            return ob.route !== route;\n        }\n        // Check for generic route\n        if (args.length === 1 && typeof args[0] === 'function') {\n            handler = args[0];\n            route = '*'; // Generic route\n        }\n        return !(ob.route === route && ob.handler === handler);\n    });\n}\n\n\n/**\n * Compares route with current URL\n * @param {string} route Route string\n * @param {string} url Current url\n * @param {object} params Parameters\n */\nfunction testRoute(route, url, originalData = {}) {\n    const isHash = url.charAt(0) === '#';\n    if (isHash) {\n        url = url.substring(1);\n    }\n    const [path] = url.split('?');\n    if (!$.isEmptyObject(originalData)) {\n        libs.setDataToStore(path, isHash, originalData); // Sync store with event data.\n    }\n    const data = $.extend({}, libs.getDataFromStore(path, isHash));\n    const params = {};\n    let hasMatch = false;\n    REG_ROUTE_PARAMS.lastIndex = 0;\n    if (REG_ROUTE_PARAMS.test(route)) {\n        const pathRegex = new RegExp(route.replace(/\\//g, \"\\\\/\").replace(/:[^\\/\\\\]+/g, \"([^\\\\/]+)\"));\n        if (pathRegex.test(url)) {\n            hasMatch = true;\n            REG_ROUTE_PARAMS.lastIndex = 0;\n            const keys = [...route.match(REG_ROUTE_PARAMS)].map(sanitize);\n            const values = [...url.match(pathRegex)];\n            values.shift();\n            keys.forEach((key, index) => {\n                params[key] = values[index];\n            });\n        }\n    } else {\n        hasMatch = isValidRoute(url) && ((route === url) || (route === '*'));\n    }\n    return {\n        hasMatch,\n        data,\n        params\n    };\n}\n\n/**\n * Triggers a router event\n * @param {string} eventName Name of route event\n * @param {object} params Parameters\n */\nfunction execListeners(eventName, routeConfig, originalData = {}) {\n    const { hash: isHash } = routeConfig;\n    const { hash, pathname } = window.location;\n    libs.handlers.forEach(ob => {\n        if (ob.eventName === eventName) {\n            const { hasMatch, data, params } = testRoute(\n                ob.route,\n                (\n                    (isHistorySupported && !isHash)\n                        ? pathname\n                        : (\n                            hash || pathname\n                        )\n                ),\n                originalData\n            );\n            if (\n                !isHistorySupported\n                && !hash\n            ) {\n                // Fallback to hash routes for older browsers\n                window.location.replace(`#${pathname}`);\n            } else if (hasMatch) {\n                ob.handler($.extend(routeConfig, {\n                    data,\n                    params,\n                    query: getQueryParams()\n                }));\n            }\n        }\n    });\n}\n\n/**\n * Initializes router events\n */\nfunction initRouterEvents() {\n    $(window).on(`${POP_STATE} ${HASH_CHANGE}`, function (e) {\n        const isHash = e.type === 'hashchange';\n        const noTrigger = ignoreHashChange;\n        const { originalEvent } = e;\n        let originalData = {};\n        if (originalEvent && originalEvent.state) {\n            const { data } = originalEvent.state;\n            $.extend(originalData, data);\n        }\n        console.log(e.originalEvent.state);\n        return triggerRoute.apply(this, [\n            window.location[isHash ? 'hash' : 'pathname'],\n            e.type,\n            isHash,\n            noTrigger,\n            originalData\n        ]);\n    });\n}\n\nconst router = {\n    // Events object\n    api: {\n        /**\n         * Triggers a custom route event\n         */\n        trigger() {\n            return execListeners.apply(this, arguments);\n        }\n    },\n    /**\n     * Sets a route url\n     * @param {string|object} route Route object or URL\n     * @param {boolean} replaceMode Flag to enable replace mode\n     * @param {boolean} noTrigger Flag to disable handler while changing route\n     */\n    set() {\n        return execRoute.apply(this, arguments);\n    },\n    // Flag to check if history API is supported in current browser\n    isHistorySupported\n}\n\n/**\n * Attaches a route handler\n * @param {string|function} route Route string or handler function (in case of generic route)\n * @param {function} handler Handler function\n */\nfunction route() {\n    return bindRoute.apply(this, arguments);\n}\n\n/**\n * Detaches a route handler\n * @param {string|function} route Route string or handler function (in case of generic route)\n * @param {function} handler Handler function\n */\nfunction unroute() {\n    return unbindRoute.apply(this, arguments);\n}\n\n// Hooking route and router to jQuery\nif (typeof $ === 'function') {\n    $.route = $.prototype.route = route;\n    $.unroute = $.prototype.unroute = unroute;\n    $.router = router;\n}\n\ninitRouterEvents();\n\nexport { router, route };"],"names":["HASH_CHANGE","POP_STATE","ROUTE_CHANGED","REG_ROUTE_PARAMS","REG_PATHNAME","REG_HASH_QUERY","INVALID_ROUTE","store","LZStorage","compression","libs","getDataFromStore","path","isHash","paths","$","extend","get","setDataToStore","data","set","handlers","isHistorySupported","history","pushState","ignoreHashChange","sanitize","str","replace","triggerRoute","route","eventType","hash","noTrigger","originalData","router","api","trigger","isValidRoute","test","resolveQuery","queryString","append","trim","charAt","substring","window","location","search","getQueryParams","qsObject","deparam","hashStringParams","match","execRoute","replaceMode","routeObject","sroute","rm","nt","qs","title","appendQuery","split","pureRoute","routeMethod","Error","bindRoute","handler","originalHandler","element","bind","exists","filter","ob","length","push","eventName","pathname","forEach","currentPath","testRoute","hasMatch","params","query","unbindRoute","args","arguments","url","isEmptyObject","lastIndex","pathRegex","RegExp","keys","map","values","shift","key","index","execListeners","routeConfig","initRouterEvents","on","e","type","originalEvent","state","console","log","apply","unroute","prototype"],"mappings":"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"}