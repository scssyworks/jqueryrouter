{"version":3,"file":"jquery.router.js","sources":["../../src/js/jquery.router.js"],"sourcesContent":["import $ from 'jquery';\nimport deparam from 'deparam.js';\n\n// Object containing a map of attached handlers\nconst libs = {\n    handlers: []\n};\n// Variable to check if browser supports history API properly    \nconst isHistorySupported = history && history.pushState;\n\n// Alias for window.location\nconst loc = window.location;\n\n// Data cache\nconst cache = {\n    noTrigger: false\n};\n\n// Regular expressions\nconst regex = {\n    pathname: /^\\/(?=[^?]*)/,\n    routeparams: /:[^\\/]+/g,\n    hashQuery: /\\?.+/\n};\n\n// Supported events\nconst eventNames = {\n    routeChanged: \"routeChanged\",\n    hashchange: \"hashchange\",\n    popstate: \"popstate\"\n};\n\n// Error messages\nconst errorMessage = {\n    invalidPath: \"Path is invalid\"\n};\n\n/* eslint-disable */\n\n/**\n * Inner loop function for assign\n * @private\n * @param {object} ref Argument object\n * @param {object} target First object\n */\nfunction _loopFunc(ref, target) {\n    if (ref != null && typeof ref === 'object') {\n        Object.keys(ref).forEach(function (key) {\n            target[key] = ref[key];\n        });\n    }\n}\n\n/**\n * Polyfill for Object.assign only smaller and with less features\n * @private\n * @returns {object}\n */\nfunction _assign() {\n    let i = 0;\n    const target = typeof arguments[0] !== 'object' || arguments[0] == null ? {} : arguments[0];\n    for (i = 1; i < arguments.length; i++) {\n        _loopFunc(arguments[i], target);\n    }\n    return target;\n}\n/* eslint-enable */\n\n/**\n * Converts any list to JavaScript array\n * @param {any[]} arr Array like object\n */\nfunction _arr(arr) {\n    return Array.prototype.slice.call(arr);\n}\n\n/**\n * Triggers \"routeChanged\" event unless \"noTrigger\" flag is true\n */\nfunction _triggerRoute(route, eventType, isHashRoute = false, isInit = false) {\n    if (\n        cache.noTrigger\n        && eventType === eventNames.hashchange\n    ) {\n        cache.noTrigger = false;\n        return;\n    }\n    cache.data = _assign(cache.data);\n    let ref = cache.data.data = _assign(cache.data.data);\n    cache.data.data = _assign({}, ref, {\n        eventType: eventType,\n        hash: !!isHashRoute,\n        route: route,\n        isInit\n    });\n    router.events.trigger(eventNames.routeChanged, cache.data);\n}\n\n/**\n * Checks if given route is valid\n * @param {string} sRoute Route string\n */\nfunction _isValidRoute(sRoute) {\n    return (typeof sRoute === \"string\" && regex.pathname.test(sRoute));\n}\n\n/**\n * Adds a query string\n * @param {string} sRoute Route string\n * @param {string} qString Query string\n * @param {boolean} appendQString Append query string flag\n */\nfunction _resolveQueryString(sRoute, qString, appendQString) {\n    if (!qString && !appendQString) return sRoute;\n    if (typeof qString === \"string\") {\n        if ((qString = qString.trim()) && appendQString) {\n            return `${sRoute}${loc.search}&${qString.replace(\"?\", \"\")}`;\n        } else if (qString) {\n            return `${sRoute}?${qString.replace(\"?\", \"\")}`;\n        } else {\n            return sRoute;\n        }\n    }\n}\n\n/**\n * Converts current query string into an object\n */\nfunction _getQueryParams(coerce = true) {\n    let qsObject = deparam(loc.search, coerce),\n        hashStringParams = {};\n    if (loc.hash.match(regex.hashQuery)) {\n        hashStringParams = deparam(loc.hash.match(regex.hashQuery)[0], coerce);\n    }\n    return _assign({}, qsObject, hashStringParams);\n}\n\n/**\n * Checks if route is valid and returns the valid route\n * @param {string} sRoute Route string\n * @param {string} qString Query string\n * @param {boolean} appendQString Append query string flag\n */\nfunction _validateRoute(sRoute, qString, appendQString) {\n    if (_isValidRoute(sRoute)) {\n        return _resolveQueryString(sRoute, qString, appendQString);\n    }\n    throw new TypeError(errorMessage.invalidPath);\n}\n\n/**\n * Set route for given view\n * @param {string|object} oRoute Route string or object\n * @param {boolean} replaceMode Replace mode\n * @param {boolean} noTrigger Do not trigger handler\n */\nfunction _setRoute(oRoute, replaceMode, noTrigger) {\n    if (!oRoute) return;\n    let title = null,\n        sRoute = \"\",\n        qString = \"\",\n        appendQString = false,\n        isHashString = false,\n        routeMethod = replaceMode ? \"replaceState\" : \"pushState\";\n    cache.noTrigger = noTrigger;\n    if (typeof oRoute === \"object\") {\n        cache.data = {\n            data: oRoute.data\n        };\n        title = oRoute.title;\n        sRoute = oRoute.route;\n        qString = oRoute.queryString;\n        appendQString = oRoute.appendQuery;\n    } else if (typeof oRoute === \"string\") {\n        cache.data = {\n            data: {}\n        };\n        sRoute = oRoute;\n    }\n    // Support for hash routes\n    if (sRoute.charAt(0) === \"#\") {\n        isHashString = true;\n        sRoute = sRoute.replace(\"#\", \"\");\n    }\n    if (isHistorySupported && !isHashString) {\n        history[routeMethod](cache.data, title, _validateRoute(sRoute, qString, appendQString));\n        if (!noTrigger) {\n            cache.data.data = _assign({}, cache.data.data, {\n                eventType: eventNames.popstate,\n                hash: false,\n                route: sRoute\n            });\n            router.events.trigger(eventNames.routeChanged, cache.data);\n        }\n    } else {\n        if (replaceMode) {\n            loc.replace(\"#\" + _validateRoute(sRoute, qString, appendQString));\n        } else {\n            loc.hash = _validateRoute(sRoute, qString, appendQString);\n        }\n    }\n}\n\n/**\n * Attaches a route handler function\n * @param {string} sRoute Route string\n * @param {function} callback Callback function\n */\nfunction _route(sRoute, callback) {\n    if (typeof sRoute === 'function') {\n        callback = sRoute;\n        sRoute = '*'; // Generic route\n    }\n    if (!libs.handlers.filter(ob => {\n        let filterCriteria = (ob.originalHandler === callback && ob.route === sRoute);\n        if (this) {\n            filterCriteria = filterCriteria && ob.element === this;\n        }\n        return filterCriteria;\n    }).length) {\n        libs.handlers.push({\n            eventName: eventNames.routeChanged,\n            originalHandler: callback,\n            handler: callback.bind(this),\n            element: this,\n            route: sRoute\n        });\n    }\n}\n\n/**\n * \n * @param {string} sRoute Route string\n * @param {function} callback Callback function\n */\nfunction _unroute(sRoute, callback) {\n    const args = arguments.length;\n    if (args.length === 0) {\n        libs.handlers.length = 0;\n    }\n    libs.handlers = libs.handlers.filter(routeOb => {\n        if (args.length === 1 && typeof args[0] === 'string') {\n            return routeOb.route !== sRoute;\n        }\n        // Check for generic route\n        if (args.length === 1 && typeof args[0] === 'function') {\n            callback = args[0];\n            sRoute = '*'; // Generic route\n        }\n        return !(routeOb.route === sRoute && routeOb.handler === callback);\n    });\n}\n\n/**\n * Trims leading/trailing special characters\n * @param {string} param Parameters\n */\nfunction _sanitize(str) {\n    return str.replace(/^([^a-zA-Z0-9]+)|([^a-zA-Z0-9]+)$/g, \"\");\n}\n\n/**\n * Compares route with current URL\n * @param {string} route Route string\n * @param {string} url Current url\n * @param {object} params Parameters\n */\nfunction _matched(route, url, params) {\n    if (~url.indexOf(\"?\")) {\n        url = url.substring(0, url.indexOf(\"?\"));\n    }\n    regex.routeparams.lastIndex = 0;\n    if (regex.routeparams.test(route)) {\n        params.params = {};\n        const pathRegex = new RegExp(route.replace(/\\//g, \"\\\\/\").replace(/:[^\\/\\\\]+/g, \"([^\\\\/]+)\"));\n        if (pathRegex.test(url)) {\n            regex.routeparams.lastIndex = 0;\n            let keys = _arr(route.match(regex.routeparams)).map(_sanitize),\n                values = _arr(url.match(pathRegex));\n            values.shift();\n            keys.forEach(function (key, index) {\n                params.params[key] = values[index];\n            });\n            return true;\n        }\n    } else {\n        return ((route === url) || (route === \"*\"));\n    }\n    return false;\n}\n\n/**\n * Triggers a router event\n * @param {string} eventName Name of route event\n * @param {object} params Parameters\n */\nfunction _routeTrigger(eventName, params) {\n    // Ensures that params is always an object\n    params = _assign(params);\n    params.data = _assign(params.data);\n    const { hash: isHashRoute, isInit } = params.data;\n    libs.handlers.forEach(function (eventObject) {\n        if (eventObject.eventName === eventName) {\n            if (\n                isHistorySupported\n                && !isHashRoute\n                && _matched(eventObject.route, loc.pathname, params)\n                && !(\n                    isInit\n                    && eventObject.called\n                )\n            ) {\n                eventObject.called = true;\n                eventObject.handler(params.data, params.params, _getQueryParams(false));\n            } else if (isHashRoute) {\n                if (!loc.hash && !isHistorySupported && _matched(eventObject.route, loc.pathname, params)) {\n                    cache.data = params.data;\n                    loc.replace(\"#\" + loc.pathname); // <-- This will trigger router handler automatically\n                } else if (\n                    _matched(eventObject.route, loc.hash.substring(1), params)\n                    && !(\n                        isInit\n                        && eventObject.hashCalled\n                    )\n                ) {\n                    eventObject.hashCalled = true;\n                    eventObject.handler(params.data, params.params, _getQueryParams(false));\n                }\n            }\n        }\n    });\n}\n\n/**\n * Initializes router events\n */\nfunction _bindRouterEvents() {\n    const $win = $(window);\n    $win.on(eventNames.popstate, function (e) {\n        _triggerRoute.apply(this, [loc.pathname, e.type]);\n    });\n    $win.on(eventNames.hashchange, function (e, isInit) {\n        _triggerRoute.apply(this, [loc.hash, e.type, true, isInit]);\n    });\n}\n\nconst router = {\n    // Events object\n    events: _assign({\n        /**\n         * Triggers a custom route event\n         * @param {string} eventName Name of event\n         * @param {object} params Parameters object\n         */\n        trigger(eventName, params) {\n            return _routeTrigger.apply(this, [eventName, params]);\n        }\n    }, eventNames),\n    /**\n     * Initializes router\n     */\n    init: function () {\n        // Routing settings\n        let settings = {\n            eventType: (isHistorySupported ? eventNames.popstate : eventNames.hashchange),\n            hash: !isHistorySupported,\n            route: (isHistorySupported ? loc.pathname : loc.hash),\n            isInit: true\n        };\n        // Triggers route change event on initialize\n        this.events.trigger(eventNames.routeChanged, {\n            data: settings\n        });\n        // Triggers a hashchange event on initialize if url hash is available\n        if (loc.hash) {\n            $(window).trigger(eventNames.hashchange, [true]);\n        }\n    },\n    /**\n     * Sets a route url\n     * @param {string|object} route Route object or URL\n     * @param {boolean} replaceMode Flag to enable replace mode\n     * @param {boolean} noTrigger Flag to disable handler while changing route\n     */\n    set() {\n        return _setRoute.apply(this, arguments);\n    },\n    // Flag to check if history API is supported in current browser\n    historySupported: isHistorySupported\n}\n\n/**\n * Attaches a route handler\n * @param {string|function} route Route string or handler function (in case of generic route)\n * @param {function} handler Handler function\n */\nfunction route() {\n    return _route.apply(this, arguments);\n}\n\n/**\n * Detaches a route handler\n * @param {string|function} route Route string or handler function (in case of generic route)\n * @param {function} handler Handler function\n */\nfunction unroute() {\n    return _unroute.apply(this, arguments);\n}\n\n// Hooking route and router to jQuery\nif (typeof $ === 'function') {\n    $.route = $.prototype.route = route;\n    $.unroute = $.prototype.unroute = unroute;\n    $.router = router;\n}\n\n_bindRouterEvents();\n\nexport { router, route, unroute };"],"names":["libs","handlers","isHistorySupported","history","pushState","loc","window","location","cache","noTrigger","regex","pathname","routeparams","hashQuery","eventNames","routeChanged","hashchange","popstate","errorMessage","invalidPath","_loopFunc","ref","target","Object","keys","forEach","key","_assign","i","arguments","length","_arr","arr","Array","prototype","slice","call","_triggerRoute","route","eventType","isHashRoute","isInit","data","hash","router","events","trigger","_isValidRoute","sRoute","test","_resolveQueryString","qString","appendQString","trim","search","replace","_getQueryParams","coerce","qsObject","deparam","hashStringParams","match","_validateRoute","TypeError","_setRoute","oRoute","replaceMode","title","isHashString","routeMethod","queryString","appendQuery","charAt","_route","callback","filter","ob","filterCriteria","originalHandler","element","push","eventName","handler","bind","_unroute","args","routeOb","_sanitize","str","_matched","url","params","indexOf","substring","lastIndex","pathRegex","RegExp","map","values","shift","index","_routeTrigger","eventObject","called","hashCalled","_bindRouterEvents","$win","$","on","e","apply","type","init","settings","set","historySupported","unroute"],"mappings":"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"}