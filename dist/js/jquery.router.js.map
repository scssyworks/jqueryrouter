{"version":3,"file":"jquery.router.js","sources":["../../src/js/jquery.router.js"],"sourcesContent":["/**\n * jQuery router plugin\n * This file contains SPA router methods to handle routing mechanism in single page applications (SPA). Supported versions IE9+, Chrome, Safari, Firefox\n *\n * @project      Jquery Routing Plugin\n * @date         2019-02-21\n * @author       Sachin Singh <ssingh.300889@gmail.com>\n * @dependencies jQuery\n * @version      2.1.0\n */\n\nimport $ from 'jquery';\nimport deparam from 'jquerydeparam';\n\n// Object containing a map of attached handlers\nconst libs = {\n    handlers: []\n};\n// Variable to check if browser supports history API properly    \nconst isHistorySupported = history && history.pushState;\n\n// Data cache\nconst cache = {\n    noTrigger: false\n};\n\n// Regular expressions\nconst regex = {\n    pathname: /^\\/(?=[^?]*)/,\n    routeparams: /:[^\\/]+/g,\n    hashQuery: /\\?.+/\n};\n\n// Supported events\nconst eventNames = {\n    routeChanged: \"routeChanged\",\n    hashchange: \"hashchange\",\n    popstate: \"popstate\"\n};\n\n// Error messages\nconst errorMessage = {\n    invalidPath: \"Path is invalid\"\n};\n\n/**\n * Converts any list to JavaScript array\n * @param {any[]} arr Array like object\n */\nfunction _arr(arr) {\n    return Array.prototype.slice.call(arr);\n}\n\n/**\n * Tests if parameter is a valid JavaScript object\n * @param {any} testObject Test object\n */\nfunction _resolveObject(testObject) {\n    if (testObject !== null && typeof testObject === 'object') {\n        return testObject;\n    }\n    return {};\n}\n\n/**\n * Triggers \"routeChanged\" event unless \"noTrigger\" flag is true\n */\nfunction _triggerRoute(route, eventType, isHashRoute = false, isInit = false) {\n    if (\n        cache.noTrigger\n        && eventType === eventNames.hashchange\n    ) {\n        cache.noTrigger = false;\n        return;\n    }\n    cache.data = _resolveObject(cache.data);\n    let ref = cache.data.data = _resolveObject(cache.data.data);\n    let routeOb = {\n        eventType: eventType,\n        hash: !!isHashRoute,\n        route: route,\n        isInit\n    };\n    cache.data.data = {\n        ...ref,\n        ...routeOb\n    };\n    router.events.trigger(eventNames.routeChanged, cache.data);\n}\n\n/**\n * Throw JavaScript errors with custom message\n * @param {string} message Error message\n */\nfunction _throwError(message) {\n    throw new Error(message);\n}\n\n/**\n * Checks if given route is valid\n * @param {string} sRoute Route string\n */\nfunction _isValidRoute(sRoute) {\n    if (typeof sRoute !== \"string\") {\n        return false;\n    };\n    return regex.pathname.test(sRoute);\n}\n\n/**\n * Adds a query string\n * @param {string} sRoute Route string\n * @param {string} qString Query string\n * @param {boolean} appendQString Append query string flag\n */\nfunction _resolveQueryString(sRoute, qString, appendQString) {\n    if (!qString && !appendQString) return sRoute;\n    if (typeof qString === \"string\") {\n        if ((qString = qString.trim()) && appendQString) {\n            return sRoute + window.location.search + \"&\" + qString.replace(\"?\", \"\");\n        } else if (qString) {\n            return sRoute + \"?\" + qString.replace(\"?\", \"\");\n        } else {\n            return sRoute;\n        }\n    }\n}\n\n/**\n * Converts current query string into an object\n */\nfunction _getQueryParams() {\n    let qsObject = deparam(window.location.search),\n        hashStringParams = {};\n    if (window.location.hash.match(regex.hashQuery)) {\n        hashStringParams = deparam(window.location.hash.match(regex.hashQuery)[0]);\n    }\n    return {\n        ...qsObject,\n        ...hashStringParams\n    };\n}\n\n/**\n * Checks if route is valid and returns the valid route\n * @param {string} sRoute Route string\n * @param {string} qString Query string\n * @param {boolean} appendQString Append query string flag\n */\nfunction _validateRoute(sRoute, qString, appendQString) {\n    if (_isValidRoute(sRoute)) {\n        return _resolveQueryString(sRoute, qString, appendQString);\n    }\n    _throwError(errorMessage.invalidPath);\n}\n\n/**\n * Set route for given view\n * @param {string|object} oRoute Route string or object\n * @param {boolean} replaceMode Replace mode\n * @param {boolean} noTrigger Do not trigger handler\n */\nfunction _setRoute(oRoute, replaceMode, noTrigger) {\n    if (!oRoute) return;\n    let title = null,\n        sRoute = \"\",\n        qString = \"\",\n        appendQString = false,\n        isHashString = false,\n        routeMethod = replaceMode ? \"replaceState\" : \"pushState\";\n    cache.noTrigger = noTrigger;\n    if (typeof oRoute === \"object\") {\n        cache.data = {\n            data: oRoute.data\n        };\n        title = oRoute.title;\n        sRoute = oRoute.route;\n        qString = oRoute.queryString;\n        appendQString = oRoute.appendQuery;\n    } else if (typeof oRoute === \"string\") {\n        cache.data = {\n            data: {}\n        };\n        sRoute = oRoute;\n    }\n    // Support for hash routes\n    if (sRoute.charAt(0) === \"#\") {\n        isHashString = true;\n        sRoute = sRoute.replace(\"#\", \"\");\n    }\n    if (isHistorySupported && !isHashString) {\n        history[routeMethod](cache.data, title, _validateRoute(sRoute, qString, appendQString));\n        if (!noTrigger) {\n            let routeOb = {\n                eventType: eventNames.popstate,\n                hash: false,\n                route: sRoute\n            };\n            let ref = cache.data.data;\n            cache.data.data = {\n                ...ref,\n                ...routeOb\n            };\n            router.events.trigger(eventNames.routeChanged, cache.data);\n        }\n    } else {\n        if (replaceMode) {\n            window.location.replace(\"#\" + _validateRoute(sRoute, qString, appendQString));\n        } else {\n            window.location.hash = _validateRoute(sRoute, qString, appendQString);\n        }\n    }\n}\n\n/**\n * Attaches a route handler function\n * @param {string} sRoute Route string\n * @param {function} callback Callback function\n */\nfunction _route(sRoute, callback) {\n    if (typeof sRoute === 'function') {\n        callback = sRoute;\n        sRoute = '*'; // Generic route\n    }\n    if (!libs.handlers.filter(ob => {\n        let filterCriteria = (ob.originalHandler === callback && ob.route === sRoute);\n        if (this) {\n            filterCriteria = filterCriteria && ob.element === this;\n        }\n        return filterCriteria;\n    }).length) {\n        libs.handlers.push({\n            eventName: eventNames.routeChanged,\n            originalHandler: callback,\n            handler: callback.bind(this),\n            element: this,\n            route: sRoute\n        });\n    }\n}\n\n/**\n * \n * @param {string} sRoute Route string\n * @param {function} callback Callback function\n */\nfunction _unroute(sRoute, callback) {\n    const args = arguments.length;\n    if (args.length === 0) {\n        libs.handlers.length = 0;\n    }\n    libs.handlers = libs.handlers.filter(routeOb => {\n        if (args.length === 1 && typeof args[0] === 'string') {\n            return routeOb.route !== sRoute;\n        }\n        // Check for generic route\n        if (args.length === 1 && typeof args[0] === 'function') {\n            callback = args[0];\n            sRoute = '*'; // Generic route\n        }\n        return !(routeOb.route === sRoute && routeOb.handler === callback);\n    });\n}\n\n/**\n * Trims leading/trailing special characters\n * @param {string} param Parameters\n */\nfunction _sanitize(str) {\n    return str.replace(/^([^a-zA-Z0-9]+)|([^a-zA-Z0-9]+)$/g, \"\");\n}\n\n/**\n * Compares route with current URL\n * @param {string} route Route string\n * @param {string} url Current url\n * @param {object} params Parameters\n */\nfunction _matched(route, url, params) {\n    if (~url.indexOf(\"?\")) {\n        url = url.substring(0, url.indexOf(\"?\"));\n    }\n    regex.routeparams.lastIndex = 0;\n    if (regex.routeparams.test(route)) {\n        params.params = {};\n        const pathRegex = new RegExp(route.replace(/\\//g, \"\\\\/\").replace(/:[^\\/\\\\]+/g, \"([^\\\\/]+)\"));\n        if (pathRegex.test(url)) {\n            regex.routeparams.lastIndex = 0;\n            let keys = _arr(route.match(regex.routeparams)).map(_sanitize),\n                values = _arr(url.match(pathRegex));\n            values.shift();\n            keys.forEach(function (key, index) {\n                params.params[key] = values[index];\n            });\n            return true;\n        }\n    } else {\n        return ((route === url) || (route === \"*\"));\n    }\n    return false;\n}\n\n/**\n * Triggers a router event\n * @param {string} eventName Name of route event\n * @param {object} params Parameters\n */\nfunction _routeTrigger(eventName, params) {\n    // Ensures that params is always an object\n    params = _resolveObject(params);\n    params.data = _resolveObject(params.data);\n    const { hash: isHashRoute, isInit } = params.data;\n    libs.handlers.forEach(function (eventObject) {\n        if (eventObject.eventName === eventName) {\n            if (\n                isHistorySupported\n                && !isHashRoute\n                && _matched(eventObject.route, window.location.pathname, params)\n                && !(\n                    isInit\n                    && eventObject.called\n                )\n            ) {\n                eventObject.called = true;\n                eventObject.handler(params.data, params.params, _getQueryParams());\n            } else if (isHashRoute) {\n                if (!window.location.hash && !isHistorySupported && _matched(eventObject.route, window.location.pathname, params)) {\n                    cache.data = params.data;\n                    window.location.replace(\"#\" + window.location.pathname); // <-- This will trigger router handler automatically\n                } else if (\n                    _matched(eventObject.route, window.location.hash.substring(1), params)\n                    && !(\n                        isInit\n                        && eventObject.hashCalled\n                    )\n                ) {\n                    eventObject.hashCalled = true;\n                    eventObject.handler(params.data, params.params, _getQueryParams());\n                }\n            }\n        }\n    });\n}\n\n/**\n * Initializes router events\n */\nfunction _bindRouterEvents() {\n    const $win = $(window);\n    $win.on(eventNames.popstate, function (e) {\n        _triggerRoute.apply(this, [window.location.pathname, e.type]);\n    });\n    $win.on(eventNames.hashchange, function (e, isInit) {\n        _triggerRoute.apply(this, [window.location.hash, e.type, true, isInit]);\n    });\n}\n\nconst router = {\n    // Events object\n    events: {\n        // Available event names\n        ...eventNames,\n        /**\n         * Triggers a custom route event\n         * @param {string} eventName Name of event\n         * @param {object} params Parameters object\n         */\n        trigger(eventName, params) {\n            return _routeTrigger.apply(this, [eventName, params]);\n        }\n    },\n    /**\n     * Initializes router\n     */\n    init: function () {\n        // Routing settings\n        let settings = {\n            eventType: (isHistorySupported ? eventNames.popstate : eventNames.hashchange),\n            hash: !isHistorySupported,\n            route: (isHistorySupported ? window.location.pathname : window.location.hash),\n            isInit: true\n        };\n        // Triggers route change event on initialize\n        this.events.trigger(eventNames.routeChanged, {\n            data: settings\n        });\n        // Triggers a hashchange event on initialize if url hash is available\n        if (window.location.hash) {\n            $(window).trigger(eventNames.hashchange, [true]);\n        }\n    },\n    /**\n     * Sets a route url\n     * @param {string|object} route Route object or URL\n     * @param {boolean} replaceMode Flag to enable replace mode\n     * @param {boolean} noTrigger Flag to disable handler while changing route\n     */\n    set() {\n        return _setRoute.apply(this, arguments);\n    },\n    // Flag to check if history API is supported in current browser\n    historySupported: isHistorySupported\n}\n\n/**\n * Attaches a route handler\n * @param {string|function} route Route string or handler function (in case of generic route)\n * @param {function} handler Handler function\n */\nfunction route() {\n    return _route.apply(this, arguments);\n}\n\n/**\n * Detaches a route handler\n * @param {string|function} route Route string or handler function (in case of generic route)\n * @param {function} handler Handler function\n */\nfunction unroute() {\n    return _unroute.apply(this, arguments);\n}\n\n// Hooking route and router to jQuery\nif (typeof $ === 'function') {\n    $.route = $.prototype.route = route;\n    $.unroute = $.prototype.unroute = unroute;\n    $.router = router;\n}\n\n_bindRouterEvents();\n\nexport { router, route, unroute };"],"names":["libs","handlers","isHistorySupported","history","pushState","cache","noTrigger","regex","pathname","routeparams","hashQuery","eventNames","routeChanged","hashchange","popstate","errorMessage","invalidPath","_arr","arr","Array","prototype","slice","call","_resolveObject","testObject","_triggerRoute","route","eventType","isHashRoute","isInit","data","ref","routeOb","hash","router","events","trigger","_throwError","message","Error","_isValidRoute","sRoute","test","_resolveQueryString","qString","appendQString","trim","window","location","search","replace","_getQueryParams","qsObject","deparam","hashStringParams","match","_validateRoute","_setRoute","oRoute","replaceMode","title","isHashString","routeMethod","queryString","appendQuery","charAt","_route","callback","filter","ob","filterCriteria","originalHandler","element","length","push","eventName","handler","bind","_unroute","args","arguments","_sanitize","str","_matched","url","params","indexOf","substring","lastIndex","pathRegex","RegExp","keys","map","values","shift","forEach","key","index","_routeTrigger","eventObject","called","hashCalled","_bindRouterEvents","$win","$","on","e","apply","type","init","settings","set","historySupported","unroute"],"mappings":"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"}